"use strict";(self["webpackChunkbookkay"]=self["webpackChunkbookkay"]||[]).push([[92],{7202:(e,t,i)=>{i.r(t),i.d(t,{default:()=>te});i(71);var s=i(3673),a=i(8880),o=i(2323);const n={class:"main-container"},r={class:"top-bar"},l={class:"top-bar__left"},d={class:"top-bar__center"},c={class:"hotkey-btn"},u={class:"top-bar__right"},h={class:"save-status"},y={key:0,class:"save-status__saved"},k=(0,s.Uk)(" Saved "),p={key:0,class:"save-status__saving"},v=(0,s.Uk)(" Saving "),m={key:0,class:"save-status__saving"},f=(0,s.Uk)(" Error "),b={class:"editor-container"},_={id:"editorContainer"};function g(e,t,i,g,w,C){const q=(0,s.up)("q-btn"),S=(0,s.up)("q-icon"),$=(0,s.up)("hot-keys-info-dialog"),D=(0,s.up)("q-page");return(0,s.wg)(),(0,s.j4)(D,null,{default:(0,s.w5)((()=>[(0,s._)("div",n,[(0,s._)("div",r,[(0,s._)("div",l,[(0,s.Wm)(q,{color:"black",icon:"self_improvement",label:e.$q.screen.lt.sm?"":"Zen Mode",flat:"",round:e.$q.screen.lt.sm,ripple:{early:!0},onClick:C.toggleZen},null,8,["label","round","onClick"])]),(0,s._)("div",d,[(0,s._)("div",c,[(0,s.Wm)(q,{color:"black",icon:"info",label:e.$q.screen.lt.sm?"":"HotKeys",flat:"",round:e.$q.screen.lt.sm,rounded:!e.$q.screen.lt.sm,ripple:{early:!0},onClick:t[0]||(t[0]=e=>w.hotkeysDialog=!0)},null,8,["label","round","rounded"])])]),(0,s._)("div",u,[(0,s._)("div",h,[(0,s.Wm)(a.uT,{appear:"","enter-active-class":"animated fadeIn","leave-active-class":"animated fadeOut"},{default:(0,s.w5)((()=>["saved"==w.savedStatus?((0,s.wg)(),(0,s.iD)("div",y,[k,(0,s.Wm)(S,{name:"check_circle"})])):(0,s.kq)("",!0)])),_:1}),(0,s.Wm)(a.uT,{appear:"","enter-active-class":"animated fadeIn","leave-active-class":"animated fadeOut"},{default:(0,s.w5)((()=>["saving"==w.savedStatus?((0,s.wg)(),(0,s.iD)("div",p,[v,(0,s.Wm)(S,{name:"edit"})])):(0,s.kq)("",!0)])),_:1}),(0,s.Wm)(a.uT,{appear:"","enter-active-class":"animated fadeIn","leave-active-class":"animated fadeOut"},{default:(0,s.w5)((()=>["error"==w.savedStatus?((0,s.wg)(),(0,s.iD)("div",m,[f,(0,s.Wm)(S,{name:"error"})])):(0,s.kq)("",!0)])),_:1})])])]),(0,s._)("div",b,[(0,s._)("div",_,[(0,s._)("div",{class:(0,o.C_)(["editor",{editor:!e.$q.fullscreen.isActive,editorFull:e.$q.fullscreen.isActive}]),ref:"editor",id:"editorjs",onKeyup:[t[1]||(t[1]=(0,a.D2)((0,a.iM)((e=>w.editor.caret.setToPreviousBlock()),["ctrl","exact"]),["up"])),t[2]||(t[2]=(0,a.D2)((0,a.iM)((e=>w.editor.caret.setToNextBlock()),["ctrl","exact"]),["down"]))],onKeydown:t[3]||(t[3]=(0,a.D2)((0,a.iM)((()=>{}),["ctrl","prevent"]),["s"])),onPaste:t[4]||(t[4]=(...e)=>C.handlePaste&&C.handlePaste(...e))},null,34)])])]),(0,s.Wm)($,{open:w.hotkeysDialog,hotkeys:w.hotkeys,onClose:t[5]||(t[5]=e=>w.hotkeysDialog=!1)},null,8,["open","hotkeys"])])),_:1})}var w=i(9720),C=i(4455),q=i.n(C),S=i(591),$=i.n(S),D=i(6519),T=i.n(D),I=i(2243),x=i.n(I),E=i(4338),P=i.n(E),Z=i(5790),M=i.n(Z),O=i(8721),B=i.n(O),L=i(565),A=i.n(L),K=i(7372),W=i.n(K),U=i(9869),j=i.n(U),F=i(7262),J=i.n(F);const N=[[{keys:["Ctrl","F11"],condition:"",result:"Activate Zen Mode",header:"Global"},{keys:["Ctrl","/"],condition:"",result:"Focus on the editor"}],[{keys:["Ctrl","&#8595;"],condition:"",result:"Jump to next block",header:"Accessiblity (Editor)"},{keys:["Ctrl","&#8593;"],condition:"",result:"Jump to previous block"},{keys:["Ctrl","&#8594;"],condition:"",result:"Jump to next word"},{keys:["Ctrl","&#8592;"],condition:"",result:"Jump to previous word"}],[{keys:["Ctrl","Shift","&#8595;"],condition:"",result:"Select till end of block",header:"Selection (Editor)"},{keys:["Ctrl","Shift","&#8595;"],condition:"Double pressed",result:"Select block below",header:"Selection (Editor)"},{keys:["Ctrl","Shift","&#8593;"],condition:"",result:"Select till start of block"},{keys:["Ctrl","Shift","&#8593;"],condition:"Double Pressed",result:"Select block above"},{keys:["Ctrl","Shift","&#8594;"],condition:"",result:"Select next word"},{keys:["Ctrl","Shift","&#8592;"],condition:"",result:"Select previous word"},{keys:["Shift","&#8594;"],condition:"",result:"Select next letter"},{keys:["Shift","&#8592;"],condition:"",result:"Select previous letter"},{keys:["Ctrl","A"],condition:"",result:"Select all in the block"}],[{keys:["Tab"],condition:"Old Block",result:"Open up toolbar",header:"General (Editor)"},{keys:["Tab"],condition:"New/Blank Block",result:"Open up block selection"}],[{keys:["Enter"],condition:"",result:"Add new bullet",header:"List Manipulation (Editor)"},{keys:["Tab"],condition:"",result:"Indent bullet point"},{keys:["Shift","Tab"],condition:"",result:"Outdent bullet point"}],[{keys:["Ctrl","C"],condition:"",result:"Copy",header:"Text Manipulation (Editor)"},{keys:["Ctrl","V"],condition:"",result:"Paste"},{keys:["Ctrl","Z"],condition:"",result:"Undo"},{keys:["Ctrl","Y"],condition:"",result:"Redo"},{keys:["Ctrl","B"],condition:"",result:"Bold"},{keys:["Ctrl","I"],condition:"",result:"Italic"},{keys:["Ctrl","U"],condition:"",result:"Underline"},{keys:["Ctrl","K"],condition:"",result:"Link"},{keys:["Ctrl","M"],condition:"",result:"Marker"}]];var R=i(9405);const z={name:"EditorPage",components:{HotKeysInfoDialog:w.Z},data(){return{editor:null,savedStatus:"saved",hotkeysDialog:!1,hotkeys:N,data:[],query:""}},watch:{$route:{handler:function(e){this.editor.destroy(),this.makeEditor("editorjs")},deep:!0}},beforeRouteLeave(e,t,i){i()},mounted(){this.makeEditor("editorjs");let e=this;document.body.addEventListener("keydown",(function(t){t.ctrlKey&&"F11"==t.key&&e.toggleZen(),t.ctrlKey&&"/"==t.key&&e.editor.caret.setToLastBlock("end")}),!1)},methods:{toggleZen(){const e=document.getElementById("editorContainer");this.$q.fullscreen.toggle(e).then((()=>{})).catch((e=>{alert(e)}))},async makeEditor(e){await this.initData();const t=new(q())({holder:e,inlineToolbar:["bold","italic","underline","link","marker"],tools:{underline:{class:T(),shortcut:"CMD+U"},marker:{class:$(),shortcut:"CMD+M"},heading:{class:x(),config:{placeholder:"Enter a heading",defaultLevel:3},tunes:["alignment"]},paragraph:{class:P(),tunes:["alignment"]},list:{class:M(),inlineToolbar:!0},delimiter:B(),image:{class:A(),inlineToolbar:!0,config:{embed:{display:!0},unsplash:{appName:"8MeSNDcetPzIRf3mcLc-_6rrHYPaZnbo6ZSLcAIFniI",clientId:"vVpzIjmedfdCC5ZVrvwhKvsmK1TiIs8h7xY_4pD-49M"}}},alignment:{class:W(),config:{default:"left",blocks:{header:"center",list:"left"}}}},autofocus:!0,placeholder:"Let`s write an awesome story!",data:this.data,onReady:()=>{const e=new(J())({editor:t});e.initialize(this.data),new(j())(t)},onChange:()=>{this.savedStatus="saving",t.save().then((e=>{this.saveText(e),console.log("Article data: ",e)})).catch((e=>{console.log("Saving failed: ",e)}))}});this.editor=t},saveText:(0,R.Z)((async function(e){try{await this.saveData(e),this.savedStatus="saved"}catch(t){this.savedStatus="error"}}),2e3),async saveData(e){if("manuscript_id"==this.query){let t={prototype:{text:e},manuscript_id:this.$route.query[this.query]};await this.$store.dispatch("write/editPrototype",t)}else{let t={component:{text:e},id:this.$route.query[this.query]},i=this.query.slice(0,-3);t["type"]=i,await this.$store.dispatch("write/editComponent",t)}},async initData(){let e;if(this.$route.query.hasOwnProperty("front_matter_id"))this.query="front_matter_id",e=await this.$api.get("front-matters/"+this.$route.query.front_matter_id);else if(this.$route.query.hasOwnProperty("chapter_id"))this.query="chapter_id",e=await this.$api.get("chapters/"+this.$route.query.chapter_id);else if(this.$route.query.hasOwnProperty("back_matter_id"))this.query="back_matter_id",e=await this.$api.get("back-matters/"+this.$route.query.back_matter_id);else if(this.$route.query.hasOwnProperty("manuscript_id")){this.query="manuscript_id";let t=await this.$api.get("manuscripts/"+this.$route.query.manuscript_id);e=await this.$api.get("default-book-prototypes/"+t.data.prototype_id)}0!=Object.keys(this.$route.query).length&&(this.data=e.data.text,""!=this.data&&null!=this.data||(this.data={time:1634195030352,blocks:[],version:"2.22.2"}))},handlePaste(){this.savedStatus="saving",setTimeout((()=>{this.editor.save().then((e=>{this.saveText(e),console.log("Article data: ",e)})).catch((e=>{console.log("Saving failed: ",e)}))}),500)}},unmounted(){document.removeEventListener("keydown",this.nextItem)}};var H=i(4260),Q=i(4379),V=i(8240),Y=i(4554),G=i(7518),X=i.n(G);const ee=(0,H.Z)(z,[["render",g],["__scopeId","data-v-4a230a07"]]),te=ee;X()(z,"components",{QPage:Q.Z,QBtn:V.Z,QIcon:Y.Z})}}]);