"use strict";(self["webpackChunkbookkay"]=self["webpackChunkbookkay"]||[]).push([[13],{5637:(e,t,o)=>{o.r(t),o.d(t,{default:()=>Ee});o(71);var a=o(3673),s=o(8880),i=o(2323);(0,a.dD)("data-v-c2afbd5e");const r=["src"],l={class:"book-background"},n={key:0,class:"header top-bar"},d={class:"top-bar__left"},c={key:0,class:"top-bar__center"},h=(0,a._)("img",{src:"logo/BookKay.png"},null,-1),p=(0,a._)("h6",{class:"q-ma-xs text-capitalize"},"BookKay",-1),u={class:"top-bar__right"};function g(e,t,o,g,m,f){const k=(0,a.up)("q-ajax-bar"),y=(0,a.up)("splash-screen"),b=(0,a.up)("reader-settings"),v=(0,a.up)("q-dialog"),w=(0,a.up)("dictionary"),_=(0,a.up)("q-btn"),$=(0,a.up)("q-avatar"),C=(0,a.up)("book"),x=(0,a.up)("side-bar-contents"),q=(0,a.up)("drawer");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(k,{ref:"bar",position:"top",color:"primary",size:"5px"},null,512),(0,a.Wm)(y),(0,a._)("video",{autoplay:"",muted:"",playsinline:"",loop:"",id:"backgroundVideo",src:f.videoURL},null,8,r),(0,a._)("div",l,[(0,a.Wm)(v,{modelValue:m.settingsDialog,"onUpdate:modelValue":t[0]||(t[0]=e=>m.settingsDialog=e)},{default:(0,a.w5)((()=>[(0,a.Wm)(b,{purchaseAble:m.purchaseAble,onToggleBook:f.toggleBook,onSearchDictionary:f.searchDictionary,onThemeChanged:f.reloadsBook,onPurchase:f.purchase},null,8,["purchaseAble","onToggleBook","onSearchDictionary","onThemeChanged","onPurchase"])])),_:1},8,["modelValue"]),(0,a.Wm)(w,{ref:"dictionary"},null,512),(0,a.Wm)(s.uT,{appear:"","enter-active-class":"animated slideInDown","leave-active-class":"animated slideOutUp"},{default:(0,a.w5)((()=>[m.headerShow?((0,a.wg)(),(0,a.iD)("div",n,[(0,a._)("div",d,[(0,a.Wm)(_,{dense:"",flat:"",round:"",icon:"menu",class:"q-mx-sm",color:f.btnColor,ripple:{early:!0},onClick:f.toggleDrawer},null,8,["color","onClick"]),(0,a.Wm)(_,{color:f.btnColor,icon:"self_improvement",label:e.$q.screen.lt.sm?"":"Zen Mode",outline:"",round:e.$q.screen.lt.sm,ripple:{early:!0},onClick:f.toggleZen},null,8,["color","label","round","onClick"])]),e.$q.screen.lt.sm?(0,a.kq)("",!0):((0,a.wg)(),(0,a.iD)("div",c,[(0,a.Wm)(_,{flat:"",color:f.btnColor,onClick:t[1]||(t[1]=t=>e.$router.go(-1)),ripple:{early:!0}},{default:(0,a.w5)((()=>[(0,a.Wm)($,{class:"q-ma-xs gt-sm",size:"lg"},{default:(0,a.w5)((()=>[h])),_:1}),p])),_:1},8,["color"])])),(0,a._)("div",u,[e.$q.screen.gt.sm&&m.purchaseAble?((0,a.wg)(),(0,a.j4)(_,{key:0,label:"Purchase",outline:"",color:f.btnColor,icon:"shopping_cart",class:"q-ma-md",onClick:f.purchase,ripple:{early:!0}},null,8,["color","onClick"])):e.$q.screen.gt.sm&&!e.$store.getters["user/isLoggedIn"]?((0,a.wg)(),(0,a.j4)(_,{key:1,label:"Register",outline:"",color:f.btnColor,icon:"login",class:"q-ma-md",onClick:t[2]||(t[2]=t=>e.$router.push({name:"home-sign-up"})),ripple:{early:!0}},null,8,["color"])):(0,a.kq)("",!0),(0,a.Wm)(_,{round:e.$q.screen.lt.sm,label:e.$q.screen.lt.sm?"":"Settings",outline:"",color:f.btnColor,icon:"settings",class:"q-ma-md",onClick:t[3]||(t[3]=e=>m.settingsDialog=!0),ripple:{early:!0}},null,8,["round","label","color"]),(0,a.Wm)(_,{round:"",outline:"",color:f.btnColor,icon:"expand_less",onClick:t[4]||(t[4]=e=>m.headerShow=!1),class:"q-ma-md",ripple:{early:!0}},null,8,["color"])])])):(0,a.kq)("",!0)])),_:1}),(0,a._)("div",{class:"transparent-area",onClick:t[5]||(t[5]=e=>m.headerShow=!0)}),(0,a._)("div",{onClick:t[6]||(t[6]=(...e)=>f.onClick&&f.onClick(...e))},[(0,a.Wm)(C,{onNavAdded:f.addNav,onSwiped:f.handleSwipe,ref:"book",class:(0,i.C_)(["book",m.bookcss])},null,8,["onNavAdded","onSwiped","class"])]),(0,a.Wm)(q,{direction:"left",exist:!0,ref:"drawer"},{default:(0,a.w5)((()=>[(0,a._)("div",{class:(0,i.C_)(["relative side-bar",m.sideBarClasses])},[(0,a.Wm)(x,{contents:m.navigations,onClicked:f.navClicked},null,8,["contents","onClicked"]),(0,a.Wm)(_,{color:f.btnColor,outline:"",icon:"arrow_back",label:"Back",onClick:t[7]||(t[7]=t=>(m.headerShow=!1,e.$router.go(-1))),class:"absolute-bottom",style:{"max-width":"110px"}},null,8,["color"])],2)])),_:1},512)])],64)}(0,a.Cn)();var m=o(2730);function f(e,t,o,s,r,l){const n=(0,a.up)("loading-screen"),d=(0,a.up)("page"),c=(0,a.up)("cover"),h=(0,a.up)("flipbook"),p=(0,a.Q2)("touch-swipe");return(0,a.wg)(),(0,a.iD)("div",null,[r.loading?((0,a.wg)(),(0,a.j4)(n,{key:0,text:r.loadingText},null,8,["text"])):(0,a.kq)("",!0),r.loading?((0,a.wg)(),(0,a.j4)(d,{key:1,pageNum:1,header:"title",text:"",class:(0,i.C_)(["transparent",r.widthClass]),fontSize:r.fontSize,style:{opacity:"0"}},null,8,["class","fontSize"])):(0,a.kq)("",!0),r.loading?(0,a.kq)("",!0):(0,a.wy)(((0,a.wg)(),(0,a.j4)(h,{key:2,width:r.width,height:r.height,size:"fixed",usePortrait:!0,maxShadowOpacity:.5,autoSize:!0,showCover:!0,mobileScrollSupport:!0,startZIndex:0,disableFlipByClick:!0,ref:"flipbook",id:"flipbook",onFlipbookInit:l.onFlipbookInit,onPageTurned:l.onPageTurn},{default:(0,a.w5)((()=>[(0,a.Wm)(c,{url:r.frontCover},null,8,["url"]),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(r.pages,(e=>((0,a.wg)(),(0,a.j4)(d,{key:e.pageNum,pageNum:e.pageNum,header:e.header,text:e.text,fontSize:r.fontSize},null,8,["pageNum","header","text","fontSize"])))),128)),(0,a.Wm)(c,{url:r.backCover},null,8,["url"])])),_:1},8,["width","height","maxShadowOpacity","onFlipbookInit","onPageTurned"])),[[p,l.handleSwipe]])])}var k=o(9119),y=o.n(k);o(7280),o(5363);(0,a.dD)("data-v-e0a00dbe");const b={ref:"parentElement",class:"flipbook"};function v(e,t,o,s,i,r){return(0,a.wg)(),(0,a.iD)("div",b,[(0,a.WI)(e.$slots,"default",{},void 0,!0)],512)}(0,a.Cn)();var w=o(2389);const _={name:"Flipbook",props:{width:{type:Number,required:!0},height:{type:Number,required:!0},size:{validator:function(e){return-1!==["fixed","stretch"].indexOf(e)}},minWidth:{type:Number,required:!1},maxWidth:{type:Number,required:!1},minHeight:{type:Number,required:!1},maxHeight:{type:Number,required:!1},drawShadow:{type:Boolean,default:!0},flippingTime:{type:Number,default:1e3},usePortrait:{type:Boolean,default:!0},startZIndex:{type:Number,default:0},startPage:{type:Number,default:0},autoSize:{type:Boolean,default:!0},maxShadowOpacity:{type:Number,default:1,validator:function(e){return e>=0&&e<=1}},showCover:{type:Boolean,default:!1},mobileScrollSupport:{type:Boolean,default:!0},swipeDistance:{type:Number,default:30},clickEventForward:{type:Boolean,default:!0},useMouseEvents:{type:Boolean,default:!0},disableFlipByClick:{type:Boolean,default:!1}},mounted(){this.createFlipbook()},data(){return{pageFlip:""}},methods:{createFlipbook(){const e=this.$refs.parentElement,t={width:this.$props.width,height:this.$props.height,size:this.$props.size,minWidth:this.$props.minWidth,maxWidth:this.$props.maxWidth,minHeight:this.$props.minHeight,maxHeight:this.$props.maxHeight,drawShadow:this.$props.drawShadow,flippingTime:this.$props.flippingTime,usePortrait:this.$props.usePortrait,startZIndex:this.$props.startZIndex,startPage:this.$props.startPage,autoSize:this.$props.autoSize,maxShadowOpacity:this.$props.maxShadowOpacity,showCover:this.$props.showCover,mobileScrollSupport:this.$props.mobileScrollSupport,swipeDistance:this.$props.swipeDistance,clickEventForward:this.$props.clickEventForward,useMouseEvents:this.$props.useMouseEvents,disableFlipByClick:this.$props.disableFlipByClick},o=new w.PageFlip(e,t);o.getFlipController()?o.updateFromHtml(document.querySelectorAll(".page")):o.loadFromHTML(document.querySelectorAll(".page")),o.on("init",(e=>{this.$emit("flipbookInit",e.data)})),o.on("flip",(e=>{this.$emit("pageTurned",e.data)})),this.pageFlip=o},updateFromHtml(){this.pageFlip.updateFromHtml(document.querySelectorAll(".page"))},getPageCount(){this.pageFlip.getPageCount()},flip(e,t=""){(t="")&&(t=this.getCorner()),this.pageFlip.flip(e,t)},flipNext(e=""){e||(e=this.getCorner()),console.log("in"),this.pageFlip.flipNext(e),console.log("flipped")},flipPrev(e=""){e||(e=this.getCorner()),console.log("prev"),this.pageFlip.flipPrev(e)},destroy(){this.pageFlip.destroy()},getCorner(){var e=["top","bottom"],t=e[Math.floor(Math.random()*e.length)];return t}}};_.render=v,_.__scopeId="data-v-e0a00dbe";const $=_;(0,a.dD)("data-v-a29e2be2");const C={class:"page-content"},x={class:"page-header"},q=["innerHTML"],S={class:"page-footer"};function W(e,t,o,s,r,l){return(0,a.wg)(),(0,a.iD)("div",{class:(0,i.C_)(["page",s.pageClasses])},[(0,a._)("div",C,[(0,a._)("h2",x,(0,i.zw)(e.$props.header),1),(0,a._)("div",{class:"page-text",innerHTML:e.$props.text,style:(0,i.j5)(e.$props.fontSize)},null,12,q),(0,a._)("div",S,(0,i.zw)(e.$props.pageNum),1)])],2)}(0,a.Cn)();var D=o(8825),T=o(1959);const P={name:"Page",props:{pageNum:{type:Number,required:!0},header:{type:String,required:!0},text:{type:String,required:!0},fontSize:{type:String,required:!0}},setup(){const e=(0,D.Z)(),t=(0,T.qj)({"page--dark":e.dark.isActive});return(0,a.YP)((()=>e.dark.isActive),(e=>{t["page--dark"]=!!e})),{pageClasses:t}}};P.render=W,P.__scopeId="data-v-a29e2be2";const A=P;(0,a.dD)("data-v-22b8ad3d");const B=["src","alt"];function N(e,t,o,s,r,l){return(0,a.wg)(),(0,a.iD)("div",{class:(0,i.C_)(["page",s.pageClasses])},[(0,a._)("img",{class:"cover-img",src:e.$props.url,alt:e.$props.url},null,8,B)],2)}(0,a.Cn)();const L={name:"Cover",props:{url:{type:String,required:!0}},setup(){const e=(0,D.Z)(),t=(0,T.qj)({"page--dark":e.dark.isActive});return(0,a.YP)((()=>e.dark.isActive),(e=>{t["page--dark"]=!!e})),{pageClasses:t}}};var M=o(4027),I=o(7518),F=o.n(I);L.render=N,L.__scopeId="data-v-22b8ad3d";const Z=L;F()(L,"components",{QImg:M.Z}),(0,a.dD)("data-v-47e39d86");const E={class:"loader-wrapper"};function H(e,t,o,r,l,n){return(0,a.wg)(),(0,a.iD)("div",E,[(0,a.Wm)(s.uT,{appear:"","enter-active-class":"animated fadeIn","leave-active-class":"animated fadeOut"},{default:(0,a.w5)((()=>[((0,a.wg)(),(0,a.iD)("div",{class:"loading-text-container",key:o.text},[(0,a._)("div",{class:(0,i.C_)(["loading-text",r.loadingTextClasses])},[(0,a._)("h3",null,(0,i.zw)(o.text),1),(0,a._)("div",null,[(0,a._)("div",{class:(0,i.C_)(["clock-loader",r.clockLoaderClasses])},null,2)])],2)]))])),_:1})])}(0,a.Cn)();const z={name:"LoadingScreen",props:{text:{type:String,required:!0}},setup(){const e=(0,D.Z)(),t=(0,T.qj)({"loading-text--dark":e.dark.isActive}),o=(0,T.qj)({"clock-loader--dark":e.dark.isActive});return(0,a.YP)((()=>e.dark.isActive),(e=>{e?(t["loading-text--dark"]=!0,o["clock-loader--dark"]=!0):(t["loading-text--dark"]=!1,o["clock-loader--dark"]=!1)})),{loadingTextClasses:t,clockLoaderClasses:o}}};z.render=H,z.__scopeId="data-v-47e39d86";const j=z,O=["evt"],Q={name:"Book",components:{Flipbook:$,Page:A,Cover:Z,LoadingScreen:j},created(){document.addEventListener("keydown",(e=>{this.handleKeyPress(e.key)}),{once:!0}),document.addEventListener("wheel",(e=>{this.handleScroll(e.deltaY)}),{once:!0})},async mounted(){const e=this;if(this.loadingText="Book Loading...Please Wait","manuscript_id"==Object.keys(this.$route.query)[0]){let e;try{e=await this.$api.get("manuscripts/"+this.$route.query.manuscript_id+"/json")}catch(c){this.loadingText="Server Error :(",console.log(c)}const o=e.data;this.book=o,this.loadingText="Configuring Covers",this.configureCovers();try{this.book=t(this.book)}catch(c){this.loadingText="Rendering Error :(",console.log(c)}this.loading=!1}if("book_id"==Object.keys(this.$route.query)[0]){let e,o=this.$route.query.book_id;this.$q.cookies.has(`last_read_${o}`)||(e=this.$store.getters["user/isLoggedIn"]?await this.$api.post(`books/${o}/read`):await this.$api.get(`books/${this.$route.query.book_id}/read`),this.$q.cookies.set(`last_read_${o}`,"",{expires:"1h",path:"/"}));let a=screen.height,s=window.innerWidth;if(e=await this.$api.get(`books/${o}/copy`,{params:{height:a,width:s}}),0==Object.keys(e.data).length){try{e=await this.$api.get("books/"+o+"/json")}catch(c){this.loadingText="Server Error :(",console.log(c)}const i=e.data;this.book=i,this.configureCovers();try{this.book=await t(this.book),this.$api.post(`books/${o}/copy`,{height:a,width:s,json:this.book_copy})}catch(c){this.loadingText="Rendering Error :(",console.log(c)}}else this.book=e.data,this.configureCovers(),this.loadBookCopy();this.loading=!1}async function t(t){var s=1;if(e.$emit("navAdded",{type:"book",data:t["title"],page:s-1,active:!1}),e.book_copy.title=t.title,e.book_copy.front_cover=t.front_cover,e.book_copy.back_cover=t.back_cover,e.$q.screen.lt.sm||(a(s,t["title"],""),s++),"front_matters"in t)for(var i=t["front_matters"],r=0;r<i.length;r++){let t=i[r];e.book_copy["front_matters"].append({title:t["title"],pages:[]}),t["page"]=s,e.$emit("navAdded",{type:"front_matter",data:t["title"],page:s}),s=o(t["text"],s,t["title"],e.book_copy.front_matters[r]);var l=document.getElementsByClassName("page-text")[0].innerHTML;""!=l&&(e.book_copy.front_matters[r]["pages"].push(l),a(s,t["title"],l),document.getElementsByClassName("page-text")[0].innerHTML="",s++)}if("chapters"in t&&t.chapters.length>0){var n=t["chapters"];for(r=0;r<n.length;r++){let t=n[r];e.book_copy["chapters"].push({title:t["title"],pages:[]}),t["page"]=s,e.$emit("navAdded",{type:"chapter",data:t["title"],page:s}),s=o(t["text"],s,t["title"],e.book_copy.chapters[r]);l=document.getElementsByClassName("page-text")[0].innerHTML;""!=l&&(e.book_copy.chapters[r]["pages"].push(l),a(s,t["title"],l),document.getElementsByClassName("page-text")[0].innerHTML="",s++)}}else if(""!=t.text&&null!=t.text){e.$emit("navAdded",{type:"text",data:t["title"],page:s}),s=o(t["text"],s,t["title"],e.book_copy.main_text),e.book_copy["main_text"]={title:t["title"],pages:[]};l=document.getElementsByClassName("page-text")[0].innerHTML;""!=l&&(e.book_copy.main_text["pages"].push(l),a(s,t["title"],l),document.getElementsByClassName("page-text")[0].innerHTML="",s++)}if("back_matters"in t){var d=t["back_matters"];for(r=0;r<d.length;r++){let t=d[r];e.book_copy["back_matters"].push({title:t["title"],pages:[]}),e.$emit("navAdded",{type:"back_matter",data:t["title"],page:s}),s=o(t["text"],s,d[r]["title"],e.book_copy.back_matters[r]);l=document.getElementsByClassName("page-text")[0].innerHTML;""!=l&&(e.book_copy.back_matters[r]["pages"].push(l),a(s,t["title"],l),document.getElementsByClassName("page-text")[0].innerHTML="",s++)}}return e.$q.screen.lt.sm||(a(s,t["title"],""),s++,s%2==0&&a(s,t["title"],"")),t}function o(t,s,r,c,h=[]){if("attributes"in t&&"id"in t["attributes"]&&"RootDivContainer"==t["attributes"]["id"]);else{var p="attributes"in t?n(t["type"],t["attributes"]):n(t["type"]),u=l(t["type"]),g=i(p+u,h);""!=g&&(c["pages"].push(g),a(s,r,g),g=i(p+u,h),s++),h.push({openingTag:p,closingTag:u})}if(t["contents"])for(var m=0;m<t["contents"].length;m++){var f=t["contents"][m];if("string"==typeof f){f=d(f);for(var k=f.split(" "),y=0;y<k.length;y++){var b=k[y]+" ";g=i(b,h);if(""!=g){c["pages"].push(g),a(s,r,g);for(var v=[],w=0;w<h.length;w++){var _=h[w],$=e.pages[e.pages.length-1].text.split(" ");g=_["openingTag"].startsWith("<p")&&"<p></p>"!=$[$.length-2]?i("<p style='text-indent: 0'>"+_["closingTag"],v):i(_["openingTag"]+_["closingTag"],v),v.push(_)}g=i(b,h),s++}}}else if(e.singleTags.includes(f.type)){b="<"+f.type+"/>",g=i(b,h);""!=g&&(a(s,r,g),g=i(b,h),s++)}else s=o(f,s,r,c,h),h.pop()}return s}function a(t,o,a){var s={header:o,pageNum:t,text:a};e.pages.push(s)}function s(e){var t=e.style.overflow;t&&"visible"!==t||(e.style.overflow="hidden");var o=e.clientWidth<e.scrollWidth||e.clientHeight<e.scrollHeight;return e.style.overflow=t,o}function i(e,t=[]){var o=document.getElementsByClassName("page-text")[0],a=o.innerHTML,i=a;if(t.length>0){let s=t[t.length-1]["closingTag"],i=1;for(let e=0;e<t.length-1;e++){let o=t[e];o["closingTag"]==s&&i++}let n=r(a,s,i);var l=a.slice(n);a=a.slice(0,n),a=a+e+" "+l,o.innerHTML=a}else o.innerHTML+=e+" ";return s(o)?(o.innerHTML="",i):""}function r(e,t,o){return null===e?-1:!o||isNaN(o)||o<=1?e.lastIndexOf(t):(o--,e.lastIndexOf(t,r(e,t,o)-1))}function l(e){return"</"+e+">"}function n(e,t={}){var o="<"+e;for(const a in t)o=o+" "+a+"='"+t[a]+"'";return o+=">",o}function d(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}},data(){return{widthClass:this.$q.screen.lt.sm?"full-page":"half-page",width:this.$q.screen.lt.sm?window.innerWidth:window.innerWidth/2,height:screen.height,loading:!0,loadingText:"",lastScrollTop:0,bookConfigs:{},fontSize:"font-size: 18px",singleTags:["br","hr"],frontCover:"",backCover:"",book:{title:"",front_matters:[],chapters:[],text:"",back_matters:[]},text:"",book_copy:{front_matters:[],chapters:[],main_text:{},back_matters:[]},pages:[]}},methods:{loadPageFlip(){setTimeout((()=>this.$refs.flipbook.updateFromHtml()),1e3)},configureCovers(){let e=this.book.front_cover,t=this.book.back_cover,o=this.book.temp_cover;this.frontCover=""!=e?e:o,this.backCover=""!=t?t:o},compareIndex(e,t){return e.index<t.index?-1:e.index>t.index?1:0},processClosingTag(e){return e=e.split("<br>").join("<br/>"),e=e.split("<hr>").join("<hr/>"),e=e.split("<img>").join("<img/>"),e},createPage(e,t,o){var a={header:t,pageNum:e,text:o};this.pages.push(a)},loadBookCopy(){let e=1;this.$emit("navAdded",{type:"book",data:this.book["title"],page:e-1,active:!1}),this.$q.screen.lt.sm||(this.createPage(e,this.book["title"],""),e++);for(const t of this.book["front_matters"]){this.$emit("navAdded",{type:"front_matter",data:t["title"],page:e});for(const o of t["pages"])this.createPage(e,t["title"],o),e++}for(const t of this.book["chapters"]){this.$emit("navAdded",{type:"chapter",data:t["title"],page:e});for(const o of t["pages"])this.createPage(e,t["title"],o),e++}if(Object.keys(this.book["main_text"]).length>0){let t=this.book["main_text"];for(const o of t["pages"])this.createPage(e,t["title"],o),e++}for(const t of this.book["back_matters"]){this.$emit("navAdded",{type:"back_matter",data:t["title"],page:e});for(const o of t["pages"])this.createPage(e,t["title"],o),e++}this.$q.screen.lt.sm||(this.createPage(e,this.book["title"],""),e++,e%2==0&&this.createPage(e,this.book["title"],""))},turnToQueryPage(){let e=this.$route.query;if(e.hasOwnProperty("front_matter_id")&&front_matters in this.book){let t=this.book.front_matters,o=t.find((t=>t.front_matter_id===e.front_matter_id));this.$refs.flipbook.flip(o.pageNum)}else if(e.hasOwnProperty("chapter_id")&&chapters in this.book){let t=this.book.chapters,o=t.find((t=>t.chapter_id===e.chapter_id));this.$refs.flipbook.flip(o.pageNum)}else if(e.hasOwnProperty("back_matter_id")&&back_matters in this.book){let t=this.book.back_matters,o=t.find((t=>t.back_matter_id===e.back_matter_id));this.$refs.flipbook.flip(o.pageNum)}},onFlipbookInit(){let e=this.$route.query.book_id;if(Object.keys(this.$route.query)>0&&this.turnToQueryPage(),this.$q.localStorage.has(`pageNumOf_${e}`)){let t=this.$q.localStorage.getItem(`pageNumOf_${e}`);this.$refs.flipbook.flip(t)}},onPageTurn(e){if("book_id"in this.$route.query){let t=this.$route.query.book_id;this.$q.localStorage.set(`pageNumOf_${t}`,e)}},handleKeyPress(e){if(this.$refs.flipbook&&!this.loading){switch(e){case"ArrowLeft":this.$refs.flipbook.flipPrev();break;case"ArrowRight":this.$refs.flipbook.flipNext();break;case"ArrowDown":this.$refs.flipbook.flipNext();break;case"ArrowUp":this.$refs.flipbook.flipPrev();break;case"AudioVolumeUp":this.$refs.flipbook.flipNext();break;case"AudioVolumeDown":this.$refs.flipbook.flipPrev();break;default:}document.addEventListener("keydown",(e=>{this.handleKeyPress(e.key)}),{once:!0})}},handleScroll(e){this.$refs.flipbook&&(e<0?this.$refs.flipbook.flipPrev():e>0&&this.$refs.flipbook.flipNext(),document.addEventListener("wheel",(e=>{this.handleScroll(e.deltaY)}),{once:!0}))},handleSwipe(e){let{evt:t}=e,o=y()(e,O);const a=o.direction;"right"==a?this.$refs.flipbook.flipPrev():"left"==a?this.$refs.flipbook.flipNext():"top"==a?this.$emit("swiped","top"):"down"==a&&this.$emit("swiped","down")}}};var U=o(8020);Q.render=f,Q.__scopeId="data-v-02dcdb32";const R=Q;F()(Q,"directives",{TouchSwipe:U.Z}),(0,a.dD)("data-v-b4ed4c86");const V={key:0},K={class:"overlay",ref:"overlay"};function Y(e,t,o,s,r,l){return l.enabled?((0,a.wg)(),(0,a.iD)("section",V,[(0,a._)("aside",{class:"sidebar",style:(0,i.j5)(l.style),ref:"element"},[(0,a.WI)(e.$slots,"default",{},void 0,!0)],4),(0,a._)("div",K,null,512)])):(0,a.kq)("",!0)}(0,a.Cn)();const X={name:"Drawer",props:["direction","exist"],data(){return{auto_speed:"0.3s",manual_speed:"0.03s",threshold:20,startTime:null,startPos:null,translate:null,active:!1,visible:!0}},computed:{element:function(){return this.$refs.element},overlay:function(){return this.$refs.overlay},enabled:function(){return 1==this.exist},style:function(){return"right"==this.direction?"transform:translate3d(100%,0,0);right:0;":"transform:translate3d(-100%,0,0);left:0;"}},mounted(){document.addEventListener("touchstart",(e=>{this.handleStart(e)})),document.addEventListener("touchmove",(e=>{this.handleMove(e)})),document.addEventListener("touchend",(e=>{this.handleEnd(e)})),document.addEventListener("touchcancel",(e=>{this.handleEnd(e)})),window.addEventListener("resize",(e=>{this.setVisibality(e)}),!0),this.overlay.addEventListener("transitionend",(e=>{this.handleZindex(e)}),!1),this.overlay.addEventListener("click",(e=>{this.close()}),!1),this.setVisibality()},methods:{setVisibality(){0==this.element.offsetWidth?this.visible=!1:this.visible=!0},handleStart(e){this.startTime=(new Date).getTime(),this.startPos=e.targetTouches[0].pageX,this.element.style.transitionDuration=this.manual_speed},handleMove(e){let t=this.gesture(e),o=this.validate(this.direction,t);if(o){let o=this.percentage(this.direction,t);"left"==this.direction?(this.translate=e.touches[0].pageX-this.element.offsetWidth,this.translate<0?this.element.style.transform="translate3d("+this.translate+"px,0,0)":this.open()):(this.translate=-(screen.width-this.element.offsetWidth-e.touches[0].pageX),this.translate>0?this.element.style.transform="translate3d("+this.translate+"px,0,0)":this.open()),this.overlayOpacity(o/100)}},handleEnd(e){let t=this.speed(e),o=this.gesture(e),a=this.validate(this.direction,o);a&&(t>.6?this.active?this.close():this.open():this.element.offsetWidth/2>Math.abs(this.translate)?this.open():this.close())},handleZindex(){let e=window.getComputedStyle(this.overlay).getPropertyValue("opacity");e<=0&&(this.overlay.style.zIndex=-999)},validate(e,t){if("left"==e){if(this.active&&"swiperight"==t||!this.active&&("swipeleft"==t||this.startPos>this.threshold))return!1}else if(this.active&&"swipeleft"==t||!this.active&&("swiperight"==t||this.startPos<screen.width-this.threshold))return!1;return!(document.querySelector(".sidebar.active")&&!this.active||!this.visible)},overlayOpacity(e){this.overlay.style.opacity=e,e>0&&(this.overlay.style.zIndex=999)},gesture(e){let t=["swipeleft","swiperight"],o=e.changedTouches[0].pageX;return this.startPos-o<0?t[1]:t[0]},open(){this.translate=0,this.element.style.transform="translate3d("+this.translate+",0,0)",this.element.style.transitionDuration=this.auto_speed,this.overlayOpacity(1),this.lock(document.querySelector("html")),this.lock(document.querySelector("body")),this.element.classList.add("active"),this.active=!0},close(){"left"==this.direction?this.translate="-"+this.element.offsetWidth+"px":this.translate=this.element.offsetWidth+"px",this.element.style.transform="translate3d("+this.translate+",0,0)",this.element.style.transitionDuration=this.auto_speed,this.overlayOpacity(0),this.unlock(document.querySelector("html")),this.unlock(document.querySelector("body")),this.element.classList.remove("active"),this.active=!1},speed(e){let t=(new Date).getTime()-this.startTime,o=Math.abs(this.startPos),a=Math.abs(e.changedTouches[0].pageX),s=o>a?o-a:a-o;return s/t},percentage(e,t){let o=0,a=[];return a="left"==e?["swipeleft","swiperight"]:["swiperight","swipeleft"],this.active&&t==a[0]&&(o=100-Math.round(Math.abs(this.translate)/this.element.offsetWidth*100)),this.active||t!=a[1]||(o=Math.round(100-Math.abs(this.translate)/this.element.offsetWidth*100)),o>100&&(o=100),o<0&&(o=0),o},lock(e){e.style.overflow="hidden",e.style.touchAction="none"},unlock(e){e.style.removeProperty("overflow"),e.style.removeProperty("touch-action")}},unmounted(){this.unlock(document.querySelector("html")),this.unlock(document.querySelector("body"))}};X.render=Y,X.__scopeId="data-v-b4ed4c86";const G=X;var J=o(5126);(0,a.dD)("data-v-0d70c61d");const ee=(0,a.Uk)(" Rest & Chill"),te=(0,a.Uk)(" Dark Mode"),oe=(0,a.Uk)(" HotKeys"),ae=(0,a.Uk)(" Dictionary"),se=(0,a.Uk)(" Purchase"),ie=(0,a.Uk)(" Register");function re(e,t,o,s,i,r){const l=(0,a.up)("q-icon"),n=(0,a.up)("q-avatar"),d=(0,a.up)("q-item-section"),c=(0,a.up)("q-item-label"),h=(0,a.up)("q-item"),p=(0,a.up)("q-toggle"),u=(0,a.up)("q-list"),g=(0,a.up)("q-card"),m=(0,a.up)("hot-keys-info-dialog"),f=(0,a.Q2)("ripple");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(g,{class:"card"},{default:(0,a.w5)((()=>[(0,a.Wm)(u,{bordered:""},{default:(0,a.w5)((()=>[(0,a.wy)((0,a.Wm)(h,{class:"q-my-sm",clickable:"",onClick:t[0]||(t[0]=t=>e.$emit("toggleBook"))},{default:(0,a.w5)((()=>[(0,a.Wm)(d,{avatar:""},{default:(0,a.w5)((()=>[(0,a.Wm)(n,{color:"black","text-color":"white"},{default:(0,a.w5)((()=>[(0,a.Wm)(l,{name:"vrpano"})])),_:1})])),_:1}),(0,a.Wm)(d,null,{default:(0,a.w5)((()=>[(0,a.Wm)(c,null,{default:(0,a.w5)((()=>[ee])),_:1})])),_:1})])),_:1},512),[[f,void 0,void 0,{early:!0}]]),(0,a.wy)((0,a.Wm)(h,{class:"q-my-sm",tag:"label",clickable:""},{default:(0,a.w5)((()=>[(0,a.Wm)(d,{avatar:""},{default:(0,a.w5)((()=>[(0,a.Wm)(n,{color:"black","text-color":"white"},{default:(0,a.w5)((()=>[(0,a.Wm)(l,{name:"dark_mode"})])),_:1})])),_:1}),(0,a.Wm)(d,null,{default:(0,a.w5)((()=>[(0,a.Wm)(c,null,{default:(0,a.w5)((()=>[te])),_:1})])),_:1}),(0,a.Wm)(d,{avatar:""},{default:(0,a.w5)((()=>[(0,a.Wm)(p,{modelValue:i.darkMode,"onUpdate:modelValue":t[1]||(t[1]=e=>i.darkMode=e),color:"black","keep-color":""},null,8,["modelValue"])])),_:1})])),_:1},512),[[f,void 0,void 0,{early:!0}]]),(0,a.wy)((0,a.Wm)(h,{class:"q-my-sm",clickable:"",onClick:t[2]||(t[2]=e=>i.hotkeysDialog=!0)},{default:(0,a.w5)((()=>[(0,a.Wm)(d,{avatar:""},{default:(0,a.w5)((()=>[(0,a.Wm)(n,{color:"black","text-color":"white"},{default:(0,a.w5)((()=>[(0,a.Wm)(l,{name:"info"})])),_:1})])),_:1}),(0,a.Wm)(d,null,{default:(0,a.w5)((()=>[(0,a.Wm)(c,null,{default:(0,a.w5)((()=>[oe])),_:1})])),_:1})])),_:1},512),[[f,void 0,void 0,{early:!0}]]),(0,a.wy)((0,a.Wm)(h,{class:"q-my-sm",clickable:"",onClick:t[3]||(t[3]=t=>e.$emit("searchDictionary"))},{default:(0,a.w5)((()=>[(0,a.Wm)(d,{avatar:""},{default:(0,a.w5)((()=>[(0,a.Wm)(n,{color:"black","text-color":"white"},{default:(0,a.w5)((()=>[(0,a.Wm)(l,{name:"translate"})])),_:1})])),_:1}),(0,a.Wm)(d,null,{default:(0,a.w5)((()=>[(0,a.Wm)(c,null,{default:(0,a.w5)((()=>[ae])),_:1})])),_:1})])),_:1},512),[[f,void 0,void 0,{early:!0}]]),o.purchaseAble?(0,a.wy)(((0,a.wg)(),(0,a.j4)(h,{key:0,class:"q-my-sm",clickable:"",onClick:t[4]||(t[4]=t=>e.$emit("purchase"))},{default:(0,a.w5)((()=>[(0,a.Wm)(d,{avatar:""},{default:(0,a.w5)((()=>[(0,a.Wm)(n,{color:"black","text-color":"white"},{default:(0,a.w5)((()=>[(0,a.Wm)(l,{name:"shopping_cart"})])),_:1})])),_:1}),(0,a.Wm)(d,null,{default:(0,a.w5)((()=>[(0,a.Wm)(c,null,{default:(0,a.w5)((()=>[se])),_:1})])),_:1})])),_:1},512)),[[f,void 0,void 0,{early:!0}]]):e.$store.getters["user/isLoggedIn"]?(0,a.kq)("",!0):(0,a.wy)(((0,a.wg)(),(0,a.j4)(h,{key:1,class:"q-my-sm",clickable:"",onClick:t[5]||(t[5]=t=>e.$router.push({name:"home-sign-up"}))},{default:(0,a.w5)((()=>[(0,a.Wm)(d,{avatar:""},{default:(0,a.w5)((()=>[(0,a.Wm)(n,{color:"black","text-color":"white"},{default:(0,a.w5)((()=>[(0,a.Wm)(l,{name:"login"})])),_:1})])),_:1}),(0,a.Wm)(d,null,{default:(0,a.w5)((()=>[(0,a.Wm)(c,null,{default:(0,a.w5)((()=>[ie])),_:1})])),_:1})])),_:1},512)),[[f,void 0,void 0,{early:!0}]])])),_:1})])),_:1}),(0,a.Wm)(m,{open:i.hotkeysDialog,hotkeys:i.hotkeys,onClose:t[6]||(t[6]=e=>i.hotkeysDialog=!1)},null,8,["open","hotkeys"])],64)}(0,a.Cn)();var le=o(6866);const ne=[[{keys:["Ctrl","F11"],condition:"",result:"Activate Zen Mode",header:"Global"},{keys:["Ctrl","B"],condition:"",result:"Toggle Side Bar"},{keys:["Ctrl","C"],condition:"",result:"Toggle Rest & Chill"},{keys:["Ctrl","/"],condition:"",result:"Search Dictionary"},{keys:["Ctrl","I"],condition:"",result:"Toggle Reader Settings"}],[{keys:["&#8595;"],condition:"",result:"Turn Next Page",header:"Accessiblity (Book)"},{keys:["&#8593;"],condition:"",result:"Turn Previous Page"},{keys:["&#8594;"],condition:"",result:"Turn Next Page"},{keys:["&#8592;"],condition:"",result:"Turn Previous Page"}]],de={name:"ReaderSettings",components:{HotKeysInfoDialog:le.Z},props:{purchaseAble:{type:Boolean,default:!1}},data(){return{hotkeysDialog:!1,hotkeys:ne,darkMode:this.$q.dark.isActive}},watch:{darkMode:function(e){this.$emit("themeChanged"),1==e?this.$q.dark.set(!0):this.$q.dark.set(!1),this.$q.localStorage.set("darkMode",this.$q.dark.isActive)}},methods:{}};var ce=o(151),he=o(7011),pe=o(3414),ue=o(2035),ge=o(5096),me=o(4554),fe=o(2350),ke=o(8886),ye=o(6489);de.render=re,de.__scopeId="data-v-0d70c61d";const be=de;F()(de,"components",{QCard:ce.Z,QList:he.Z,QItem:pe.Z,QItemSection:ue.Z,QAvatar:ge.Z,QIcon:me.Z,QItemLabel:fe.Z,QToggle:ke.Z}),F()(de,"directives",{Ripple:ye.Z}),(0,a.dD)("data-v-d793e30c");const ve={class:"result-container"},we={class:"result"},_e={class:"result-definition"},$e={key:0,class:"result-examples"},Ce=(0,a._)("h4",null,"Examples",-1),xe={key:1,class:"result-synonyms"},qe=(0,a._)("span",null,"Synonyms:",-1);function Se(e,t,o,s,r,l){const n=(0,a.up)("prompt-dialog"),d=(0,a.up)("q-card-section"),c=(0,a.up)("swiper-slide"),h=(0,a.up)("swiper"),p=(0,a.up)("q-btn"),u=(0,a.up)("q-card-actions"),g=(0,a.up)("q-card"),m=(0,a.up)("q-dialog"),f=(0,a.Q2)("close-popup");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(n,{open:r.searchDialog,label:"Dictionary",caption:"Word To Search",value:"",onConfirmed:l.search},null,8,["open","onConfirmed"]),(0,a.Wm)(m,{modelValue:r.resultDialog,"onUpdate:modelValue":t[0]||(t[0]=e=>r.resultDialog=e)},{default:(0,a.w5)((()=>[(0,a.Wm)(g,{class:"result-card"},{default:(0,a.w5)((()=>[(0,a.Wm)(d,{class:"result-word"},{default:(0,a.w5)((()=>[(0,a._)("h3",null,(0,i.zw)(l.capitalizeFirstLetter(r.searchWord)),1)])),_:1}),(0,a.Wm)(d,null,{default:(0,a.w5)((()=>[(0,a.Wm)(h,{modules:r.modules,"slides-per-view":1,"space-between":0,centeredSlides:!1,navigation:!0,pagination:{clickable:!0},keyboard:{enabled:!0},simulateTouch:!0},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(r.result,((e,t)=>((0,a.wg)(),(0,a.j4)(c,{key:t},{default:(0,a.w5)((()=>[(0,a._)("div",ve,[(0,a._)("div",we,[(0,a._)("div",_e," ("+(0,i.zw)(e.pos)+") "+(0,i.zw)(l.capitalizeFirstLetter(e.definition)),1),e.examples.length>0?((0,a.wg)(),(0,a.iD)("div",$e,[Ce,((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.examples,((e,t)=>((0,a.wg)(),(0,a.iD)("p",{key:t},(0,i.zw)(e),1)))),128))])):(0,a.kq)("",!0),e.synonyms.length>0?((0,a.wg)(),(0,a.iD)("div",xe,[(0,a._)("h4",null,[qe,(0,a.Uk)(" "+(0,i.zw)(e.synonyms.join(", ")),1)])])):(0,a.kq)("",!0)])])])),_:2},1024)))),128))])),_:1},8,["modules"])])),_:1}),(0,a.Wm)(u,{align:"right"},{default:(0,a.w5)((()=>[(0,a.wy)((0,a.Wm)(p,{outline:"",ripple:{early:!0},label:"Close"},null,512),[[f]])])),_:1})])),_:1})])),_:1},8,["modelValue"])],64)}(0,a.Cn)();var We=o(1832),De=o(3083),Te=o(9319);const Pe={name:"Dictionary",components:{PromptDialog:We.Z,Swiper:Te.t,SwiperSlide:Te.o},data(){return{searchDialog:!1,resultDialog:!1,searchWord:"",result:[],modules:[De.W_,De.tl,De.N1,De.s5]}},methods:{openSearchDialog(){this.searchDialog=!this.searchDialog},async search(e){if(this.searchDialog=!1,e){this.searchWord=e;let t=await this.$api.post("users/dictionary",{word:e});this.result=t.data.result,this.resultDialog=!0}},capitalizeFirstLetter(e){return e.charAt(0).toUpperCase()+e.slice(1)}}};var Ae=o(6778),Be=o(5589),Ne=o(9367),Le=o(8240),Me=o(677);Pe.render=Se,Pe.__scopeId="data-v-d793e30c";const Ie=Pe;F()(Pe,"components",{QDialog:Ae.Z,QCard:ce.Z,QCardSection:Be.Z,QCardActions:Ne.Z,QBtn:Le.Z}),F()(Pe,"directives",{ClosePopup:Me.Z});const Fe={components:{Book:R,Drawer:G,SideBarContents:J.Z,ReaderSettings:be,Dictionary:Ie,SplashScreen:m.Z},name:"ReadBook",data(){return{headerShow:!0,info:!0,text:"",navigations:[{name:"Front Matters",data:[]},{name:"Chapters",data:[]},{name:"Back Matters",data:[]}],sideBarClasses:{"side-bar--dark":!1},purchaseAble:!1,overflow:"hidden",settingsDialog:!1,bookcss:"",darkMode:this.$q.dark.isActive}},watch:{"$q.dark.isActive":function(e){this.sideBarClasses["side-bar--dark"]=!!e}},computed:{btnColor(){let e="";return e=this.$q.dark.isActive?"white":"black",e},videoURL(){let e="";return e=this.$q.dark.isActive?"https://storage.googleapis.com/bookkay-dev.appspot.com/reader_videos/background--dark.mp4":"https://storage.googleapis.com/bookkay-dev.appspot.com/reader_videos/background.mp4",e}},mounted(){this.info=!this.$q.localStorage.getItem("readerInfo");let e=this;document.body.addEventListener("keydown",(function(t){t.ctrlKey&&"F11"==t.key&&e.toggleZen(),t.ctrlKey&&"b"==t.key&&e.toggleDrawer(),t.ctrlKey&&"c"==t.key&&e.toggleBook(),t.ctrlKey&&"/"==t.key&&e.searchDictionary(),t.ctrlKey&&"i"==t.key&&(e.settingsDialog=!e.settingsDialog)}),!1),this.$q.localStorage.has("darkMode")&&this.$q.dark.set(this.$q.localStorage.getItem("darkMode")),this.checkPurchaseAble()},methods:{toggleZen(){this.$q.fullscreen.toggle().then((()=>{})).catch((e=>{alert(e)})),this.headerShow=!1},toggleDrawer(){this.$refs.drawer.active?this.$refs.drawer.close():this.$refs.drawer.open()},searchDictionary(){this.$refs.dictionary.openSearchDialog()},checkPurchaseAble(){if(this.$store.getters["user/isLoggedIn"]){let e,t=this.$store.getters["user/userProperty"]("books_purchased"),o=this.$store.getters["user/userProperty"]("books_authored");if(!("book_id"in this.$route.query))return this.purchaseAble=!1,"";e=this.$route.query.book_id;let a=t.some((t=>t.id===e)),s=o.some((t=>t.id===e));this.purchaseAble=!a&&!s}else this.purchaseAble=!1},async purchase(){try{await this.$api.post(`books/${this.$route.query.book_id}/purchase`);let e=await this.$api.get("users/"+this.$store.getters["user/userProperty"]("id"),{params:{expand:"~all"}});const t=e.data;this.$store.commit("user/setUser",t),this.$q.localStorage.set("user",t),this.$q.notify({color:"positive",position:"top",message:"You have successfully bought the book. Hope you enjoy it.",icon:"error"})}catch(e){this.$q.notify({color:"negative",position:"top",message:"Error when purchasing book",icon:"error"})}this.checkPurchaseAble()},reloadsBook(){this.$refs.book.loadPageFlip()},onClick(){this.bookcss=""},toggleBook(){""==this.bookcss?(this.bookcss="book-leave",this.headerShow=!1,this.settingsDialog=!1,this.$q.fullscreen.request()):this.bookcss=""},addNav(e){switch(e["type"]){case"book":this.navigations.unshift(e);break;case"front_matter":let t=this.navigations.find((e=>"Front Matters"===e.name));t.data.push(e);break;case"chapter":let o=this.navigations.find((e=>"Chapters"===e.name));o.data.push(e);break;case"back_matter":let a=this.navigations.find((e=>"Back Matters"===e.name));a.data.push(e);break;default:}},navClicked(e){this.$refs.book.$refs.flipbook.flip(e.page)},handleSelected(){null==this.selected?this.selected=this.currentSelected:(this.currentSelected=this.selected,this.headerShow=!1,this.$refs.book.$refs.flipbook.flip(this.currentSelected))},handleSwipe(e){"top"==e?headerShow=!1:"down"==e&&(headerShow=!0)}},beforeRouteUpdate(e,t,o){this.navigations=[],o()},beforeRouteLeave(e,t,o){this.overflow="auto",o()},beforeUnmount(){this.$q.sessionStorage.has("currentManuscript")&&this.$q.sessionStorage.remove("currentManuscript"),this.$q.sessionStorage.has("currentBook")&&this.$q.sessionStorage.remove("currentBook"),this.$q.dark.set(!1)}};var Ze=o(614);Fe.render=g,Fe.__scopeId="data-v-c2afbd5e";const Ee=Fe;F()(Fe,"components",{QAjaxBar:Ze.Z,QDialog:Ae.Z,QBtn:Le.Z,QAvatar:ge.Z})}}]);