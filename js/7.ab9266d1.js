(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[7],{"153d":function(t,e,r){},"247a":function(t,e,r){"use strict";r.r(e);var a=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("q-page",{staticClass:"flex"},[r("div",{staticClass:"col"},[t.$store.getters["write/manuscriptProperty"]("configs").contain_front_matter?r("chapters-list",{attrs:{type:"front-matter"}}):t._e(),t.$store.getters["write/manuscriptProperty"]("configs").contain_chapter?r("chapters-list",{attrs:{type:"chapter"}}):r("q-btn",{staticClass:"q-ma-md",attrs:{label:"Edit main body text",icon:"edit",color:"primary",to:{name:"write-editor",query:{manuscript:t.$store.getters["write/manuscriptProperty"]("id")}}}}),t.$store.getters["write/manuscriptProperty"]("configs").contain_back_matter?r("chapters-list",{attrs:{type:"back-matter"}}):t._e(),t.$store.getters["write/manuscriptProperty"]("configs").contain_front_matter||t.$store.getters["write/manuscriptProperty"]("configs").contain_chapter||t.$store.getters["write/manuscriptProperty"]("configs").contain_back_matter?r("add-chapter-button"):t._e()],1)])},i=[],s=r("ded3"),n=r.n(s),o=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("q-page-sticky",{attrs:{position:"bottom-right",offset:[30,18]}},[r("q-fab",{attrs:{icon:"add",size:"md",direction:"up",color:"primary"}},[t.$store.getters["write/manuscriptProperty"]("configs").contain_back_matter?r("q-fab-action",{attrs:{color:"primary",label:"BackMatter"},on:{click:function(e){t.type="Back Matter",t.add_chapter=!0}}}):t._e(),t.$store.getters["write/manuscriptProperty"]("configs").contain_chapter?r("q-fab-action",{attrs:{color:"primary",label:"Chapter"},on:{click:function(e){t.type="Chapter",t.add_chapter=!0}}}):t._e(),t.$store.getters["write/manuscriptProperty"]("configs").contain_front_matter?r("q-fab-action",{attrs:{color:"primary",label:"FrontMatter"},on:{click:function(e){t.type="Front Matter",t.add_chapter=!0}}}):t._e()],1)],1),r("q-dialog",{ref:"chapterDialog",attrs:{persistent:""},model:{value:t.add_chapter,callback:function(e){t.add_chapter=e},expression:"add_chapter"}},[r("q-card",{staticStyle:{width:"700px","max-width":"80vw"}},[r("q-card-section",[r("div",{staticClass:"text-h6"},[t._v("Title")])]),r("q-card-section",{staticClass:"q-pt-none"},[r("q-input",{ref:"titleInput",attrs:{dense:"",placeholder:t.titlePlaceholder,rules:[function(t){return null!==t&&""!==t||"Please type the title"},function(t){return t.length<=100||"Title must be smaller than 100"}],autofocus:"",autogrow:""},on:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:(e.preventDefault(),t.$refs.draftInput.focus())}},model:{value:t.chapter.title,callback:function(e){t.$set(t.chapter,"title",e)},expression:"chapter.title"}})],1),r("q-card-section",[r("div",{staticClass:"text-h6"},[t._v("Draft")])]),r("q-card-section",{staticClass:"q-pt-none"},[r("q-input",{ref:"draftInput",attrs:{dense:"",placeholder:t.draftPlaceholder,autogrow:""},model:{value:t.chapter.draft,callback:function(e){t.$set(t.chapter,"draft",e)},expression:"chapter.draft"}})],1),r("q-card-actions",{staticClass:"text-primary",attrs:{align:"right"}},[r("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Cancel"},on:{click:function(e){t.chapter.title="",t.chapter.draft="",t.type=""}}}),r("q-btn",{attrs:{flat:"",label:"Confirm"},on:{click:t.add}})],1)],1)],1)],1)},c=[],p=(r("ac1f"),r("5319"),{name:"AddChapterButton",data:function(){return{chapter:{title:"",draft:"",index:0,text:"",manuscript_id:this.$store.getters["write/manuscriptProperty"]("id")},type:"",add_chapter:!1}},computed:{titlePlaceholder:function(){return"Title of this "+this.type.toLowerCase()+"?"},draftPlaceholder:function(){return"What shall I include in this "+this.type.toLowerCase()+"?"}},methods:{add:function(){var t=this;if(this.$refs.titleInput.validate(),this.$refs.draftInput.validate(),!this.$refs.titleInput.hasError&&!this.$refs.draftInput.hasError){this.chapter.index=this.$store.getters["write/manuscriptProperty"](this.type.toLowerCase().replace(" ","_")+"s").length;var e={chapter:this.chapter,type:this.type};this.$store.dispatch("write/addChapter",e).then((function(t){})).catch((function(e){t.$q.notify({color:"negative",position:"top",message:e.response.data.message||"Something went wrong",icon:"error"})})),this.chapter.title="",this.chapter.draft="",this.type="",this.$refs.chapterDialog.hide()}}}}),l=p,d=r("2877"),h=r("de5e"),u=r("c294"),f=r("72db"),m=r("24e8"),g=r("f09f"),y=r("a370"),v=r("27f9"),b=r("4b7e"),_=r("9c40"),C=r("7f67"),w=r("eebe"),q=r.n(w),$=Object(d["a"])(l,o,c,!1,null,null,null),x=$.exports;q()($,"components",{QPageSticky:h["a"],QFab:u["a"],QFabAction:f["a"],QDialog:m["a"],QCard:g["a"],QCardSection:y["a"],QInput:v["a"],QCardActions:b["a"],QBtn:_["a"]}),q()($,"directives",{ClosePopup:C["a"]});var k=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("div",{staticClass:"row q-ml-md"},[r("h2",{staticClass:"q-mb-md text-capitalize"},[t._v(t._s(t.type.split("-").join(" ")))])]),r("q-separator",{attrs:{inset:""}}),r("div",{staticClass:"row q-ml-md"},[r("q-btn",{attrs:{icon:"reorder",label:"Reorder",color:"positive"},on:{click:function(e){t.reorder=!0}}})],1),r("div",{staticClass:"q-mt-md row"},t._l(this.chapters,(function(e){return r("chapter",{key:e.id,staticClass:"col-md-3 col-sm-6 col-xs-12",class:t.alignment,attrs:{chapter:e,type:t.$props.type},on:{titleEditted:t.editTitle,draftEditted:t.editDraft,deleted:t.deleteChapter}})})),1),r("q-dialog",{ref:"reorderDialog",attrs:{persistent:""},model:{value:t.reorder,callback:function(e){t.reorder=e},expression:"reorder"}},[r("q-card",{staticStyle:{"min-width":"350px"}},[r("q-card-section",[r("div",{staticClass:"text-h4 text-capitalize"},[t._v("\n          "+t._s(t.type.split("-").join(" "))+"s\n        ")])]),r("q-card-section",{staticClass:"q-pt-none"},[r("list-draggable",{attrs:{items:t.chaptersCopy,dataName:"title"},on:{dropped:t.handleDrop}})],1),r("q-card-actions",{staticClass:"text-primary",attrs:{align:"right"}},[r("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Cancel"},on:{click:function(e){t.chaptersCopy=t.chapters}}}),r("q-btn",{attrs:{flat:"",label:"Confirm"},on:{click:t.confirmOrder}})],1)],1)],1)],1)},D=[],P=(r("4e82"),r("a434"),r("7db0"),function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("q-card",{staticClass:"normal-card q-mb-md"},[r("q-card-section",[r("div",{staticClass:"items-center no-wrap"},[r("div",{directives:[{name:"ripple",rawName:"v-ripple"}],staticClass:"text-h6 ellipsis relative-position q-mb-sm q-pl-sm",on:{click:function(e){t.edit_title=!0}}},[t._v("\n          Title:\n          "),r("span",{staticClass:"text-body1 q-pa-sm text"},[t._v(t._s(t.chapter.title))])]),r("div",{directives:[{name:"ripple",rawName:"v-ripple"}],staticClass:"text-h6 relative-position q-mb-sm q-pl-sm",on:{click:function(e){t.edit_draft=!0}}},[t._v("\n          Draft:\n          "),r("div",{staticClass:"text-body1 text"},[t._v("\n            "+t._s(t.chapter.draft)+"\n          ")])])])]),r("q-card-actions",{staticClass:"justify-end"},[r("div",{staticClass:"row"},[r("q-btn",{attrs:{icon:"delete",color:"negative",round:"",flat:""},on:{click:function(e){t.confirm_delete=!0}}})],1),r("div",{staticClass:"row"},[r("q-btn",{staticClass:"q-ml-md",attrs:{label:"Edit",color:"primary"},on:{click:t.edit}})],1)])],1),r("q-dialog",{ref:"titleDialog",attrs:{persistent:""},model:{value:t.edit_title,callback:function(e){t.edit_title=e},expression:"edit_title"}},[r("q-card",{staticStyle:{"min-width":"350px"}},[r("q-card-section",[r("div",{staticClass:"text-h6"},[t._v("Title")])]),r("q-card-section",{staticClass:"q-pt-none"},[r("q-input",{ref:"titleInput",attrs:{dense:"",rules:[function(t){return null!==t&&""!==t||"Please type the title"},function(t){return t.length<=100||"Title must be smaller than 100"}],autofocus:"",autogrow:""},on:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:(e.preventDefault(),t.confirmTitle(e))}},model:{value:t.new_title,callback:function(e){t.new_title=e},expression:"new_title"}})],1),r("q-card-actions",{staticClass:"text-primary",attrs:{align:"right"}},[r("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Cancel"},on:{click:function(e){t.new_title=t.$props.chapter.title}}}),r("q-btn",{attrs:{flat:"",label:"Confirm"},on:{click:t.confirmTitle}})],1)],1)],1),r("q-dialog",{ref:"draftDialog",attrs:{persistent:""},model:{value:t.edit_draft,callback:function(e){t.edit_draft=e},expression:"edit_draft"}},[r("q-card",{staticStyle:{"min-width":"350px"}},[r("q-card-section",[r("div",{staticClass:"text-h6"},[t._v("Draft")])]),r("q-card-section",{staticClass:"q-pt-none"},[r("q-input",{ref:"draftInput",attrs:{dense:"",autofocus:"",autogrow:""},model:{value:t.new_draft,callback:function(e){t.new_draft=e},expression:"new_draft"}})],1),r("q-card-actions",{staticClass:"text-primary",attrs:{align:"right"}},[r("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Cancel"},on:{click:function(e){t.new_draft=t.$props.chapter.draft}}}),r("q-btn",{attrs:{flat:"",label:"Confirm"},on:{click:t.confirmDraft}})],1)],1)],1),r("q-dialog",{ref:"deleteDialog",attrs:{persistent:""},model:{value:t.confirm_delete,callback:function(e){t.confirm_delete=e},expression:"confirm_delete"}},[r("q-card",[r("q-card-section",{staticClass:"row items-center"},[r("span",{staticClass:"q-ml-sm"},[t._v("Are you sure you want delete? All related data of the chapter\n          (including child sections if present) will be lost")])]),r("q-card-actions",{attrs:{align:"right"}},[r("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Cancel",color:"primary"}}),r("q-btn",{attrs:{flat:"",icon:"delete",label:"Delete",color:"negative"},on:{click:t.confirmDelete}})],1)],1)],1)],1)}),Q=[],I={name:"Chapter",props:{chapter:{type:Object,required:!0},type:{type:String,required:!0}},data:function(){return{new_title:this.$props.chapter.title,new_draft:this.$props.chapter.draft,edit_title:!1,edit_draft:!1,edit_all:!1,confirm_delete:!1}},methods:{confirmTitle:function(){var t=this;if(this.$refs.titleInput.validate(),!this.$refs.titleInput.hasError){var e=this.$props.chapter.title;this.$emit("titleEditted",this.new_title,this.$props.chapter);var r={chapter:{title:this.new_title},id:this.$props.chapter.id,type:this.$props.type};this.$store.dispatch("write/editChapter",r).then((function(t){})).catch((function(r){t.$emit("titleEditted",e,t.$props.chapter),t.$q.notify({color:"negative",position:"top",message:r.response.data.message||"Something went wrong",icon:"error"})})),this.$refs.titleDialog.hide()}},confirmDraft:function(){var t=this;if(this.$refs.draftInput.validate(),!this.$refs.draftInput.hasError){var e=this.$props.chapter.draft;this.$emit("draftEditted",this.new_draft,this.$props.chapter);var r={chapter:{draft:this.new_draft},id:this.$props.chapter.id,type:this.$props.type};this.$store.dispatch("write/editChapter",r).then((function(t){})).catch((function(r){t.$emit("titleEditted",e,t.$props.chapter),t.$q.notify({color:"negative",position:"top",message:r.response.data.message||"Something went wrong",icon:"error"})})),this.$refs.draftDialog.hide()}},confirmDelete:function(){this.$emit("deleted",this.chapter),this.$refs.deleteDialog.hide()},edit:function(){switch(this.$props.type){case"front-matter":this.$router.push({name:"write-editor",query:{front_matter:this.$props.chapter.id}});break;case"chapter":this.$router.push({name:"write-editor",query:{chapter:this.$props.chapter.id}});break;case"back-matter":this.$router.push({name:"write-editor",query:{back_matter:this.$props.chapter.id}});break}}}},E=I,S=(r("e4a8"),r("714f")),j=Object(d["a"])(E,P,Q,!1,null,"9da7db6e",null),O=j.exports;q()(j,"components",{QCard:g["a"],QCardSection:y["a"],QCardActions:b["a"],QBtn:_["a"],QDialog:m["a"],QInput:v["a"]}),q()(j,"directives",{Ripple:S["a"],ClosePopup:C["a"]});var T=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"simple-page"},[r("Container",{attrs:{"lock-axis":"y"},on:{drop:t.onDrop}},t._l(t.itemsCopy,(function(e){return r("Draggable",{key:e.id},[r("div",{staticClass:"draggable-item"},[t._v("\n        "+t._s(e[t.$props.dataName])+"\n      ")])])})),1)],1)},N=[],A=r("448a"),B=r.n(A),L=r("3f7d"),R={name:"ListDraggable",components:{Container:L["Container"],Draggable:L["Draggable"]},props:{items:{type:Array,required:!0},dataName:{type:String,default:"data"}},data:function(){return{itemsCopy:this.$props.items}},methods:{onDrop:function(t){this.itemsCopy=this.applyDrag(this.itemsCopy,t),this.$emit("dropped",this.itemsCopy)},applyDrag:function(t,e){var r=e.removedIndex,a=e.addedIndex,i=e.payload;if(null===r&&null===a)return t;var s=B()(t),n=i;return null!==r&&(n=s.splice(r,1)[0]),null!==a&&s.splice(a,0,n),s}}},F=R,M=(r("3241"),Object(d["a"])(F,T,N,!1,null,"65c93e26",null)),W=M.exports,z={components:{Chapter:O,ListDraggable:W},mounted:function(){this.chaptersCopy=this.chapters},props:{type:{type:String,required:!0}},data:function(){return{chaptersCopy:[],reorder:!1}},computed:{copyChapters:function(){for(var t=[],e=0;e<this.chaptersCopy.length;e++){var r=this.chaptersCopy[e];t.push({id:r.id,data:r.title,draft:r.draft,text:r.text,index:r.index})}return t},chapters:function(){var t=null;switch(this.$props.type){case"chapter":t=this.$store.getters["write/manuscriptProperty"]("chapters");break;case"front-matter":t=this.$store.getters["write/manuscriptProperty"]("front_matters");break;case"back-matter":t=this.$store.getters["write/manuscriptProperty"]("back_matters");break;case"section":break;default:}return t.sort(this.compareIndex),t},alignment:function(){return this.$q.screen.lt.md?"justify-center":"justify-start"}},methods:{compareIndex:function(t,e){return t.index<e.index?-1:t.index>e.index?1:0},editTitle:function(t,e){e.title=t},editDraft:function(t,e){e.draft=t},deleteChapter:function(t){var e=this,r=this.chapters.indexOf(t);this.chapters.splice(r,1);var a={id:t.id,type:this.$props.type};this.$store.dispatch("write/deleteChapter",a).then((function(t){})).catch((function(a){e.$q.notify({color:"negative",position:"top",message:a.response.data.message||"Something went wrong",icon:"error"}),e.chapters.splice(r,0,t)}))},confirmOrder:function(){for(var t=this,e=function(){var e=t.chapters[r],a=t.chaptersCopy.find((function(t){return t.id===e.id}));if(e.index!=a.index){var i={chapter:{index:a.index,manuscript_id:t.$store.getters["write/manuscriptProperty"]("id")},type:t.$props.type,id:e.id};t.$store.dispatch("write/editChapter",i).then((function(t){})).catch((function(e){t.$q.notify({color:"negative",position:"top",message:e.response.data.message||"Something went wrong",icon:"error"})}))}},r=0;r<this.chapters.length;r++)e();this.$refs.reorderDialog.hide()},handleDrop:function(t){for(var e=0;e<t.length;e++)t[e].index=e+1;this.chaptersCopy=t}}},H=z,J=r("eb85"),G=Object(d["a"])(H,k,D,!1,null,null,null),K=G.exports;q()(G,"components",{QSeparator:J["a"],QBtn:_["a"],QDialog:m["a"],QCard:g["a"],QCardSection:y["a"],QCardActions:b["a"]}),q()(G,"directives",{ClosePopup:C["a"]});var U=r("2f62"),V={components:{ChaptersList:K,AddChapterButton:x},name:"ChapterPage",computed:n()({},Object(U["b"])({count:function(t){return t.module.count}})),data:function(){return{front_matters:[{id:"123",title:"He Returns",draft:"Write about how he returns"}],chapters:[{id:"123",title:"He Returns",draft:"Write about how he returns"}],back_matters:[{id:"123",title:"He Returns",draft:"Write about how he returns"}]}},methods:{}},X=V,Y=r("9989"),Z=Object(d["a"])(X,a,i,!1,null,null,null);e["default"]=Z.exports;q()(Z,"components",{QPage:Y["a"],QBtn:_["a"]})},3241:function(t,e,r){"use strict";r("6a2f")},"6a2f":function(t,e,r){},e4a8:function(t,e,r){"use strict";r("153d")}}]);