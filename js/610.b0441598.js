"use strict";(self["webpackChunkbookkay"]=self["webpackChunkbookkay"]||[]).push([[610],{5494:(e,t,i)=>{i.r(t),i.d(t,{default:()=>S});var a=i(3673),o=i(2323);const r=e=>((0,a.dD)("data-v-63a1c034"),e=e(),(0,a.Cn)(),e),l={class:"book-covers-container"},n={class:"book-covers"},s={class:"list-container"},c=r((()=>(0,a._)("div",{class:"text-h6"},"Configs",-1))),p=(0,a.Uk)(" Contain Front Matter: "),u=(0,a.Uk)(" Contain Chapter: "),d=(0,a.Uk)(" Contain Back Matter: ");function m(e,t,i,r,m,h){const g=(0,a.up)("image-uploader"),f=(0,a.up)("q-item-label"),b=(0,a.up)("q-item-section"),y=(0,a.up)("q-icon"),D=(0,a.up)("q-item"),w=(0,a.up)("q-separator"),v=(0,a.up)("q-list"),k=(0,a.up)("q-card-section"),$=(0,a.up)("q-toggle"),C=(0,a.up)("q-btn"),_=(0,a.up)("q-card-actions"),P=(0,a.up)("q-card"),U=(0,a.up)("q-dialog"),q=(0,a.up)("prompt-dialog"),H=(0,a.up)("confirm-dialog"),W=(0,a.up)("q-page"),Z=(0,a.Q2)("ripple"),M=(0,a.Q2)("close-popup");return(0,a.wg)(),(0,a.j4)(W,null,{default:(0,a.w5)((()=>[(0,a._)("div",l,[(0,a._)("div",n,[(0,a.Wm)(g,{img:h.frontCover,url:h.getFrontCoverURL,label:"Front Cover",class:"front-cover",onUploaded:h.uploadHandler,onClear:h.clearHandler},null,8,["img","url","onUploaded","onClear"]),(0,a.Wm)(g,{img:h.backCover,url:h.getBackCoverURL,label:"Back Cover",class:"back-cover",onUploaded:h.uploadHandler,onClear:h.clearHandler},null,8,["img","url","onUploaded","onClear"])])]),(0,a._)("div",s,[(0,a.Wm)(v,null,{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(h.fields,((e,t)=>((0,a.wg)(),(0,a.iD)("div",{key:t},[(0,a.wy)((0,a.Wm)(D,{clickable:"",style:{"border-radius":"30px"},onClick:e.clickHandler},{default:(0,a.w5)((()=>[(0,a.Wm)(b,null,{default:(0,a.w5)((()=>[(0,a.Wm)(f,null,{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(e.label),1)])),_:2},1024),(0,a.Wm)(f,{caption:"",lines:e.lines?e.lines:"2"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(e.value),1)])),_:2},1032,["lines"])])),_:2},1024),(0,a.Wm)(b,{side:""},{default:(0,a.w5)((()=>[(0,a.Wm)(y,{name:e.icon||"keyboard_arrow_right",color:e.color||"black"},null,8,["name","color"])])),_:2},1024)])),_:2},1032,["onClick"]),[[Z,void 0,void 0,{early:!0}]]),(0,a.Wm)(w,{spaced:"",inset:""})])))),128))])),_:1})]),(0,a.Wm)(U,{modelValue:m.configsDialog,"onUpdate:modelValue":t[3]||(t[3]=e=>m.configsDialog=e)},{default:(0,a.w5)((()=>[(0,a.Wm)(P,null,{default:(0,a.w5)((()=>[(0,a.Wm)(k,null,{default:(0,a.w5)((()=>[c])),_:1}),(0,a.Wm)(k,{class:"q-pt-none"},{default:(0,a.w5)((()=>[(0,a._)("div",null,[p,(0,a.Wm)($,{modelValue:m.containFrontMatter,"onUpdate:modelValue":t[0]||(t[0]=e=>m.containFrontMatter=e),color:"green","keep-color":""},null,8,["modelValue"])]),(0,a._)("div",null,[u,(0,a.Wm)($,{modelValue:m.containChapter,"onUpdate:modelValue":t[1]||(t[1]=e=>m.containChapter=e),color:"green","keep-color":""},null,8,["modelValue"])]),(0,a._)("div",null,[d,(0,a.Wm)($,{modelValue:m.containBackMatter,"onUpdate:modelValue":t[2]||(t[2]=e=>m.containBackMatter=e),color:"green","keep-color":""},null,8,["modelValue"])])])),_:1}),(0,a.Wm)(_,{align:"right"},{default:(0,a.w5)((()=>[(0,a.wy)((0,a.Wm)(C,{flat:"",label:"Ok",color:"primary",ripple:{early:!0}},null,512),[[M]])])),_:1})])),_:1})])),_:1},8,["modelValue"]),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(h.promptDialogs,((e,t)=>((0,a.wg)(),(0,a.j4)(q,{key:t,open:e.state,label:e.label,caption:e.caption,value:e.value,rules:e.rules,onConfirmed:e.confirmHandler},null,8,["open","label","caption","value","rules","onConfirmed"])))),128)),(0,a.Wm)(H,{open:m.confirmDialog.state,header:m.confirmDialog.label,text:m.confirmDialog.text,btnLabel:"Disable",btnColor:"red",onConfirmed:h.confirmConfigs},null,8,["open","header","text","onConfirmed"])])),_:1})}i(246),i(71),i(7280),i(5363);const h={key:0},g={key:1},f={class:"label"};function b(e,t,i,r,l,n){const s=(0,a.up)("q-uploader"),c=(0,a.up)("q-img"),p=(0,a.up)("confirm-dialog"),u=(0,a.Q2)("ripple");return""==i.img?((0,a.wg)(),(0,a.iD)("div",h,[(0,a.Wm)(s,{label:i.label,"auto-upload":"",url:i.url,accept:".jpg, .png, .gif","max-file-size":"5000000",color:"black","no-thumbnails":e.$q.screen.lt.sm,headers:n.getHeaders,onRejected:n.onRejected,onUploaded:n.onUploaded,class:"uploader"},null,8,["label","url","no-thumbnails","headers","onRejected","onUploaded"])])):((0,a.wg)(),(0,a.iD)("div",g,[(0,a.wy)((0,a.Wm)(c,{src:i.img,loading:"lazy","spinner-color":"white",fit:"cover",class:"img",onClick:t[0]||(t[0]=e=>l.confirmDialog=!0)},{default:(0,a.w5)((()=>[(0,a._)("div",f,(0,o.zw)(i.label),1)])),_:1},8,["src"]),[[u,void 0,void 0,{early:!0}]]),(0,a.Wm)(p,{open:l.confirmDialog,header:`Reupload ${i.label} image?`,btnLabel:"Reupload",btnColor:"green",onConfirmed:n.confirmHandler},null,8,["open","header","onConfirmed"])]))}var y=i(8531);const D={name:"ImageUploader",components:{ConfirmDialog:y.Z},props:{img:{type:String,default:""},label:{type:String,default:""},url:{type:String,default:""}},data(){return{confirmDialog:!1}},methods:{onRejected(e){for(let t=0;t<e.length;t++){const i=e[t];this.$q.notify({type:"negative",message:`${i.file.name} was rejected as it fails ${i.failedPropValidation.replaceAll("-"," ")} validation`})}},getHeaders(){let e=this.$api.defaults.headers.common,t=[];for(const i in e){let a={name:i,value:e[i]};t.push(a)}return t},onUploaded(e){this.$emit("uploaded",this.$props.label)},confirmHandler(e){this.confirmDialog=!1,e&&this.$emit("clear",this.$props.label)}}};var w=i(4260),v=i(2046),k=i(4027),$=i(6489),C=i(7518),_=i.n(C);const P=(0,w.Z)(D,[["render",b],["__scopeId","data-v-16cac466"]]),U=P;_()(D,"components",{QUploader:v.Z,QImg:k.Z}),_()(D,"directives",{Ripple:$.Z});var q=i(1832);const H={name:"OverviewPage",components:{PromptDialog:q.Z,ConfirmDialog:y.Z,ImageUploader:U},data(){return{price:"Free",containFrontMatter:!1,containChapter:!1,containBackMatter:!1,confirmDialog:{state:!1,label:"",text:"",data:"",externalData:""},titleDialog:!1,descriptionDialog:!1,configsDialog:!1,deleteDialog:!1,publishDialog:!1}},watch:{containFrontMatter:function(e){e?this.toggleConfigs({contain_front_matter:!0}):(this.confirmDialog["state"]=!0,this.confirmDialog["data"]="containFrontMatter",this.confirmDialog["externalData"]="contain_front_matter",this.confirmDialog["label"]="Diable Front Matters",this.confirmDialog["text"]="Are you sure you want to disable front matters? This will delete all your current front matters.")},containChapter:function(e){e?this.toggleConfigs({contain_chapter:!0}):(this.confirmDialog["state"]=!0,this.confirmDialog["data"]="containChapter",this.confirmDialog["externalData"]="contain_chapter",this.confirmDialog["label"]="Diable Chapters",this.confirmDialog["text"]="Are you sure you want to disable chapters? This will delete all your current chapters.")},containBackMatter:function(e){e?this.toggleConfigs({contain_back_matter:!0}):(this.confirmDialog["state"]=!0,this.confirmDialog["data"]="containBackMatter",this.confirmDialog["externalData"]="contain_back_matter",this.confirmDialog["label"]="Diable Back Matters",this.confirmDialog["text"]="Are you sure you want to disable back matters? This will delete all your current back matters.")},"$store.state.write.manuscript":{handler:function(e){null!=e&&(this.containFrontMatter=this.$store.getters["write/manuscriptProperty"]("configs").contain_front_matter,this.containChapter=this.$store.getters["write/manuscriptProperty"]("configs").contain_chapter,this.containBackMatter=this.$store.getters["write/manuscriptProperty"]("configs").contain_back_matter)}}},computed:{frontCover(){return this.$store.getters["write/manuscriptProperty"]("front_cover")},backCover(){return this.$store.getters["write/manuscriptProperty"]("back_cover")},title(){return this.$store.getters["write/manuscriptProperty"]("title")},description(){return this.$store.getters["write/manuscriptProperty"]("description")},authorName(){return this.$store.getters["user/userProperty"]("author_name")},getFrontCoverURL(){let e=`${this.$api.defaults.baseURL}manuscripts/${this.$store.getters["write/manuscriptProperty"]("id")}/front_cover`;return e},getBackCoverURL(){let e=`${this.$api.defaults.baseURL}manuscripts/${this.$store.getters["write/manuscriptProperty"]("id")}/back_cover`;return e},fields(){return[{label:"Title",value:this.title,clickHandler:this.changeTitle},{label:"Description",value:this.description,clickHandler:this.changeDescription},{label:"Author Name",value:this.authorName},{label:"Price",value:this.price},{label:"Edit Configs",clickHandler:this.editConfigs},{label:"Delete",icon:"delete",color:"red",clickHandler:this.delete},{label:"Publish",icon:"publish",color:"green",clickHandler:this.publish}]},promptDialogs(){return[{label:"Title",state:this.titleDialog,value:this.title,rules:[e=>null!==e&&""!==e||"Please type your title",e=>e.length<=100||"Title must be smaller than 100"],confirmHandler:this.confirmTitle},{label:"Description",state:this.descriptionDialog,value:this.description,rules:[e=>null!==e&&""!==e||"Please type your description"],confirmHandler:this.confirmDescription},{label:"Delete Confirmation",caption:`Are you sure you want to DELETE? After deleting all related data of this manuscript will be permanently lost. If you are confirmed, type in <b>${this.title}</b>`,state:this.deleteDialog,value:"",rules:[e=>null!==e&&""!==e||`Please type in ${this.title} to confirm`,e=>e==this.title||`Please type in ${this.title} to confirm`],confirmHandler:this.confirmDelete},{label:"Publish Confirmation",caption:`Are you sure you want to publish? After publishing you cannot edit or delete the book. If you are confirmed, type in <b>${this.title}</b>`,state:this.publishDialog,value:"",rules:[e=>null!==e&&""!==e||`Please type in ${this.title} to confirm`,e=>e==this.title||`Pleaseee type in ${this.title} to confirm`],confirmHandler:this.confirmPublish}]}},methods:{async uploadHandler(){let e=await this.$api.get("manuscripts/"+this.$store.state.write.manuscript.id,{params:{expand:"~all"}});this.$store.commit("write/updateManuscript",e.data),this.$q.sessionStorage.set("currentManuscript",this.$store.state.write.manuscript)},async clearHandler(e){let t;"Front Cover"==e?t="front_cover":"Back Cover"==e&&(t="back_cover");let i={};i[t]="";let a=this.$store.getters["write/manuscriptProperty"](t);try{await this.$api.delete(`manuscripts/${this.$store.getters["write/manuscriptProperty"]("id")}/${t}`,{params:{img:a}}),await this.$store.dispatch("write/editManuscript",i)}catch(o){this.$q.notify({color:"negative",position:"top",message:"Edit unsuccessful",icon:"error"})}},changeTitle(){this.titleDialog=!0},changeDescription(){this.descriptionDialog=!0},editConfigs(){this.configsDialog=!0},delete(){this.deleteDialog=!0},publish(){let e="",t=this.$store.getters["write/manuscriptProperty"]("front_cover"),i=this.$store.getters["write/manuscriptProperty"]("back_cover");""==t?e="Please add front cover of your book":""==i&&(e="Please add back cover of your book"),""!=e?this.$q.notify({color:"negative",position:"top",message:e,icon:"error"}):this.publishDialog=!0},async confirmConfigs(e){if(this.confirmDialog.state=!1,e){let e={};e[this.confirmDialog.externalData]=!1;let t=await this.toggleConfigs(e);t||(this[this.confirmDialog.data]=!0),this.deleteComponents(this.confirmDialog.externalData)}else this[this.confirmDialog.data]=!0},async toggleConfigs(e){try{return await this.$store.dispatch("write/editConfigs",e),!0}catch(t){return this.$q.notify({color:"negative",position:"top",message:"Edit unsuccessful",icon:"error"}),!1}},async deleteComponents(e){let t="";switch(e){case"contain_front_matter":t="front_matter";break;case"contain_chapter":t="chapter";break;case"contain_back_matter":t="back_matter";break;default:}let i={type:t},a=this.$store.getters["write/manuscriptProperty"](t);for(const o of a)i.id=o.id,await this.$store.dispatch("write/deleteComponent",i)},async confirmTitle(e){if(this.titleDialog=!1,e&&e!=this.title){let i={title:e};try{await this.$store.dispatch("write/editManuscript",i)}catch(t){this.$q.notify({color:"negative",position:"top",message:"Edit unsuccessful",icon:"error"})}}},async confirmDescription(e){if(this.descriptionDialog=!1,e&&e!=this.description){let i={description:e};try{await this.$store.dispatch("write/editManuscript",i)}catch(t){this.$q.notify({color:"negative",position:"top",message:"Edit unsuccessful",icon:"error"})}}},async confirmDelete(e){if(this.deleteDialog=!1,e)try{await this.$api.delete(`manuscripts/${this.$store.getters["write/manuscriptProperty"]("id")} `);let e=await this.$api.get("users/"+this.$store.getters["user/userProperty"]("id"),{params:{expand:"~all"}}),t=e.data;this.$store.commit("user/setUser",t),this.$router.replace({name:"app-write"})}catch(t){this.$q.notify({color:"negative",position:"top",message:"Edit unsuccessful",icon:"error"})}},async confirmPublish(e){if(this.publishDialog=!1,e)try{await this.$store.dispatch("write/publishBook"),this.$router.push({name:"app-read"})}catch(t){this.$q.notify({color:"negative",position:"top",message:"Edit unsuccessful",icon:"error"})}}}};var W=i(4379),Z=i(7011),M=i(3414),x=i(2035),Q=i(2350),B=i(4554),R=i(5869),F=i(6778),V=i(151),T=i(5589),I=i(8886),L=i(9367),A=i(8240),E=i(677);const j=(0,w.Z)(H,[["render",m],["__scopeId","data-v-63a1c034"]]),S=j;_()(H,"components",{QPage:W.Z,QList:Z.Z,QItem:M.Z,QItemSection:x.Z,QItemLabel:Q.Z,QIcon:B.Z,QSeparator:R.Z,QDialog:F.Z,QCard:V.Z,QCardSection:T.Z,QToggle:I.Z,QCardActions:L.Z,QBtn:A.Z}),_()(H,"directives",{Ripple:$.Z,ClosePopup:E.Z})}}]);