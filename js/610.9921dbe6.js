"use strict";(self["webpackChunkbookkay"]=self["webpackChunkbookkay"]||[]).push([[610],{5494:(t,e,i)=>{i.r(e),i.d(e,{default:()=>L});var a=i(3673),o=i(2323);(0,a.dD)("data-v-63a1c034");const r={class:"book-covers-container"},l={class:"book-covers"},n={class:"list-container"},s=(0,a._)("div",{class:"text-h6"},"Configs",-1),c=(0,a.Uk)(" Contain Front Matter: "),p=(0,a.Uk)(" Contain Chapter: "),u=(0,a.Uk)(" Contain Back Matter: ");function d(t,e,i,d,m,h){const g=(0,a.up)("image-uploader"),f=(0,a.up)("q-item-label"),b=(0,a.up)("q-item-section"),y=(0,a.up)("q-icon"),D=(0,a.up)("q-item"),w=(0,a.up)("q-separator"),v=(0,a.up)("q-list"),k=(0,a.up)("q-card-section"),$=(0,a.up)("q-toggle"),C=(0,a.up)("q-btn"),_=(0,a.up)("q-card-actions"),P=(0,a.up)("q-card"),U=(0,a.up)("q-dialog"),q=(0,a.up)("prompt-dialog"),H=(0,a.up)("confirm-dialog"),W=(0,a.up)("q-page"),M=(0,a.Q2)("ripple"),Z=(0,a.Q2)("close-popup");return(0,a.wg)(),(0,a.j4)(W,null,{default:(0,a.w5)((()=>[(0,a._)("div",r,[(0,a._)("div",l,[(0,a.Wm)(g,{img:h.frontCover,url:h.getFrontCoverURL,label:"Front Cover",class:"front-cover",onUploaded:h.uploadHandler,onClear:h.clearHandler},null,8,["img","url","onUploaded","onClear"]),(0,a.Wm)(g,{img:h.backCover,url:h.getBackCoverURL,label:"Back Cover",class:"back-cover",onUploaded:h.uploadHandler,onClear:h.clearHandler},null,8,["img","url","onUploaded","onClear"])])]),(0,a._)("div",n,[(0,a.Wm)(v,null,{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(h.fields,((t,e)=>((0,a.wg)(),(0,a.iD)("div",{key:e},[(0,a.wy)((0,a.Wm)(D,{clickable:"",style:{"border-radius":"30px"},onClick:t.clickHandler},{default:(0,a.w5)((()=>[(0,a.Wm)(b,null,{default:(0,a.w5)((()=>[(0,a.Wm)(f,null,{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(t.label),1)])),_:2},1024),(0,a.Wm)(f,{caption:"",lines:t.lines?t.lines:"2"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(t.value),1)])),_:2},1032,["lines"])])),_:2},1024),(0,a.Wm)(b,{side:""},{default:(0,a.w5)((()=>[(0,a.Wm)(y,{name:t.icon||"keyboard_arrow_right",color:t.color||"black"},null,8,["name","color"])])),_:2},1024)])),_:2},1032,["onClick"]),[[M,void 0,void 0,{early:!0}]]),(0,a.Wm)(w,{spaced:"",inset:""})])))),128))])),_:1})]),(0,a.Wm)(U,{modelValue:m.configsDialog,"onUpdate:modelValue":e[3]||(e[3]=t=>m.configsDialog=t)},{default:(0,a.w5)((()=>[(0,a.Wm)(P,null,{default:(0,a.w5)((()=>[(0,a.Wm)(k,null,{default:(0,a.w5)((()=>[s])),_:1}),(0,a.Wm)(k,{class:"q-pt-none"},{default:(0,a.w5)((()=>[(0,a._)("div",null,[c,(0,a.Wm)($,{modelValue:m.containFrontMatter,"onUpdate:modelValue":e[0]||(e[0]=t=>m.containFrontMatter=t),color:"green","keep-color":""},null,8,["modelValue"])]),(0,a._)("div",null,[p,(0,a.Wm)($,{modelValue:m.containChapter,"onUpdate:modelValue":e[1]||(e[1]=t=>m.containChapter=t),color:"green","keep-color":""},null,8,["modelValue"])]),(0,a._)("div",null,[u,(0,a.Wm)($,{modelValue:m.containBackMatter,"onUpdate:modelValue":e[2]||(e[2]=t=>m.containBackMatter=t),color:"green","keep-color":""},null,8,["modelValue"])])])),_:1}),(0,a.Wm)(_,{align:"right"},{default:(0,a.w5)((()=>[(0,a.wy)((0,a.Wm)(C,{flat:"",label:"Ok",color:"primary",ripple:{early:!0}},null,512),[[Z]])])),_:1})])),_:1})])),_:1},8,["modelValue"]),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(h.promptDialogs,((t,e)=>((0,a.wg)(),(0,a.j4)(q,{key:e,open:t.state,label:t.label,caption:t.caption,value:t.value,rules:t.rules,onConfirmed:t.confirmHandler},null,8,["open","label","caption","value","rules","onConfirmed"])))),128)),(0,a.Wm)(H,{open:m.confirmDialog.state,header:m.confirmDialog.label,text:m.confirmDialog.text,btnLabel:"Disable",btnColor:"red",onConfirmed:h.confirmConfigs},null,8,["open","header","text","onConfirmed"])])),_:1})}(0,a.Cn)();i(246),i(71),i(7280),i(5363);(0,a.dD)("data-v-16cac466");const m={key:0},h={key:1},g={class:"label"};function f(t,e,i,r,l,n){const s=(0,a.up)("q-uploader"),c=(0,a.up)("q-img"),p=(0,a.up)("confirm-dialog"),u=(0,a.Q2)("ripple");return""==i.img?((0,a.wg)(),(0,a.iD)("div",m,[(0,a.Wm)(s,{label:i.label,"auto-upload":"",url:i.url,accept:".jpg, .png, .gif","max-file-size":"5000000",color:"black","no-thumbnails":t.$q.screen.lt.sm,headers:n.getHeaders,onRejected:n.onRejected,onUploaded:n.onUploaded,class:"uploader"},null,8,["label","url","no-thumbnails","headers","onRejected","onUploaded"])])):((0,a.wg)(),(0,a.iD)("div",h,[(0,a.wy)((0,a.Wm)(c,{src:i.img,loading:"lazy","spinner-color":"white",fit:"cover",class:"img",onClick:e[0]||(e[0]=t=>l.confirmDialog=!0)},{default:(0,a.w5)((()=>[(0,a._)("div",g,(0,o.zw)(i.label),1)])),_:1},8,["src"]),[[u,void 0,void 0,{early:!0}]]),(0,a.Wm)(p,{open:l.confirmDialog,header:`Reupload ${i.label} image?`,btnLabel:"Reupload",btnColor:"green",onConfirmed:n.confirmHandler},null,8,["open","header","onConfirmed"])]))}(0,a.Cn)();var b=i(8531);const y={name:"ImageUploader",components:{ConfirmDialog:b.Z},props:{img:{type:String,default:""},label:{type:String,default:""},url:{type:String,default:""}},data(){return{confirmDialog:!1}},methods:{onRejected(t){for(let e=0;e<t.length;e++){const i=t[e];this.$q.notify({type:"negative",message:`${i.file.name} was rejected as it fails ${i.failedPropValidation.replaceAll("-"," ")} validation`})}},getHeaders(){let t=this.$api.defaults.headers.common,e=[];for(const i in t){let a={name:i,value:t[i]};e.push(a)}return e},onUploaded(t){this.$emit("uploaded",this.$props.label)},confirmHandler(t){this.confirmDialog=!1,t&&this.$emit("clear",this.$props.label)}}};var D=i(1034),w=i(4027),v=i(6489),k=i(7518),$=i.n(k);y.render=f,y.__scopeId="data-v-16cac466";const C=y;$()(y,"components",{QUploader:D.Z,QImg:w.Z}),$()(y,"directives",{Ripple:v.Z});var _=i(1832);const P={name:"OverviewPage",components:{PromptDialog:_.Z,ConfirmDialog:b.Z,ImageUploader:C},data(){return{price:"Free",containFrontMatter:!1,containChapter:!1,containBackMatter:!1,confirmDialog:{state:!1,label:"",text:"",data:"",externalData:""},titleDialog:!1,descriptionDialog:!1,configsDialog:!1,deleteDialog:!1,publishDialog:!1}},watch:{containFrontMatter:function(t){t?this.toggleConfigs({contain_front_matter:!0}):(this.confirmDialog["state"]=!0,this.confirmDialog["data"]="containFrontMatter",this.confirmDialog["externalData"]="contain_front_matter",this.confirmDialog["label"]="Diable Front Matters",this.confirmDialog["text"]="Are you sure you want to disable front matters? This will delete all your current front matters.")},containChapter:function(t){t?this.toggleConfigs({contain_chapter:!0}):(this.confirmDialog["state"]=!0,this.confirmDialog["data"]="containChapter",this.confirmDialog["externalData"]="contain_chapter",this.confirmDialog["label"]="Diable Chapters",this.confirmDialog["text"]="Are you sure you want to disable chapters? This will delete all your current chapters.")},containBackMatter:function(t){t?this.toggleConfigs({contain_back_matter:!0}):(this.confirmDialog["state"]=!0,this.confirmDialog["data"]="containBackMatter",this.confirmDialog["externalData"]="contain_back_matter",this.confirmDialog["label"]="Diable Back Matters",this.confirmDialog["text"]="Are you sure you want to disable back matters? This will delete all your current back matters.")},"$store.state.write.manuscript":{handler:function(t){null!=t&&(this.containFrontMatter=this.$store.getters["write/manuscriptProperty"]("configs").contain_front_matter,this.containChapter=this.$store.getters["write/manuscriptProperty"]("configs").contain_chapter,this.containBackMatter=this.$store.getters["write/manuscriptProperty"]("configs").contain_back_matter)}}},computed:{frontCover(){return this.$store.getters["write/manuscriptProperty"]("front_cover")},backCover(){return this.$store.getters["write/manuscriptProperty"]("back_cover")},title(){return this.$store.getters["write/manuscriptProperty"]("title")},description(){return this.$store.getters["write/manuscriptProperty"]("description")},authorName(){return this.$store.getters["user/userProperty"]("author_name")},getFrontCoverURL(){let t=`${this.$api.defaults.baseURL}manuscripts/${this.$store.getters["write/manuscriptProperty"]("id")}/front_cover`;return t},getBackCoverURL(){let t=`${this.$api.defaults.baseURL}manuscripts/${this.$store.getters["write/manuscriptProperty"]("id")}/back_cover`;return t},fields(){return[{label:"Title",value:this.title,clickHandler:this.changeTitle},{label:"Description",value:this.description,clickHandler:this.changeDescription},{label:"Author Name",value:this.authorName},{label:"Price",value:this.price},{label:"Edit Configs",clickHandler:this.editConfigs},{label:"Delete",icon:"delete",color:"red",clickHandler:this.delete},{label:"Publish",icon:"publish",color:"green",clickHandler:this.publish}]},promptDialogs(){return[{label:"Title",state:this.titleDialog,value:this.title,rules:[t=>null!==t&&""!==t||"Please type your title",t=>t.length<=100||"Title must be smaller than 100"],confirmHandler:this.confirmTitle},{label:"Description",state:this.descriptionDialog,value:this.description,rules:[t=>null!==t&&""!==t||"Please type your description"],confirmHandler:this.confirmDescription},{label:"Delete Confirmation",caption:`Are you sure you want to DELETE? After deleting all related data of this manuscript will be permanently lost. If you are confirmed, type in <b>${this.title}</b>`,state:this.deleteDialog,value:"",rules:[t=>null!==t&&""!==t||`Please type in ${this.title} to confirm`,t=>t==this.title||`Please type in ${this.title} to confirm`],confirmHandler:this.confirmDelete},{label:"Publish Confirmation",caption:`Are you sure you want to publish? After publishing you cannot edit or delete the book. If you are confirmed, type in <b>${this.title}</b>`,state:this.publishDialog,value:"",rules:[t=>null!==t&&""!==t||`Please type in ${this.title} to confirm`,t=>t==this.title||`Pleaseee type in ${this.title} to confirm`],confirmHandler:this.confirmPublish}]}},methods:{async uploadHandler(){let t=await this.$api.get("manuscripts/"+this.$store.state.write.manuscript.id,{params:{expand:"~all"}});this.$store.commit("write/updateManuscript",t.data),this.$q.sessionStorage.set("currentManuscript",this.$store.state.write.manuscript)},async clearHandler(t){let e;"Front Cover"==t?e="front_cover":"Back Cover"==t&&(e="back_cover");let i={};i[e]="";let a=this.$store.getters["write/manuscriptProperty"](e);try{await this.$api.delete(`manuscripts/${this.$store.getters["write/manuscriptProperty"]("id")}/${e}`,{params:{img:a}}),await this.$store.dispatch("write/editManuscript",i)}catch(o){this.$q.notify({color:"negative",position:"top",message:"Edit unsuccessful",icon:"error"})}},changeTitle(){this.titleDialog=!0},changeDescription(){this.descriptionDialog=!0},editConfigs(){this.configsDialog=!0},delete(){this.deleteDialog=!0},publish(){let t="",e=this.$store.getters["write/manuscriptProperty"]("front_cover"),i=this.$store.getters["write/manuscriptProperty"]("back_cover");""==e?t="Please add front cover of your book":""==i&&(t="Please add back cover of your book"),""!=t?this.$q.notify({color:"negative",position:"top",message:t,icon:"error"}):this.publishDialog=!0},async confirmConfigs(t){if(this.confirmDialog.state=!1,t){let t={};t[this.confirmDialog.externalData]=!1;let e=await this.toggleConfigs(t);e||(this[this.confirmDialog.data]=!0),this.deleteComponents(this.confirmDialog.externalData)}else this[this.confirmDialog.data]=!0},async toggleConfigs(t){try{return await this.$store.dispatch("write/editConfigs",t),!0}catch(e){return this.$q.notify({color:"negative",position:"top",message:"Edit unsuccessful",icon:"error"}),!1}},async deleteComponents(t){let e="";switch(t){case"contain_front_matter":e="front_matter";break;case"contain_chapter":e="chapter";break;case"contain_back_matter":e="back_matter";break;default:}let i={type:e},a=this.$store.getters["write/manuscriptProperty"](e);for(const o of a)i.id=o.id,await this.$store.dispatch("write/deleteComponent",i)},async confirmTitle(t){if(this.titleDialog=!1,t&&t!=this.title){let i={title:t};try{await this.$store.dispatch("write/editManuscript",i)}catch(e){this.$q.notify({color:"negative",position:"top",message:"Edit unsuccessful",icon:"error"})}}},async confirmDescription(t){if(this.descriptionDialog=!1,t&&t!=this.description){let i={description:t};try{await this.$store.dispatch("write/editManuscript",i)}catch(e){this.$q.notify({color:"negative",position:"top",message:"Edit unsuccessful",icon:"error"})}}},async confirmDelete(t){if(this.deleteDialog=!1,t)try{await this.$api.delete(`manuscripts/${this.$store.getters["write/manuscriptProperty"]("id")} `);let t=await this.$api.get("users/"+this.$store.getters["user/userProperty"]("id"),{params:{expand:"~all"}}),e=t.data;this.$store.commit("user/setUser",e),this.$router.replace({name:"app-write"})}catch(e){this.$q.notify({color:"negative",position:"top",message:"Edit unsuccessful",icon:"error"})}},async confirmPublish(t){if(this.publishDialog=!1,t)try{await this.$store.dispatch("write/publishBook"),this.$router.push({name:"app-read"})}catch(e){this.$q.notify({color:"negative",position:"top",message:"Edit unsuccessful",icon:"error"})}}}};var U=i(4379),q=i(7011),H=i(3414),W=i(2035),M=i(2350),Z=i(4554),x=i(5869),Q=i(6778),B=i(151),R=i(5589),F=i(8886),V=i(9367),T=i(8240),I=i(677);P.render=d,P.__scopeId="data-v-63a1c034";const L=P;$()(P,"components",{QPage:U.Z,QList:q.Z,QItem:H.Z,QItemSection:W.Z,QItemLabel:M.Z,QIcon:Z.Z,QSeparator:x.Z,QDialog:Q.Z,QCard:B.Z,QCardSection:R.Z,QToggle:F.Z,QCardActions:V.Z,QBtn:T.Z}),$()(P,"directives",{Ripple:v.Z,ClosePopup:I.Z})}}]);