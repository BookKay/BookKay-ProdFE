"use strict";(self["webpackChunkbookkay"]=self["webpackChunkbookkay"]||[]).push([[971],{2117:(e,t,i)=>{i.r(t),i.d(t,{default:()=>z});var r=i(3673),a=i(2323);const o=e=>((0,r.dD)("data-v-15272b5e"),e=e(),(0,r.Cn)(),e),n={class:"book-covers-container"},l={class:"book-covers"},s={class:"list-container"},c=o((()=>(0,r._)("div",{class:"text-h6"},"Configs",-1))),p=(0,r.Uk)(" Contain Front Matter: "),u=(0,r.Uk)(" Contain Chapter: "),d=(0,r.Uk)(" Contain Back Matter: ");function m(e,t,i,o,m,h){const g=(0,r.up)("image-uploader"),f=(0,r.up)("q-item-label"),b=(0,r.up)("q-item-section"),y=(0,r.up)("q-icon"),w=(0,r.up)("q-item"),D=(0,r.up)("q-separator"),v=(0,r.up)("q-list"),k=(0,r.up)("q-card-section"),$=(0,r.up)("q-toggle"),C=(0,r.up)("q-btn"),_=(0,r.up)("q-card-actions"),P=(0,r.up)("q-card"),U=(0,r.up)("q-dialog"),q=(0,r.up)("app-prompt-dialog"),Z=(0,r.up)("app-confirm-dialog"),H=(0,r.up)("genre-dropdown"),W=(0,r.up)("app-alert-dialog"),M=(0,r.up)("q-page"),x=(0,r.Q2)("ripple"),Q=(0,r.Q2)("close-popup");return(0,r.wg)(),(0,r.j4)(M,null,{default:(0,r.w5)((()=>[(0,r._)("div",n,[(0,r._)("div",l,[(0,r.Wm)(g,{img:h.frontCover,url:h.getFrontCoverURL,label:"Front Cover",class:"front-cover",onUploaded:h.uploadHandler,onClear:h.clearHandler},null,8,["img","url","onUploaded","onClear"]),(0,r.Wm)(g,{img:h.backCover,url:h.getBackCoverURL,label:"Back Cover",class:"back-cover",onUploaded:h.uploadHandler,onClear:h.clearHandler},null,8,["img","url","onUploaded","onClear"])])]),(0,r._)("div",s,[(0,r.Wm)(v,null,{default:(0,r.w5)((()=>[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(h.fields,((e,t)=>((0,r.wg)(),(0,r.iD)("div",{key:t},[(0,r.wy)(((0,r.wg)(),(0,r.j4)(w,{clickable:"",style:{"border-radius":"30px"},onClick:e.clickHandler},{default:(0,r.w5)((()=>[(0,r.Wm)(b,null,{default:(0,r.w5)((()=>[(0,r.Wm)(f,null,{default:(0,r.w5)((()=>[(0,r.Uk)((0,a.zw)(e.label),1)])),_:2},1024),(0,r.Wm)(f,{caption:"",lines:e.lines?e.lines:"2"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,a.zw)(e.value),1)])),_:2},1032,["lines"])])),_:2},1024),(0,r.Wm)(b,{side:""},{default:(0,r.w5)((()=>[(0,r.Wm)(y,{name:e.icon||"keyboard_arrow_right",color:e.color||"black"},null,8,["name","color"])])),_:2},1024)])),_:2},1032,["onClick"])),[[x,void 0,void 0,{early:!0}]]),(0,r.Wm)(D,{spaced:"",inset:""})])))),128))])),_:1})]),(0,r.Wm)(U,{modelValue:m.configsDialog,"onUpdate:modelValue":t[3]||(t[3]=e=>m.configsDialog=e)},{default:(0,r.w5)((()=>[(0,r.Wm)(P,null,{default:(0,r.w5)((()=>[(0,r.Wm)(k,null,{default:(0,r.w5)((()=>[c])),_:1}),(0,r.Wm)(k,{class:"q-pt-none"},{default:(0,r.w5)((()=>[(0,r._)("div",null,[p,(0,r.Wm)($,{modelValue:m.containFrontMatter,"onUpdate:modelValue":t[0]||(t[0]=e=>m.containFrontMatter=e),color:"green","keep-color":""},null,8,["modelValue"])]),(0,r._)("div",null,[u,(0,r.Wm)($,{modelValue:m.containChapter,"onUpdate:modelValue":t[1]||(t[1]=e=>m.containChapter=e),color:"green","keep-color":""},null,8,["modelValue"])]),(0,r._)("div",null,[d,(0,r.Wm)($,{modelValue:m.containBackMatter,"onUpdate:modelValue":t[2]||(t[2]=e=>m.containBackMatter=e),color:"green","keep-color":""},null,8,["modelValue"])])])),_:1}),(0,r.Wm)(_,{align:"right"},{default:(0,r.w5)((()=>[(0,r.wy)((0,r.Wm)(C,{flat:"",label:"Ok",color:"primary",ripple:{early:!0}},null,512),[[Q]])])),_:1})])),_:1})])),_:1},8,["modelValue"]),((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(h.promptDialogs,((e,t)=>((0,r.wg)(),(0,r.j4)(q,{key:t,open:e.state,label:e.label,caption:e.caption,value:e.value,rules:e.rules,onConfirmed:e.confirmHandler},null,8,["open","label","caption","value","rules","onConfirmed"])))),128)),(0,r.Wm)(Z,{open:m.confirmDialog.state,header:m.confirmDialog.label,text:m.confirmDialog.text,btnLabel:"Disable",btnColor:"red",onConfirmed:h.confirmConfigs},null,8,["open","header","text","onConfirmed"]),(0,r.Wm)(W,{ref:"alertDialog",onClose:h.confirmGenre,header:"Genre"},{"main-content":(0,r.w5)((()=>[(0,r.Wm)(H,{modelValue:m.currentGenre,"onUpdate:modelValue":t[4]||(t[4]=e=>m.currentGenre=e)},null,8,["modelValue"])])),_:1},8,["onClose"])])),_:1})}i(246),i(71),i(5363);const h={key:0},g={key:1},f={class:"label"};function b(e,t,i,o,n,l){const s=(0,r.up)("q-uploader"),c=(0,r.up)("q-img"),p=(0,r.up)("app-confirm-dialog"),u=(0,r.Q2)("ripple");return""==i.img?((0,r.wg)(),(0,r.iD)("div",h,[(0,r.Wm)(s,{label:i.label,"auto-upload":"",url:i.url,accept:".jpg, .png, .gif","max-file-size":"8000000",color:"black","no-thumbnails":e.$q.screen.lt.sm,headers:l.getHeaders,onRejected:l.onRejected,onUploaded:l.onUploaded,class:"uploader"},null,8,["label","url","no-thumbnails","headers","onRejected","onUploaded"])])):((0,r.wg)(),(0,r.iD)("div",g,[(0,r.wy)(((0,r.wg)(),(0,r.j4)(c,{src:i.img,loading:"lazy","spinner-color":"white",fit:"cover",class:"img",onClick:t[0]||(t[0]=e=>n.confirmDialog=!0)},{default:(0,r.w5)((()=>[(0,r._)("div",f,(0,a.zw)(i.label),1)])),_:1},8,["src"])),[[u,void 0,void 0,{early:!0}]]),(0,r.Wm)(p,{open:n.confirmDialog,header:`Reupload ${i.label} image?`,btnLabel:"Reupload",btnColor:"green",onConfirmed:l.confirmHandler},null,8,["open","header","onConfirmed"])]))}i(7768);var y=i(3963);const w={name:"AppImageUploader",components:{AppConfirmDialog:y.Z},props:{img:{type:String,default:""},label:{type:String,default:""},url:{type:String,default:""}},data(){return{confirmDialog:!1}},methods:{onRejected(e){for(let t=0;t<e.length;t++){const i=e[t];this.$q.notify({type:"negative",message:`${i.file.name} was rejected as it fails ${i.failedPropValidation.replaceAll("-"," ")} validation`})}},getHeaders(){let e=this.$api.defaults.headers.common,t=[];for(const i in e){let r={name:i,value:e[i]};t.push(r)}return t},onUploaded(e){this.$emit("uploaded",this.$props.label)},confirmHandler(e){this.confirmDialog=!1,e&&this.$emit("clear",this.$props.label)}}};var D=i(4260),v=i(3768),k=i(4027),$=i(860),C=i(7518),_=i.n(C);const P=(0,D.Z)(w,[["render",b],["__scopeId","data-v-ca3dcb8a"]]),U=P;_()(w,"components",{QUploader:v.Z,QImg:k.Z}),_()(w,"directives",{Ripple:$.Z});var q=i(9420),Z=i(1760),H=i(7329);const W={name:"OverviewPage",components:{AppPromptDialog:q.Z,AppConfirmDialog:y.Z,AppAlertDialog:Z.Z,ImageUploader:U,GenreDropdown:H.Z},data(){return{price:"Free",containFrontMatter:!1,containChapter:!1,containBackMatter:!1,confirmDialog:{state:!1,label:"",text:"",data:"",externalData:""},titleDialog:!1,descriptionDialog:!1,configsDialog:!1,deleteDialog:!1,publishDialog:!1,currentGenre:""}},watch:{containFrontMatter:function(e){e?this.toggleConfigs({contain_front_matter:!0}):(this.confirmDialog["state"]=!0,this.confirmDialog["data"]="containFrontMatter",this.confirmDialog["externalData"]="contain_front_matter",this.confirmDialog["label"]="Diable Front Matters",this.confirmDialog["text"]="Are you sure you want to disable front matters? This will delete all your current front matters.")},containChapter:function(e){e?this.toggleConfigs({contain_chapter:!0}):(this.confirmDialog["state"]=!0,this.confirmDialog["data"]="containChapter",this.confirmDialog["externalData"]="contain_chapter",this.confirmDialog["label"]="Diable Chapters",this.confirmDialog["text"]="Are you sure you want to disable chapters? This will delete all your current chapters.")},containBackMatter:function(e){e?this.toggleConfigs({contain_back_matter:!0}):(this.confirmDialog["state"]=!0,this.confirmDialog["data"]="containBackMatter",this.confirmDialog["externalData"]="contain_back_matter",this.confirmDialog["label"]="Diable Back Matters",this.confirmDialog["text"]="Are you sure you want to disable back matters? This will delete all your current back matters.")},"$store.state.write.manuscript":{handler:function(e){null!=e&&(this.containFrontMatter=this.$store.getters["write/manuscriptProperty"]("configs").contain_front_matter,this.containChapter=this.$store.getters["write/manuscriptProperty"]("configs").contain_chapter,this.containBackMatter=this.$store.getters["write/manuscriptProperty"]("configs").contain_back_matter,this.currentGenre=this.genre)},deep:!0,immediate:!1}},computed:{frontCover(){return this.$store.getters["write/manuscriptProperty"]("front_cover")},backCover(){return this.$store.getters["write/manuscriptProperty"]("back_cover")},title(){return this.$store.getters["write/manuscriptProperty"]("title")},description(){return this.$store.getters["write/manuscriptProperty"]("description")},genre(){return this.$store.getters["write/manuscriptProperty"]("genre").name},authorName(){return this.$store.getters["user/userProperty"]("author_name")},getFrontCoverURL(){let e=`${this.$api.defaults.baseURL}manuscripts/${this.$store.getters["write/manuscriptProperty"]("id")}/front_cover`;return e},getBackCoverURL(){let e=`${this.$api.defaults.baseURL}manuscripts/${this.$store.getters["write/manuscriptProperty"]("id")}/back_cover`;return e},fields(){return[{label:"Title",value:this.title,clickHandler:this.changeTitle},{label:"Description",value:this.description,clickHandler:this.changeDescription},{label:"Genre",value:this.genre,clickHandler:this.changeGenre},{label:"Author Name",value:this.authorName},{label:"Price",value:this.price},{label:"Edit Configs",clickHandler:this.editConfigs},{label:"Delete",icon:"delete",color:"red",clickHandler:this.delete},{label:"Publish",icon:"publish",color:"green",clickHandler:this.publish}]},promptDialogs(){return[{label:"Title",state:this.titleDialog,value:this.title,rules:[e=>null!==e&&""!==e||"Please type your title",e=>e.length<=100||"Title must be smaller than 100"],confirmHandler:this.confirmTitle},{label:"Description",state:this.descriptionDialog,value:this.description,rules:[e=>null!==e&&""!==e||"Please type your description"],confirmHandler:this.confirmDescription},{label:"Delete Confirmation",caption:`Are you sure you want to DELETE? After deleting all related data of this manuscript will be permanently lost. If you are confirmed, type in <b>${this.title}</b>`,state:this.deleteDialog,value:"",rules:[e=>null!==e&&""!==e||`Please type in ${this.title} to confirm`,e=>e==this.title||`Please type in ${this.title} to confirm`],confirmHandler:this.confirmDelete},{label:"Publish Confirmation",caption:`Are you sure you want to publish? After publishing you cannot edit or delete the book. If you are confirmed, type in <b>${this.title}</b>`,state:this.publishDialog,value:"",rules:[e=>null!==e&&""!==e||`Please type in ${this.title} to confirm`,e=>e==this.title||`Pleaseee type in ${this.title} to confirm`],confirmHandler:this.confirmPublish}]}},methods:{async uploadHandler(){let e=await this.$api.get("manuscripts/"+this.$store.state.write.manuscript.id,{params:{expand:"~all"}});this.$store.commit("write/updateManuscript",e.data),this.$q.sessionStorage.set("currentManuscript",this.$store.state.write.manuscript)},async clearHandler(e){let t;"Front Cover"==e?t="front_cover":"Back Cover"==e&&(t="back_cover");let i={};i[t]="";let r=this.$store.getters["write/manuscriptProperty"](t);try{await this.$api.delete(`manuscripts/${this.$store.getters["write/manuscriptProperty"]("id")}/${t}`,{params:{img:r}}),await this.$store.dispatch("write/editManuscript",i)}catch{this.$q.notify({color:"negative",position:"top",message:"Edit unsuccessful",icon:"error"})}},changeTitle(){this.titleDialog=!0},changeDescription(){this.descriptionDialog=!0},changeGenre(){this.$refs.alertDialog.openDialog()},editConfigs(){this.configsDialog=!0},delete(){this.deleteDialog=!0},publish(){let e="",t=this.$store.getters["write/manuscriptProperty"]("front_cover"),i=this.$store.getters["write/manuscriptProperty"]("back_cover");""==t?e="Please add front cover of your book":""==i&&(e="Please add back cover of your book"),""!=e?this.$q.notify({color:"negative",position:"top",message:e,icon:"error"}):this.publishDialog=!0},async confirmConfigs(e){if(this.confirmDialog.state=!1,e){let e={};e[this.confirmDialog.externalData]=!1;let t=await this.toggleConfigs(e);t||(this[this.confirmDialog.data]=!0),this.deleteComponents(this.confirmDialog.externalData)}else this[this.confirmDialog.data]=!0},async toggleConfigs(e){try{return await this.$store.dispatch("write/editConfigs",e),!0}catch{return this.$q.notify({color:"negative",position:"top",message:"Edit unsuccessful",icon:"error"}),!1}},async deleteComponents(e){let t="";switch(e){case"contain_front_matter":t="front_matter";break;case"contain_chapter":t="chapter";break;case"contain_back_matter":t="back_matter";break;default:}let i={type:t},r=this.$store.getters["write/manuscriptProperty"](t);for(const a of r)i.id=a.id,await this.$store.dispatch("write/deleteComponent",i)},async confirmTitle(e){if(this.titleDialog=!1,e&&e!=this.title){let t={title:e};try{await this.$store.dispatch("write/editManuscript",t)}catch{this.$q.notify({color:"negative",position:"top",message:"Edit unsuccessful",icon:"error"})}}},async confirmDescription(e){if(this.descriptionDialog=!1,e&&e!=this.description){let t={description:e};try{await this.$store.dispatch("write/editManuscript",t)}catch{this.$q.notify({color:"negative",position:"top",message:"Edit unsuccessful",icon:"error"})}}},async confirmGenre(){if(this.currentGenre!=this.genre){let e={genre:this.currentGenre};try{console.log(this.currentGenre),await this.$store.dispatch("write/editGenre",e)}catch{this.$q.notify({color:"negative",position:"top",message:"Edit unsuccessful",icon:"error"})}}},async confirmDelete(e){if(this.deleteDialog=!1,e)try{await this.$api.delete(`manuscripts/${this.$store.getters["write/manuscriptProperty"]("id")} `);let e=await this.$api.get("users/"+this.$store.getters["user/userProperty"]("id"),{params:{expand:"~all"}}),t=e.data;this.$store.commit("user/setUser",t),this.$router.replace({name:"app-write"})}catch{this.$q.notify({color:"negative",position:"top",message:"Edit unsuccessful",icon:"error"})}},async confirmPublish(e){if(this.publishDialog=!1,e)try{await this.$store.dispatch("write/publishBook"),this.$router.push({name:"app-read"})}catch{this.$q.notify({color:"negative",position:"top",message:"Edit unsuccessful",icon:"error"})}}}};var M=i(4379),x=i(7011),Q=i(3414),A=i(2035),V=i(2350),G=i(4554),B=i(5869),R=i(6778),F=i(151),T=i(5589),E=i(8886),I=i(9367),L=i(8240),j=i(677);const S=(0,D.Z)(W,[["render",m],["__scopeId","data-v-15272b5e"]]),z=S;_()(W,"components",{QPage:M.Z,QList:x.Z,QItem:Q.Z,QItemSection:A.Z,QItemLabel:V.Z,QIcon:G.Z,QSeparator:B.Z,QDialog:R.Z,QCard:F.Z,QCardSection:T.Z,QToggle:E.Z,QCardActions:I.Z,QBtn:L.Z}),_()(W,"directives",{Ripple:$.Z,ClosePopup:j.Z})}}]);