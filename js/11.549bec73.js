(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[11],{"4d16":function(t,e,o){"use strict";o.r(e);var a=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("q-page",{staticClass:"flex"},[o("div",{staticClass:"col"},[o("div",{staticClass:"row q-ml-md"},[o("h2",{staticClass:"q-mb-md"},[t._v("My Library")])]),o("q-separator",{staticClass:"q-mb-md",attrs:{inset:""}}),o("div",{staticClass:"row",class:t.alignment},[t._l(t.purchasedBooks,(function(e){return o("book-card",{key:e.id,staticClass:"col-md-3 col-xs-10",attrs:{book:e,is_purchased:!0},on:{deleted:t.deleteBook}})})),t._l(t.authoredBooks,(function(e){return o("book-card",{key:e.id,staticClass:"col-md-3 col-xs-10",attrs:{book:e,is_purchased:!0},on:{deleted:t.deleteBook}})}))],2)],1)])},r=[],s=(o("e260"),o("d3b7"),o("3ca3"),o("ddb0"),o("2b3d"),o("e9e6")),n={components:{BookCard:s["a"]},name:"ReadPage",beforeMount:function(){this.computePurchases()},computed:{alignment:function(){return this.$q.screen.lt.md?"justify-center":"justify-start"},authoredBooks:function(){for(var t=this.$store.getters["user/userProperty"]("books_authored"),e=0;e<t.length;e++){var o=t[e];o.author={},o.author.author_name=this.$store.getters["user/userProperty"]("author_name")}return t}},data:function(){return{purchasedBooks:[]}},methods:{computePurchases:function(){for(var t=this,e=this.$store.getters["user/userProperty"]("books_purchased"),o=[],a=function(){var a=e[r].book;t.$api.get("users/"+a.author_id).then((function(t){var e=t.data;a.author={},a.author.author_name=e.author_name,o.push(a)}))},r=0;r<e.length;r++)a();this.purchasedBooks=o},deleteBook:function(t){var e=this;if(t.author.author_name==this.$store.getters["user/userProperty"]("author_name"))this.$q.notify({color:"negative",position:"top",message:"Sorry, you cannot the delete the books that you have published.",icon:"error"});else{var o=new URLSearchParams([["book_id",t.id],["user_id",this.$store.getters["user/userProperty"]("id")]]);this.$api.get("book_purchases",{params:o}).then((function(t){var o=t.data;e.$api.delete("book_purchases/"+o.id).then((function(t){var o=t.data;e.$store.commit("user/setUser",o),e.$q.localStorage.set("user",o),e.computePurchases()}))})).catch((function(t){e.$q.notify({color:"negative",position:"top",message:t.response.data.message||"Something went wrong",icon:"error"})}))}}}},i=n,c=o("2877"),l=o("9989"),u=o("eb85"),d=o("eebe"),p=o.n(d),h=Object(c["a"])(i,a,r,!1,null,null,null);e["default"]=h.exports;p()(h,"components",{QPage:l["a"],QSeparator:u["a"]})},e9e6:function(t,e,o){"use strict";var a=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("q-card",{directives:[{name:"ripple",rawName:"v-ripple"}],staticClass:"normal-card q-mb-md",staticStyle:{cursor:"pointer"},on:{click:t.navigate}},[o("q-card-section",{attrs:{horizontal:""}},[o("q-img",{staticClass:"col",attrs:{src:t.book.front_cover,ratio:3/4,contain:""}}),t.is_purchased?o("q-card-actions",{staticClass:"justify-around",attrs:{vertical:""}},[o("q-btn",{attrs:{flat:"",round:"",color:"primary",icon:"auto_stories"}}),o("q-btn",{attrs:{flat:"",round:"",color:"positive",icon:"share"},on:{click:function(e){t.share_link=!0}}}),o("q-btn",{attrs:{flat:"",round:"",color:"negative",icon:"delete"},on:{click:function(e){t.confirm_delete=!0}}})],1):o("q-card-actions",{staticClass:"justify-around",attrs:{vertical:""}},[o("q-btn",{attrs:{flat:"",round:"",icon:"info",to:{name:t.getDetailURL,params:{book_id:this.book.id}}}}),this.$route.name.startsWith("app")?o("q-btn",{attrs:{flat:"",round:"",color:"primary",icon:"payment",to:{name:"app-purchase-book",params:{book_id:t.book.id}}}}):o("q-btn",{attrs:{flat:"",round:"",color:"primary",icon:"auto_stories"}}),o("q-btn",{attrs:{flat:"",round:"",color:"positive",icon:"share"},on:{click:function(e){t.share_link=!0}}})],1)],1),o("q-card-section",[o("div",{staticClass:"text-h6"},[t._v(t._s(t.book.title))]),o("div",{staticClass:"text-caption"},[t._v("By "+t._s(t.book.author.author_name))])])],1),o("q-dialog",{model:{value:t.share_link,callback:function(e){t.share_link=e},expression:"share_link"}},[o("q-card",[o("q-card-section",{staticClass:"row items-center q-pb-none"},[o("div",{staticClass:"text-h6"},[t._v(t._s(t.book.title))]),o("q-space"),o("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{icon:"close",flat:"",round:"",dense:""}})],1),o("q-card-section",[o("q-field",{attrs:{filled:""},scopedSlots:t._u([{key:"control",fn:function(){return[o("div",{staticClass:"self-center full-width no-outline"},[t._v("\n              "+t._s(t.domain_name)+t._s(t.getShopURL)+"\n            ")])]},proxy:!0},{key:"append",fn:function(){return[o("q-btn",{attrs:{icon:"content_copy",flat:"",round:""},on:{click:t.copy}})]},proxy:!0}])})],1)],1)],1),o("q-dialog",{ref:"deleteDialog",attrs:{persistent:""},model:{value:t.confirm_delete,callback:function(e){t.confirm_delete=e},expression:"confirm_delete"}},[o("q-card",[o("q-card-section",{staticClass:"row items-center"},[o("span",{staticClass:"q-ml-sm"},[t._v("Are you sure you want delete this purchased book? No refund will be\n          made.")])]),o("q-card-actions",{attrs:{align:"right"}},[o("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Cancel",color:"primary"}}),o("q-btn",{attrs:{flat:"",icon:"delete",label:"Delete",color:"negative"},on:{click:t.confirmDelete}})],1)],1)],1)],1)},r=[],s=(o("2ca0"),o("b0c0"),o("cdde")),n={name:"BookCard",props:{book:{type:Object,required:!0},is_purchased:{type:Boolean,required:!0}},data:function(){return{domain_name:"bookkay.com",confirm_delete:!1,share_link:!1,purchase_btn_clicked:!1}},computed:{getShopURL:function(){var t=this.$router.resolve({name:this.getDetailURL,params:{book_id:this.$props.book.id}});return t.href},getDetailURL:function(){return this.$route.name.startsWith("app")?"app-browse-book":"home-browse-book"}},methods:{confirmDelete:function(){this.$emit("deleted",this.$props.book),this.confirm_delete=!1},copy:function(){var t=this,e=this.domain_name+this.getShopURL;Object(s["a"])(e).then((function(){t.$q.notify({icon:"done",color:"positive",message:"URL copied to clipboard"})})).catch((function(){t.$q.notify({icon:"error",color:"negative",message:"There was an error when copying to clipboard"})}))},navigate:function(){this.confirm_delete||this.share_link||this.purchase_btn_clicked||this.$router.push({name:"read-book",query:{book_id:this.$props.book.id}})}}},i=n,c=o("2877"),l=o("f09f"),u=o("a370"),d=o("068f"),p=o("4b7e"),h=o("9c40"),m=o("24e8"),f=o("2c91"),b=o("8572"),k=o("714f"),_=o("7f67"),v=o("eebe"),g=o.n(v),q=Object(c["a"])(i,a,r,!1,null,null,null);e["a"]=q.exports;g()(q,"components",{QCard:l["a"],QCardSection:u["a"],QImg:d["a"],QCardActions:p["a"],QBtn:h["a"],QDialog:m["a"],QSpace:f["a"],QField:b["a"]}),g()(q,"directives",{Ripple:k["a"],ClosePopup:_["a"]})}}]);