"use strict";(self["webpackChunkbookkay"]=self["webpackChunkbookkay"]||[]).push([[756],{3244:(e,t,o)=>{o.r(t),o.d(t,{default:()=>ua});o(71);var a=o(3673),n=o(8880),s=o(2323);const i=e=>((0,a.dD)("data-v-2a4ff16c"),e=e(),(0,a.Cn)(),e),r=["src"],l={class:"book-background"},c={key:0,class:"header top-bar"},d={class:"top-bar__left"},u={key:0,class:"top-bar__center"},h=i((()=>(0,a._)("img",{src:"logo/BookKay.png"},null,-1))),p=i((()=>(0,a._)("h6",{class:"q-ma-xs text-capitalize"},"BookKay",-1))),g={class:"top-bar__right"},m={class:"side-bar-contents"};function k(e,t,o,i,k,f){const v=(0,a.up)("q-ajax-bar"),b=(0,a.up)("splash-screen"),y=(0,a.up)("reader-settings"),w=(0,a.up)("q-dialog"),_=(0,a.up)("dictionary"),x=(0,a.up)("q-btn"),$=(0,a.up)("q-avatar"),C=(0,a.up)("flipbook-view"),T=((0,a.up)("shortie-view"),(0,a.up)("side-bar-contents")),D=(0,a.up)("drawer"),S=(0,a.up)("reader-pop-ups");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(v,{ref:"bar",position:"top",color:"primary",size:"5px"},null,512),(0,a.Wm)(b),(0,a._)("video",{autoplay:"",muted:"",playsinline:"",loop:"",id:"backgroundVideo",src:f.videoURL},null,8,r),(0,a._)("div",l,[(0,a.Wm)(w,{modelValue:k.settingsDialog,"onUpdate:modelValue":t[1]||(t[1]=e=>k.settingsDialog=e)},{default:(0,a.w5)((()=>[(0,a.Wm)(y,{purchaseAble:k.purchaseAble,onClose:t[0]||(t[0]=e=>k.settingsDialog=!1),onToggleBook:f.toggleBook,onSearchDictionary:f.searchDictionary,onThemeChanged:f.reloadsBook,onBookmarkAdded:f.addBookmark,onPurchase:f.purchase},null,8,["purchaseAble","onToggleBook","onSearchDictionary","onThemeChanged","onBookmarkAdded","onPurchase"])])),_:1},8,["modelValue"]),(0,a.Wm)(_,{ref:"dictionary"},null,512),(0,a.Wm)(n.uT,{appear:"","enter-active-class":"animated slideInDown","leave-active-class":"animated slideOutUp"},{default:(0,a.w5)((()=>[k.headerShow?((0,a.wg)(),(0,a.iD)("div",c,[(0,a._)("div",d,[(0,a.Wm)(x,{dense:"",flat:"",round:"",icon:"menu",class:"q-mx-sm",color:f.btnColor,ripple:{early:!0},onClick:f.toggleDrawer},null,8,["color","onClick"]),(0,a.Wm)(x,{color:f.btnColor,icon:"self_improvement",label:e.$q.screen.lt.sm?"":"Zen Mode",outline:"",round:e.$q.screen.lt.sm,ripple:{early:!0},onClick:f.toggleZen},null,8,["color","label","round","onClick"])]),e.$q.screen.lt.sm?(0,a.kq)("",!0):((0,a.wg)(),(0,a.iD)("div",u,[(0,a.Wm)(x,{flat:"",color:f.btnColor,onClick:f.centerBtnClicked,ripple:{early:!0}},{default:(0,a.w5)((()=>[(0,a.Wm)($,{class:"q-ma-xs gt-sm",size:"lg"},{default:(0,a.w5)((()=>[h])),_:1}),p])),_:1},8,["color","onClick"])])),(0,a._)("div",g,[e.$q.screen.gt.sm&&k.purchaseAble?((0,a.wg)(),(0,a.j4)(x,{key:0,label:"Purchase",outline:"",color:f.btnColor,icon:"shopping_cart",class:"q-ma-md",onClick:f.purchase,ripple:{early:!0}},null,8,["color","onClick"])):e.$q.screen.gt.sm&&!e.$store.getters["user/isLoggedIn"]?((0,a.wg)(),(0,a.j4)(x,{key:1,label:"Register",outline:"",color:f.btnColor,icon:"login",class:"q-ma-md",onClick:t[2]||(t[2]=t=>e.$router.push({name:"home-sign-up"})),ripple:{early:!0}},null,8,["color"])):(0,a.kq)("",!0),(0,a.Wm)(x,{round:e.$q.screen.lt.sm,label:e.$q.screen.lt.sm?"":"Settings",outline:"",color:f.btnColor,icon:"settings",class:"q-ma-md",onClick:t[3]||(t[3]=e=>k.settingsDialog=!0),ripple:{early:!0}},null,8,["round","label","color"]),(0,a.Wm)(x,{round:"",outline:"",color:f.btnColor,icon:"expand_less",onClick:t[4]||(t[4]=e=>k.headerShow=!1),class:"q-ma-md",ripple:{early:!0}},null,8,["color"])])])):(0,a.kq)("",!0)])),_:1}),(0,a._)("div",{class:"transparent-area",onClick:t[5]||(t[5]=e=>k.headerShow=!0)}),(0,a._)("div",{onClick:t[6]||(t[6]=(...e)=>f.onClick&&f.onClick(...e))},[(0,a.Wm)(C,{onNavAdded:f.addNav,onSwiped:f.handleSwipe,ref:"book",class:(0,s.C_)(["book",k.bookcss])},null,8,["onNavAdded","onSwiped","class"]),(0,a.kq)("",!0)]),(0,a.Wm)(D,{direction:"left",exist:!0,ref:"drawer"},{default:(0,a.w5)((()=>[(0,a._)("div",{class:(0,s.C_)(["relative side-bar",k.sideBarClasses])},[(0,a._)("div",m,[(0,a.Wm)(T,{contents:k.navigations,onClicked:f.navClicked},null,8,["contents","onClicked"])]),(0,a.Wm)(x,{color:f.btnColor,outline:"",icon:"arrow_back",label:"Back",onClick:t[7]||(t[7]=t=>(k.headerShow=!1,e.$router.go(-1))),class:"absolute-bottom",style:{"max-width":"110px"}},null,8,["color"])],2)])),_:1},512),(0,a.Wm)(S)])],64)}var f=o(3615);function v(e,t,o,n,i,r){const l=(0,a.up)("loading-screen"),c=(0,a.up)("book-page"),d=(0,a.up)("book-cover"),u=(0,a.up)("flipbook"),h=(0,a.Q2)("touch-swipe");return(0,a.wg)(),(0,a.iD)("div",null,[i.loading?((0,a.wg)(),(0,a.j4)(l,{key:0,text:i.loadingText},null,8,["text"])):(0,a.kq)("",!0),i.loading?((0,a.wg)(),(0,a.j4)(c,{key:1,pageNum:1,header:"title",text:"",class:(0,s.C_)(["transparent",i.widthClass]),fontSize:i.fontSize,style:{opacity:"0"}},null,8,["class","fontSize"])):(0,a.kq)("",!0),i.loading?(0,a.kq)("",!0):(0,a.wy)(((0,a.wg)(),(0,a.j4)(u,{key:2,width:i.width,height:i.height,size:"fixed",usePortrait:!0,maxShadowOpacity:.3,autoSize:!0,showCover:!0,mobileScrollSupport:!0,startZIndex:0,flippingTime:800,disableFlipByClick:!0,ref:"flipbook",id:"flipbook",onFlipbookInit:r.onFlipbookInit,onPageTurned:r.onPageTurn},{default:(0,a.w5)((()=>[(0,a.Wm)(d,{url:i.frontCover},null,8,["url"]),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(i.pages,(e=>((0,a.wg)(),(0,a.j4)(c,{key:e.pageNum,pageNum:e.pageNum,header:e.header,text:e.text,fontSize:i.fontSize},null,8,["pageNum","header","text","fontSize"])))),128)),(0,a.Wm)(d,{url:i.backCover},null,8,["url"])])),_:1},8,["width","height","maxShadowOpacity","onFlipbookInit","onPageTurned"])),[[h,r.handleSwipe]])])}o(246);const b={ref:"parentElement",class:"flipbook"};function y(e,t,o,n,s,i){return(0,a.wg)(),(0,a.iD)("div",b,[(0,a.WI)(e.$slots,"default",{},void 0,!0)],512)}var w=o(2094);const _={name:"Flipbook",props:{width:{type:Number,required:!0},height:{type:Number,required:!0},size:{validator:function(e){return-1!==["fixed","stretch"].indexOf(e)}},minWidth:{type:Number,required:!1},maxWidth:{type:Number,required:!1},minHeight:{type:Number,required:!1},maxHeight:{type:Number,required:!1},drawShadow:{type:Boolean,default:!0},flippingTime:{type:Number,default:1e3},usePortrait:{type:Boolean,default:!0},startZIndex:{type:Number,default:0},startPage:{type:Number,default:0},autoSize:{type:Boolean,default:!0},maxShadowOpacity:{type:Number,default:1,validator:function(e){return e>=0&&e<=1}},showCover:{type:Boolean,default:!1},mobileScrollSupport:{type:Boolean,default:!0},swipeDistance:{type:Number,default:30},clickEventForward:{type:Boolean,default:!0},useMouseEvents:{type:Boolean,default:!0},disableFlipByClick:{type:Boolean,default:!1}},mounted(){this.createFlipbook()},data(){return{pageFlip:""}},methods:{createFlipbook(){const e=this.$refs.parentElement,t={width:this.$props.width,height:this.$props.height,size:this.$props.size,minWidth:this.$props.minWidth,maxWidth:this.$props.maxWidth,minHeight:this.$props.minHeight,maxHeight:this.$props.maxHeight,drawShadow:this.$props.drawShadow,flippingTime:this.$props.flippingTime,usePortrait:this.$props.usePortrait,startZIndex:this.$props.startZIndex,startPage:this.$props.startPage,autoSize:this.$props.autoSize,maxShadowOpacity:this.$props.maxShadowOpacity,showCover:this.$props.showCover,mobileScrollSupport:this.$props.mobileScrollSupport,swipeDistance:this.$props.swipeDistance,clickEventForward:this.$props.clickEventForward,useMouseEvents:this.$props.useMouseEvents,disableFlipByClick:this.$props.disableFlipByClick},o=new w.PageFlip(e,t);o.getFlipController()?o.updateFromHtml(document.querySelectorAll(".page")):o.loadFromHTML(document.querySelectorAll(".page")),o.on("init",(e=>{this.$emit("flipbookInit",e.data)})),o.on("flip",(e=>{this.$emit("pageTurned",e.data)})),this.pageFlip=o},updateFromHtml(){this.pageFlip.updateFromHtml(document.querySelectorAll(".page"))},getOrientation(){return this.pageFlip.getOrientation()},getPageCount(){this.pageFlip.getPageCount()},flip(e,t=""){(t="")&&(t=this.getCorner()),this.pageFlip.flip(e,t)},flipNext(e=""){e||(e=this.getCorner()),this.pageFlip.flipNext(e)},flipPrev(e=""){e||(e=this.getCorner()),this.pageFlip.flipPrev(e)},turnToPage(e){this.pageFlip.turnToPage(e)},turnToPrevPage(){this.pageFlip.turnToPrevPage()},destroy(){this.pageFlip.destroy()},getCorner(){let e=["top","bottom"],t=e[Math.floor(Math.random()*e.length)];return t}}};var x=o(4260);const $=(0,x.Z)(_,[["render",y],["__scopeId","data-v-63f8dc19"]]),C=$,T={class:"page-content"},D={class:"page-header"},S=["innerHTML"],q={class:"page-footer"};function B(e,t,o,n,i,r){return(0,a.wg)(),(0,a.iD)("div",{class:(0,s.C_)(["page",n.pageClasses])},[(0,a._)("div",T,[(0,a._)("h2",D,(0,s.zw)(e.$props.header),1),(0,a._)("div",{class:"page-text",innerHTML:e.$props.text,style:(0,s.j5)(e.$props.fontSize)},null,12,S),(0,a._)("div",q,(0,s.zw)(e.$props.pageNum),1)])],2)}var W=o(8825),H=o(1959);const P={name:"Page",props:{pageNum:{type:Number,required:!0},header:{type:String,required:!0},text:{type:String,required:!0},fontSize:{type:String,required:!0}},setup(){const e=(0,W.Z)(),t=(0,H.qj)({"page-dark--default":e.dark.isActive});return(0,a.YP)((()=>e.dark.isActive),(e=>{t["page-dark--default"]=!!e})),{pageClasses:t}}},L=(0,x.Z)(P,[["render",B],["__scopeId","data-v-826e132e"]]),M=L,Z=["src","alt"];function N(e,t,o,n,i,r){return(0,a.wg)(),(0,a.iD)("div",{class:(0,s.C_)(["page",n.pageClasses])},[(0,a._)("img",{class:"cover-img",src:e.$props.url,alt:e.$props.url},null,8,Z)],2)}const I={name:"Reader Book Cover",props:{url:{type:String,required:!0}},setup(){const e=(0,W.Z)(),t=(0,H.qj)({"page--dark":e.dark.isActive});return(0,a.YP)((()=>e.dark.isActive),(e=>{t["page--dark"]=!!e})),{pageClasses:t}}};var A=o(4027),j=o(7518),F=o.n(j);const O=(0,x.Z)(I,[["render",N],["__scopeId","data-v-74f6b55d"]]),U=O;F()(I,"components",{QImg:A.Z});const E={class:"loader-wrapper"};function R(e,t,o,i,r,l){return(0,a.wg)(),(0,a.iD)("div",E,[(0,a.Wm)(n.uT,{appear:"","enter-active-class":"animated fadeIn","leave-active-class":"animated fadeOut"},{default:(0,a.w5)((()=>[((0,a.wg)(),(0,a.iD)("div",{class:"loading-text-container",key:o.text},[(0,a._)("div",{class:(0,s.C_)(["loading-text",i.loadingTextClasses])},[(0,a._)("h3",null,(0,s.zw)(o.text),1),(0,a._)("div",null,[(0,a._)("div",{class:(0,s.C_)(["clock-loader",i.clockLoaderClasses])},null,2)])],2)]))])),_:1})])}const z={name:"LoadingScreen",props:{text:{type:String,required:!0}},setup(){const e=(0,W.Z)(),t=(0,H.qj)({"loading-text--dark":e.dark.isActive}),o=(0,H.qj)({"clock-loader--dark":e.dark.isActive});return(0,a.YP)((()=>e.dark.isActive),(e=>{e?(t["loading-text--dark"]=!0,o["clock-loader--dark"]=!0):(t["loading-text--dark"]=!1,o["clock-loader--dark"]=!1)})),{loadingTextClasses:t,clockLoaderClasses:o}}},V=(0,x.Z)(z,[["render",R],["__scopeId","data-v-676f90f7"]]),G=V;var Q=o(1768),Y=o(9582),K=o(2471),X=o(3617),J=function(e,t,o,a){function n(e){return e instanceof o?e:new o((function(t){t(e)}))}return new(o||(o=Promise))((function(o,s){function i(e){try{l(a.next(e))}catch(t){s(t)}}function r(e){try{l(a["throw"](e))}catch(t){s(t)}}function l(e){e.done?o(e.value):n(e.value).then(i,r)}l((a=a.apply(e,t||[])).next())}))};function ee(){const e=(0,Y.yj)(),t=(0,X.oR)(),o=()=>J(this,void 0,void 0,(function*(){let t,o;try{t=yield Q.api.get("manuscripts/"+e.query.manuscript_id+"/blocks"),o=t.data}catch(a){console.log(a)}return o})),a=()=>J(this,void 0,void 0,(function*(){let t;const o=e.query.book_id;yield n(o);try{t=yield Q.api.get("books/"+o+"/blocks");const e=t.data;return e}catch(a){console.log(a)}})),n=e=>J(this,void 0,void 0,(function*(){let o;K.Z.has(`last_read_${e}`)||(o=t.getters["user/isLoggedIn"]?yield Q.api.post(`books/${e}/read`):yield Q.api.get(`books/${e}/read`),K.Z.set(`last_read_${e}`,"",{expires:"1h",path:"/"}))}));return{fetchManuscript:o,fetchBook:a}}const te=(0,H.qj)([]);function oe(){const e=(e,t)=>{const o={header:e,pageNum:te.length+1,text:t};te.push(o)},t=()=>{te.length=0};return{pages:(0,H.OT)(te),createPage:e,clearPages:t}}const ae=(0,H.qj)([]);function ne(){const e=e=>{"active"in e||(e.active=!1),ae.push(e)},t=()=>{ae.length=0};return{navigations:(0,H.OT)(ae),addNav:e,clearNav:t}}const se={title:"",description:"",front_cover:"",back_cover:"",front_matters:[],main_text:{title:"",pages:[]},chapters:[],back_matters:[]},ie=(0,H.qj)(se);let re="chapters",le=0;function ce(){const e=(0,W.Z)(),{pages:t,createPage:o}=oe(),{addNav:a}=ne(),n=(e,t)=>{const o=ie[e];Array.isArray(o)&&(o.push(t),r(e,o.length))},s=e=>{ie["main_text"]=e,r("main_text",0)},i=()=>{ie.front_matters.length=0,ie.chapters.length=0,ie.main_text["title"]="",ie.main_text["pages"].length=0,ie.back_matters.length=0},r=(e,t)=>{re=e,le=t},l=e=>{let t;t="main_text"==re?ie[re]:ie[re][le-1],t.pages.push(e)},c=e=>(d(e),u(e,"front_matters"),"chapters"in e&&e.chapters.length>0?u(e,"chapters"):null!=e.main_text&&h(e),u(e,"back_matters"),p(e),e),d=t=>{const n={type:"book",data:t["title"],page:1,active:!1};a(n),e.screen.gt.sm&&o(t["title"],"")},u=(e,n)=>{const s=e[n];for(const i of s){const e=n.slice(0,-1),s={type:e,data:i["title"],page:t.length+1};a(s);for(const t of i["pages"])o(i["title"],t)}},h=e=>{const t=e["main_text"];for(const a of t["pages"])o(t["title"],a)},p=a=>{e.screen.gt.sm&&(o(a["title"],""),t.length%2==1&&o(a["title"],""))};return{book_copy:ie,addComponent:n,addMainText:s,clearBookCopy:i,addPageToCurrentComponent:l,loadBookCopy:c}}var de=o(6017);const ue=(e,t={})=>{let o="<"+e;for(const a in t)o=o+" "+a+"='"+t[a]+"'";return o+=">",o},he=["img","hr","br"],pe=e=>he.includes(e)?"":"</"+e+">",ge=(e,t,o)=>{e=e.split(" ").slice(o).join(" ");const a=e.split(" ");for(let n=0;n<a.length;n++)if(a[n].includes(t))return n+o;return-1},me=(e,t,o)=>{const a=e.length;let n=-1;while(o--&&n++<a)if(n=e.indexOf(t,n),n<0)break;return n},ke=(e,t,o)=>null===e?-1:!o||isNaN(o)||o<=1?e.lastIndexOf(t):(o--,e.lastIndexOf(t,ke(e,t,o)-1));function fe(){const e=(0,H.qj)([]),t=(e,t)=>{const o=e.split(" "),a=o[t];let n=a.slice(1);n.includes(">")&&(n=n.slice(0,n.length-1));const s=a.indexOf(">");-1!=s&&a.slice(0,s);const l=i(e.split(" ").slice(t).join(" ")),c=ue(n,l);let d="";return r(e,t)||(d=pe(n)),{openingTag:c,closingTag:d}},o=t=>(e.push(t),e),a=()=>{const t=e.pop();return t},n=()=>{e.length=0},s=e=>{if(-1!=me(e,"=",1)){const t=me(e,"=",1),o=me(e," ",1),a=e.slice(o+1,t),n=me(e,'"',1),s=me(e,'"',2),i=e.slice(n+1,s),r=e.slice(s+1);return{name:a,value:i,returnedText:r}}return{}},i=e=>{const t={},o=e.indexOf(">");e=e.slice(0,o);let a=!0;while(a){const{name:o,value:n,returnedText:i}=s(e);e=i,void 0==o?a=!1:t[o]=n}return t},r=(e,t)=>{const o=ge(e,">",t),a=e.split(" ")[o],n="/"==a[a.length-2];return n};return{tags:e,getTags:t,addTags:o,removeTags:a,clearTags:n}}let ve=" ",be=!1;function ye(){const e=document.getElementsByClassName("page-text")[0],t=[],{removeTags:o}=fe(),a=o=>{const i="attributes"in o?ue(o["type"],o["attributes"]):ue(o["type"]),l=pe(o["type"]);e.innerHTML=s(e.innerHTML,` ${i} ${l}`),""!=l&&t.push({openingTag:i,closingTag:l});let c="";if("contents"in o)for(const d of o.contents)if("string"==typeof d)if(be)c+=d;else{const t=e.innerHTML;if(e.innerHTML=s(e.innerHTML,d),r(e)){be=!0,e.innerHTML=t;const o=d.split(" ");if(o.length>1){let e=0;o.length>100?e=n(o,25):o.length>50?e=n(o,10):o.length>10&&(e=n(o,5));const t=o.slice(e);e=n(t,1),c=o.slice(e).join(" ")}}}else a(d),be&&(">"==c[c.length-2]||""==c?c+=ve:c=c+"&nbsp"+ve+"&nbsp"),t.pop();if(be){if("p"==o["type"]){const e="<p  style='text-indent: 0'>";ve=e+c+l}else ve=i+c+l;t.pop()}return ve},n=(t,o)=>{let a=0,n=1,i="";while(a<t.length-1){if(i=i+t[a]+" ",n==o){const t=e.innerHTML;if(e.innerHTML=s(e.innerHTML,i),i="",r(e))return e.innerHTML=t,a-n+1;n=0}n++,a++}return a-n+1},s=(e,o)=>{let a;if(t.length>0){a=t[t.length-1]["closingTag"];let n=1;for(let e=0;e<t.length-1;e++)t[e]["closingTag"]==a&&n++;const s=ke(e,a,n),i=e.slice(s);e=e.slice(0,s),e=e+o+" "+i}else e+=o;return e},i=()=>{ve=" ",be=!1},r=e=>{const t=e.style.overflow;t&&"visible"!==t||(e.style.overflow="hidden");const o=e.clientWidth<e.scrollWidth||e.clientHeight<e.scrollHeight;return e.style.overflow=t,o};return{hasRemainingText:be,remainingText:ve,appendTextToLastPage:a,emptyRemainingText:i}}function we(){const e=e=>{let n="";switch(e.type){case"paragraph":n=t(e);break;case"heading":n=o(e);break;case"list":n=a(e);break;case"delimiter":n=s();break;case"image":n=i(e);break;default:}return n},t=e=>{const t=e.data,o=e.tunes,a="p",n=t["text"],s=o["alignment"]["alignment"],i="text-align: "+s+";",r=`<${a} style='${i}'> ${n} </${a}>`;return r},o=e=>{const t=e.data,o=e.tunes,a=t["level"],n=`h${a}`,s=t["text"],i=o["alignment"]["alignment"],r="text-align: "+i+";",l=`<${n} style='${r}'> ${s} </${n}>`;return l},a=e=>{const t=e.data,o=t["items"],a=t["style"],s="unordered"==a?"ul":"ol",i=n(o,s),r=`<${s}> ${i} </${s}>`;return r},n=(e,t)=>{let o="";for(const a of e){const e=n(a["items"],t);let s;e?s=`<li> ${a["content"]} <${t}> ${e} </${t}> </li>`:(s=`<li> ${a["content"]} </li>`,o=o+" "+s)}return o},s=()=>{const e="<div class='delimiter'></div>";return e},i=e=>{const t=e["url"],o=e["caption"],a=`<img src='${t}' alt='${o}' />`;let n="";if("unsplash"in e){const t=e["unsplash"]["author"],o=e["unsplash"]["profileLink"],a="https://unsplash.com/?utm_source=8MeSNDcetPzIRf3mcLc-_6rrHYPaZnbo6ZSLcAIFniI&utm_medium=referral";n=`<div class='img-credits'> by <a href='${o}' target='_blank'> ${t} </a> on <a href='${a}' target='_blank'> Unsplash </a> </div>`}const s=`<div class='img-container'> ${a} ${n} </div>`,i=`<div class='img-caption'> ${o} </div>`,r=`<div class='img-wrapper'> ${s} ${i} </div>`;return r};return{convertTextBlockToHTML:e}}o(2100);function _e(){const e=(e,t)=>{var o={};if("string"===typeof e){if(window.DOMParser)var a=new DOMParser,n=a.parseFromString(e,"text/xml");else{n=new ActiveXObject("Microsoft.XMLDOM");n.async=!1,n.loadXML(e)}e=n.firstChild}function s(e,t){t["type"]=e.nodeName;var o=e.childNodes;if(null!=o&&o.length){t["contents"]=[];for(var a=0;a<o.length;a++)3==o[a].nodeType?t["contents"].push(o[a].nodeValue):(t["contents"].push({}),s(o[a],t["contents"][t["contents"].length-1]))}if(null!=e.attributes&&e.attributes.length){t["attributes"]={};for(a=0;a<e.attributes.length;a++)t["attributes"][e.attributes[a].nodeName]=e.attributes[a].nodeValue}}return s(e,o),t?JSON.stringify(o):o};return{HTML2DOM:e}}function xe(){const{createPage:e}=oe(),{addPageToCurrentComponent:t}=ce(),{appendTextToLastPage:o,emptyRemainingText:a}=ye();let{remainingText:n}=ye();const{clearTags:s}=fe(),{convertTextBlockToHTML:i}=we(),{HTML2DOM:r}=_e(),l=document.getElementsByClassName("page-text")[0],c=o=>{const s=(0,de.Z)(!0,{},o),r=s.title,c=s.text;let u=0;while(u<c.length)if(" "!=n)l.innerHTML+=n,h(l)&&(l.innerHTML="",d(n,r)),n=" ";else{const o=i(c[u]),n=l.innerHTML;l.innerHTML=l.innerHTML+o,h(l)&&(l.innerHTML=n,a(),d(o,r),e(r,l.innerHTML),t(l.innerHTML),l.innerHTML=""),u++}" "!=n&&(l.innerHTML+=n,e(r,l.innerHTML),t(l.innerHTML),l.innerHTML="",n=" ")},d=(e,t)=>{let a=e;"string"!=typeof e&&(a=i(e)),a=u(a);const l=r(a,!1);s(),n=o(l)},u=e=>e.replace(/&nbsp;/g,""),h=e=>{const t=e.style.overflow;t&&"visible"!==t||(e.style.overflow="hidden");const o=e.clientWidth<e.scrollWidth||e.clientHeight<e.scrollHeight;return e.style.overflow=t,o};return{paginateText:c}}function $e(){const e=(0,W.Z)(),{paginateText:t}=xe(),{pages:o,createPage:a}=oe(),{addNav:n}=ne(),{book_copy:s,addComponent:i,addMainText:r}=ce(),l=e=>{const t=(0,H.qj)(e);return c(t),d(t,"front_matters"),"chapters"in t&&t.chapters.length>0?d(t,"chapters"):null!=t.text&&u(t),d(t,"back_matters"),h(t),t},c=t=>{const o={type:"book",data:t["title"],page:1,active:!1};n(o),s.title=t.title,s.description=t.description,s.front_cover=t.front_cover,s.back_cover=t.back_cover,e.screen.gt.sm&&a(t["title"],"")},d=(e,s)=>{const r=e[s];if(Array.isArray(r))for(let l=0;l<r.length;l++){const e=r[l];i(s,{title:e["title"],pages:[]});const c=s.slice(0,-1),d={type:c,data:e["title"],page:o.length+1};n(d),t(e);const u=document.getElementsByClassName("page-text")[0].innerHTML;""!=u&&(a(e["title"],u),document.getElementsByClassName("page-text")[0].innerHTML="")}},u=e=>{const s={type:"text",data:e["title"],page:o.length+1};n(s),r({title:e["title"],pages:[]}),t(e);const i=document.getElementsByClassName("page-text")[0].innerHTML;""!=i&&(a(e["title"],i),document.getElementsByClassName("page-text")[0].innerHTML="")},h=t=>{e.screen.gt.sm&&(a(t["title"],""),o.length%2==1&&a(t["title"],""))};return{renderBook:l}}var Ce=o(794),Te=function(e,t,o,a){function n(e){return e instanceof o?e:new o((function(t){t(e)}))}return new(o||(o=Promise))((function(o,s){function i(e){try{l(a.next(e))}catch(t){s(t)}}function r(e){try{l(a["throw"](e))}catch(t){s(t)}}function l(e){e.done?o(e.value):n(e.value).then(i,r)}l((a=a.apply(e,t||[])).next())}))};function De(){const e=(0,Y.yj)(),t=(t,o)=>Te(this,void 0,void 0,(function*(){const a=yield Q.api.get("books/"+e.query.book_id,{params:{fields:"author_name"}}),n=a.data.author_name;(0,Ce.Z)((()=>({title:`${t} | BookKay`,meta:{description:{name:"description",content:o},keywords:{name:"keywords",content:`${t}, ${n}, BookKay, ebook`},author:{name:"author",content:n}}})))}));return{updateMetaData:t}}var Se=o(7467),qe=o.n(Se);const Be=JSON.parse('{"name":"LeftHandClosed","algorithm":"fingerpose","models":"hands","confidence":7.5,"description":[["addCurl","Thumb","NoCurl",0.46153846153846156],["addCurl","Thumb","HalfCurl",1],["addCurl","Thumb","FullCurl",0.8461538461538461],["addDirection","Thumb","DiagonalUpLeft",0.30434782608695654],["addDirection","Thumb","VerticalUp",1],["addCurl","Index","FullCurl",1],["addDirection","Index","VerticalUp",0.034482758620689655],["addDirection","Index","DiagonalUpLeft",1],["addCurl","Middle","FullCurl",1],["addDirection","Middle","VerticalUp",0.875],["addDirection","Middle","DiagonalUpLeft",1],["addCurl","Ring","FullCurl",1],["addDirection","Ring","VerticalUp",1],["addCurl","Pinky","FullCurl",1],["addDirection","Pinky","VerticalUp",1]],"enabled":true}'),We=JSON.parse('{"name":"LeftHandOpened","algorithm":"fingerpose","models":"hands","confidence":7.5,"description":[["addCurl","Thumb","NoCurl",1],["addDirection","Thumb","DiagonalUpLeft",1],["addDirection","Thumb","HorizontalLeft",0.21739130434782608],["addDirection","Thumb","VerticalUp",0.08695652173913043],["addCurl","Index","NoCurl",1],["addDirection","Index","DiagonalUpLeft",1],["addDirection","Index","VerticalUp",0.42857142857142855],["addCurl","Middle","NoCurl",1],["addDirection","Middle","VerticalUp",1],["addDirection","Middle","DiagonalUpLeft",0.30434782608695654],["addCurl","Ring","NoCurl",1],["addDirection","Ring","VerticalUp",1],["addDirection","Ring","DiagonalUpLeft",0.23809523809523808],["addDirection","Ring","DiagonalUpRight",0.19047619047619047],["addCurl","Pinky","NoCurl",1],["addDirection","Pinky","VerticalUp",1],["addDirection","Pinky","DiagonalUpRight",0.36363636363636365],["setWeight","Thumb",2],["setWeight","Index",2],["setWeight","Middle",2],["setWeight","Ring",2],["setWeight","Pinky",2]],"enabled":true}');let He=(0,H.qj)({}),Pe=!1;function Le(){const e=()=>{He=new(qe())({hands:!0,debug:!1}),s();const e=1;He.model.hands.getData=He.throttle(He.model.hands.getData,1e3/e)},t=()=>{Pe?(He.stop(),Pe=!1):(He.start(),Pe=!0)},o=()=>{He.start()},a=()=>{He.stop()},n=t=>{0==Object.keys(He).length&&e(),He.useGesture(We),He.useGesture(Be),He.use("watchGesture",(e=>{"gesture"in He.data.hands&&null!=He.data.hands.gesture[0]&&("LeftHandOpened"==He.data.hands.gesture[0].name&&t("LeftHandOpened"),"LeftHandClosed"==He.data.hands.gesture[0].name&&t("LeftHandClosed"))}))},s=()=>{const e=document.getElementsByClassName("handsfree-debugger")[0],t=document.getElementsByClassName("handsfree-pointer");e.remove();for(const o of t)o.remove()};return{initHandsFree:e,useHandsGesture:n,toggleHandsFree:t,startHandsFree:o,stopHandsFree:a}}var Me=o(3317);const Ze={name:"Book",components:{Flipbook:C,BookPage:M,BookCover:U,LoadingScreen:G},created(){document.addEventListener("keydown",(e=>{this.handleKeyPress(e.key)}),{once:!0}),document.addEventListener("wheel",(e=>{this.handleScroll(e.deltaY)}),{once:!0})},async mounted(){const{fetchManuscript:e,fetchBook:t}=ee(),{renderBook:o}=$e(),{pages:a}=oe(),{loadBookCopy:n,book_copy:s}=ce(),{updateMetaData:i}=De(),{useHandsGesture:r}=Le();if(r((e=>{"LeftHandOpened"==e?this.throttledFlipNext():"LeftHandClosed"==e&&this.throttledFlipPrev()})),this.loadingText="Book Loading...Please Wait.","manuscript_id"==Object.keys(this.$route.query)[0]){const t=await e();this.book=t,this.loadingText="Configuring Covers",this.configureCovers();try{this.book=o(this.book),this.pages=a}catch(l){this.loadingText="Rendering Error :(",console.log(l)}this.loading=!1}if("book_id"==Object.keys(this.$route.query)[0]){let e,t=this.$route.query.book_id;this.$q.cookies.has(`last_read_${t}`)||(e=this.$store.getters["user/isLoggedIn"]?await this.$api.post(`books/${t}/read`):await this.$api.get(`books/${this.$route.query.book_id}/read`),this.$q.cookies.set(`last_read_${t}`,"",{expires:"1h",path:"/"}));let r=screen.height,c=window.innerWidth;if(e=await this.$api.get(`books/${t}/copy`,{params:{height:r,width:c}}),0==Object.keys(e.data).length){try{e=await this.$api.get("books/"+t+"/blocks")}catch(l){this.loadingText="Server Error :(",console.log(l)}const n=e.data;this.book=n,this.configureCovers();try{this.loadingText="First Time Loading...may take couple of minutes",this.book=o(this.book),this.pages=a,this.$api.post(`books/${t}/copy`,{height:r,width:c,json:s})}catch(l){this.loadingText="Rendering Error :(",console.log(l)}}else this.book=e.data,i(this.book.title,this.book.description),this.configureCovers(),n(this.book),this.pages=a;this.loading=!1}},data(){return{widthClass:this.$q.screen.lt.sm?"full-page":"half-page",width:this.$q.screen.lt.sm?window.innerWidth:window.innerWidth/2,height:screen.height,loading:!0,loadingText:"",lastScrollTop:0,bookConfigs:{},fontSize:"font-size: 18px",singleTags:["br","hr"],frontCover:"",backCover:"",book:{title:"",front_matters:[],chapters:[],text:"",back_matters:[]},text:"",book_copy:{front_matters:[],chapters:[],main_text:{},back_matters:[]},pages:[]}},watch:{$route(e,t){const{clearPages:o}=oe();o();const{clearBookCopy:a}=ce();a();const{clearNav:n}=ne();n();const{emptyRemainingText:s}=ye();s()}},methods:{throttledFlipNext:(0,Me.Z)((function(){this.$refs.flipbook.flipNext()}),2e3),throttledFlipPrev:(0,Me.Z)((function(){this.$refs.flipbook.flipPrev()}),2e3),loadPageFlip(){setTimeout((()=>this.$refs.flipbook.updateFromHtml()),1e3)},configureCovers(){let e=this.book.front_cover,t=this.book.back_cover,o=this.book.temp_cover;this.frontCover=""!=e?e:o,this.backCover=""!=t?t:o},turnToQueryPage(){let e=this.$route.query;if(e.hasOwnProperty("front_matter_id")&&front_matters in this.book){let t=this.book.front_matters,o=t.find((t=>t.front_matter_id===e.front_matter_id));this.$refs.flipbook.flip(o.pageNum)}else if(e.hasOwnProperty("chapter_id")&&chapters in this.book){let t=this.book.chapters,o=t.find((t=>t.chapter_id===e.chapter_id));this.$refs.flipbook.flip(o.pageNum)}else if(e.hasOwnProperty("back_matter_id")&&back_matters in this.book){let t=this.book.back_matters,o=t.find((t=>t.back_matter_id===e.back_matter_id));this.$refs.flipbook.flip(o.pageNum)}},onFlipbookInit(){let e=this.$route.query.book_id;if(Object.keys(this.$route.query)>0&&this.turnToQueryPage(),this.$q.localStorage.has(`pageNumOf_${e}`)){let t=this.$q.localStorage.getItem(`pageNumOf_${e}`);this.$refs.flipbook.flip(t)}},onPageTurn(e){if("book_id"in this.$route.query){let t=this.$route.query.book_id;this.$q.localStorage.set(`pageNumOf_${t}`,e)}},handleKeyPress(e){if(this.$refs.flipbook&&!this.loading){switch(e){case"ArrowLeft":this.$refs.flipbook.flipPrev();break;case"ArrowRight":this.$refs.flipbook.flipNext();break;case"ArrowDown":this.$refs.flipbook.flipNext();break;case"ArrowUp":this.$refs.flipbook.flipPrev();break;case"AudioVolumeUp":this.$refs.flipbook.flipNext();break;case"AudioVolumeDown":this.$refs.flipbook.flipPrev();break;default:}document.addEventListener("keydown",(e=>{this.handleKeyPress(e.key)}),{once:!0})}},handleScroll(e){this.$refs.flipbook&&(e<0?this.$refs.flipbook.flipPrev():e>0&&this.$refs.flipbook.flipNext(),document.addEventListener("wheel",(e=>{this.handleScroll(e.deltaY)}),{once:!0}))},handleSwipe({...e}){const t=e.direction;"right"==t?this.$refs.flipbook.turnToPrevPage():"left"==t?this.$refs.flipbook.flipNext():"top"==t?this.$emit("swiped","top"):"down"==t&&this.$emit("swiped","down")}}};var Ne=o(8020);const Ie=(0,x.Z)(Ze,[["render",v],["__scopeId","data-v-339296c1"]]),Ae=Ie;F()(Ze,"directives",{TouchSwipe:Ne.Z});const je={class:"contents"};function Fe(e,t,o,n,s,i){const r=(0,a.up)("text-block-heading"),l=(0,a.up)("text-block-paragraph"),c=(0,a.up)("text-block-image"),d=(0,a.up)("text-block-list"),u=(0,a.up)("text-block-delimiter"),h=(0,a.up)("text-card");return(0,a.wg)(),(0,a.iD)("main",je,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.textBlocks,(t=>((0,a.wg)(),(0,a.j4)(h,{key:t.meta.index,currentState:t.meta.state,text:t.text,header:t.meta.header,onNextClicked:e.handleNext,onPrevClicked:e.handlePrev},{default:(0,a.w5)((()=>["heading"==t.type?((0,a.wg)(),(0,a.j4)(r,{key:0,textBlock:t},null,8,["textBlock"])):"paragraph"==t.type?((0,a.wg)(),(0,a.j4)(l,{key:1,textBlock:t},null,8,["textBlock"])):"image"==t.type?((0,a.wg)(),(0,a.j4)(c,{key:2,textBlock:t},null,8,["textBlock"])):"list"==t.type?((0,a.wg)(),(0,a.j4)(d,{key:3,textBlock:t},null,8,["textBlock"])):"delimiter"==t.type?((0,a.wg)(),(0,a.j4)(u,{key:4,textBlock:t},null,8,["textBlock"])):(0,a.kq)("",!0)])),_:2},1032,["currentState","text","header","onNextClicked","onPrevClicked"])))),128))])}const Oe=e=>((0,a.dD)("data-v-ee31702e"),e=e(),(0,a.Cn)(),e),Ue=Oe((()=>(0,a._)("img",{src:"svg/book_lover.svg",class:"img","data-atropos-offset":"-5"},null,-1))),Ee={class:"card"},Re={class:"card-header"},ze={class:"card-contents"};function Ve(e,t,o,n,i,r){const l=(0,a.up)("atropos");return(0,a.wg)(),(0,a.iD)("div",{class:(0,s.C_)(["atropos-container",n.classObject])},[(0,a.Wm)(l,{"active-offset":40,shadow:!1,"shadow-scale":0,class:"atropos-element",onEnter:n.onEnter,onLeave:n.onLeave,onRotate:n.onRotate},{default:(0,a.w5)((()=>[Ue,(0,a._)("div",Ee,[(0,a._)("div",Re,(0,s.zw)(e.$props.header),1),(0,a._)("div",ze,[(0,a.WI)(e.$slots,"default",{},void 0,!0)])])])),_:3},8,["onEnter","onLeave","onRotate"])],2)}var Ge=o(8981);const Qe={components:{Atropos:Ge.Z},props:{currentState:{validator(e){return["notShown","showing","shown"].includes(e)}},text:{type:String,required:!0},header:{type:String}},setup(e,{emit:t}){const o=()=>console.log("Enter"),a=()=>console.log("Leave"),n=(e,t)=>console.log("Rotate",e,t),s=(0,H.Fl)((()=>({"atropos-container--not-shown":"notShown"==e["currentState"],"atropos-container--shown":"shown"==e["currentState"]}))),i=()=>{t("nextClicked")},r=()=>{t("prevClicked")};return{onEnter:o,onLeave:a,onRotate:n,classObject:s,next:i,prev:r}}},Ye=(0,x.Z)(Qe,[["render",Ve],["__scopeId","data-v-ee31702e"]]),Ke=Ye,Xe=["innerHTML"];function Je(e,t,o,n,s,i){const r=(0,a.up)("nav-buttons");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a._)("div",{class:"card-text",innerHTML:e.text,"data-atropos-offset":"6"},null,8,Xe),(0,a.Wm)(r)],64)}const et=(0,H.iH)(0),tt=(0,H.qj)([]);function ot(){const e=e=>{tt.push(e)},t=()=>{tt[0].meta.state="showing"},o=()=>{if(et.value!=tt.length-1){et.value++;const e=tt.find((e=>e.meta.index===et.value-1));void 0!=e&&(e.meta.state="shown");const t=tt.find((e=>e.meta.index===et.value));void 0!=t&&(t.meta.state="showing")}},a=()=>{if(0!=et.value){et.value--;const e=tt.find((e=>e.meta.index===et.value+1));void 0!=e&&(e.meta.state="notShown");const t=tt.find((e=>e.meta.index===et.value));void 0!=t&&(t.meta.state="showing")}};return{textBlocks:tt,initFirstBlock:t,addTextBlock:e,nextTextBlock:o,prevTextBlock:a}}const at={"data-atropos-offset":"4",class:"card-contents-btns"};function nt(e,t,o,n,s,i){const r=(0,a.up)("q-btn");return(0,a.wg)(),(0,a.iD)("div",at,[(0,a.Wm)(r,{label:"Prev",icon:"arrow_back",outline:"",rounded:"",ripple:{early:!0},onClick:e.prevTextBlock},null,8,["onClick"]),(0,a.Wm)(r,{label:"Next","icon-right":"arrow_forward",class:"next-btn",outline:"",rounded:"",ripple:{early:!0},onClick:e.nextTextBlock},null,8,["onClick"])])}const st=(0,a.aZ)({setup(){const{prevTextBlock:e,nextTextBlock:t}=ot();return{prevTextBlock:e,nextTextBlock:t}}});var it=o(8240);const rt=(0,x.Z)(st,[["render",nt],["__scopeId","data-v-cf5bca9e"]]),lt=rt;F()(st,"components",{QBtn:it.Z});const ct=(0,a.aZ)({components:{NavButtons:lt},props:{textBlock:{type:Object}},setup(e){const{nextTextBlock:t}=ot(),o=(0,H.iH)("");(0,a.bv)((()=>{o.value=n(e["textBlock"])}));const n=e=>{const t=e.data,o=e.tunes,a=t["level"],n=`h${a}`,s=t["text"],i=o["alignment"]["alignment"],r="text-align: "+i+";",l=`<${n} style='${r}'>${s}</${n}>`;return l};return{text:o,nextTextBlock:t}}}),dt=(0,x.Z)(ct,[["render",Je],["__scopeId","data-v-f784392a"]]),ut=dt,ht=["innerHTML"];function pt(e,t,o,n,s,i){const r=(0,a.up)("nav-buttons");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a._)("div",{class:"card-text",innerHTML:e.text,"data-atropos-offset":"4"},null,8,ht),(0,a.Wm)(r)],64)}const gt=(0,a.aZ)({components:{NavButtons:lt},props:{textBlock:{type:Object}},setup(e){const t=(0,H.iH)("");(0,a.bv)((()=>{t.value=o(e["textBlock"])}));const o=e=>{const t=e.data,o=e.tunes,a="p",n=t["text"],s=o["alignment"]["alignment"],i="text-align: "+s+";",r=`<${a} style='${i}'>${n}</${a}>`;return r};return{text:t}}}),mt=(0,x.Z)(gt,[["render",pt],["__scopeId","data-v-695540da"]]),kt=mt,ft=["innerHTML"];function vt(e,t,o,n,s,i){const r=(0,a.up)("nav-buttons");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a._)("div",{class:"card-text",innerHTML:e.text,"data-atropos-offset":"4"},null,8,ft),(0,a.Wm)(r)],64)}const bt=(0,a.aZ)({components:{NavButtons:lt},props:{textBlock:{type:Object,required:!0}},setup(e){const t=(0,H.iH)("");(0,a.bv)((()=>{const a=e["textBlock"];t.value=o(a)}));const o=e=>{const t=e["url"],o=e["caption"],a=`<img src='${t}' alt='${o}' />`;let n="";if("unsplash"in e){const t=e["unsplash"]["author"],o=e["unsplash"]["profileLink"],a="https://unsplash.com/?utm_source=8MeSNDcetPzIRf3mcLc-_6rrHYPaZnbo6ZSLcAIFniI&utm_medium=referral";n=`<div class='img-credits'>by <a href='${o}' target='_blank'>${t}</a> on <a href='${a}' target='_blank'>Unsplash</a></div>`}const s=`<div class='img-container'>${a}${n}</div>`,i=`<div class='img-caption'>${o}</div>`,r=`<div class='img-wrapper'>${s}${i}</div>`;return r};return{text:t}}}),yt=(0,x.Z)(bt,[["render",vt],["__scopeId","data-v-762accc4"]]),wt=yt,_t=["innerHTML"];function xt(e,t,o,n,s,i){const r=(0,a.up)("nav-buttons");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a._)("div",{class:"card-text",innerHTML:e.text,"data-atropos-offset":"4"},null,8,_t),(0,a.Wm)(r)],64)}const $t=(0,a.aZ)({components:{NavButtons:lt},props:{textBlock:{type:Object}},setup(e){const t=(0,H.iH)("");(0,a.bv)((()=>{t.value=o(e["textBlock"])}));const o=e=>{const t=e.data,o=t["items"],a=t["style"],s="unordered"==a?"ul":"ol",i=n(o,s),r=`<${s}>${i}</${s}>`;return r},n=(e,t)=>{let o="";for(const a of e){const e=n(a["items"],t);let s;e?s=`<li>${a["content"]}<${t}>${e}</${t}></li>`:(s=`<li>${a["content"]}</li>`,o+=s)}return o};return{text:t}}}),Ct=(0,x.Z)($t,[["render",xt],["__scopeId","data-v-50bc0004"]]),Tt=Ct,Dt=["innerHTML"];function St(e,t,o,n,s,i){const r=(0,a.up)("nav-buttons");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a._)("div",{class:"card-text",innerHTML:e.text,"data-atropos-offset":"4"},null,8,Dt),(0,a.Wm)(r)],64)}const qt=(0,a.aZ)({components:{NavButtons:lt},props:{textBlock:{type:Object}},setup(e){const t=(0,H.iH)("");(0,a.bv)((()=>{t.value=o()}));const o=()=>{const e="<div class='delimiter'></div>";return e};return{text:t}}}),Bt=(0,x.Z)(qt,[["render",St]]),Wt=Bt;var Ht=function(e,t,o,a){function n(e){return e instanceof o?e:new o((function(t){t(e)}))}return new(o||(o=Promise))((function(o,s){function i(e){try{l(a.next(e))}catch(t){s(t)}}function r(e){try{l(a["throw"](e))}catch(t){s(t)}}function l(e){e.done?o(e.value):n(e.value).then(i,r)}l((a=a.apply(e,t||[])).next())}))};function Pt(){const e=(0,Y.yj)(),t=(0,X.oR)(),o=()=>Ht(this,void 0,void 0,(function*(){let t,o;try{t=yield Q.api.get("manuscripts/"+e.query.manuscript_id+"/blocks"),o=t.data}catch(a){console.log(a)}return o})),a=()=>Ht(this,void 0,void 0,(function*(){let t;const o=e.query.book_id;yield n(o);try{t=yield Q.api.get("books/"+o+"/blocks");const e=t.data;return e}catch(a){console.log(a)}})),n=e=>Ht(this,void 0,void 0,(function*(){let o;K.Z.has(`last_read_${e}`)||(o=t.getters["user/isLoggedIn"]?yield Q.api.post(`books/${e}/read`):yield Q.api.get(`books/${e}/read`),K.Z.set(`last_read_${e}`,"",{expires:"1h",path:"/"}))}));return{fetchManuscript:o,fetchBook:a}}const Lt=e=>{const t=e.toLowerCase().split(" ");for(let o=0;o<t.length;o++)t[o]=t[o].charAt(0).toUpperCase()+t[o].substring(1);return t.join(" ")};function Mt(){const{addTextBlock:e}=ot(),t=e=>{const t=(0,H.qj)(e);let n=[];return n=o(t,"front_matters",n),"chapters"in t&&t.chapters.length>0?n=o(t,"chapters",n):null!=t.text&&(n=a(t,n)),n=o(t,"back_matters",n),n},o=(t,o,a)=>{const n=t[o];if(Array.isArray(n))for(let s=0;s<n.length;s++){const t=n[s],a=t["text"];for(let n=0;n<a.length;n++){const t=a[n];let i=o.slice(0,-1);i=i.replace("_"," "),i=Lt(i),i+=` - ${s+1}`;const r={index:n,header:i,state:"notShown"};t.meta=r,e(t)}}return a},a=(t,o)=>{const a=t["text"];for(let n=0;n<a.length;n++){const o=a[n],s=t["title"],i={index:n,header:s,state:"notShown"};o.meta=i,e(o)}return o};return{renderBook:t}}var Zt=function(e,t,o,a){function n(e){return e instanceof o?e:new o((function(t){t(e)}))}return new(o||(o=Promise))((function(o,s){function i(e){try{l(a.next(e))}catch(t){s(t)}}function r(e){try{l(a["throw"](e))}catch(t){s(t)}}function l(e){e.done?o(e.value):n(e.value).then(i,r)}l((a=a.apply(e,t||[])).next())}))};const Nt=(0,a.aZ)({name:"ShortieView",components:{TextCard:Ke,TextBlockHeading:ut,TextBlockParagraph:kt,TextBlockImage:wt,TextBlockList:Tt,TextBlockDelimiter:Wt},setup(){const e=(0,Y.yj)(),{fetchManuscript:t,fetchBook:o}=Pt(),{renderBook:n}=Mt(),{textBlocks:s,initFirstBlock:i,nextTextBlock:r,prevTextBlock:l}=ot(),c={title:"",description:"",front_cover:"",back_cover:"",front_matters:[],chapters:[],back_matters:[],text:[]},d=(0,H.qj)(c);return(0,a.bv)((()=>Zt(this,void 0,void 0,(function*(){if("manuscript_id"==Object.keys(e.query)[0]){let e=yield t();Object.assign(d,e)}else if("book_id"==Object.keys(e.query)[0]){let e=yield o();Object.assign(d,e)}n(d),i()})))),{textBlocks:s,nextTextBlock:r,prevTextBlock:l}}}),It=(0,x.Z)(Nt,[["render",Fe],["__scopeId","data-v-129ea4be"]]),At=It,jt={key:0},Ft={class:"overlay",ref:"overlay"};function Ot(e,t,o,n,i,r){return r.enabled?((0,a.wg)(),(0,a.iD)("section",jt,[(0,a._)("aside",{class:"sidebar",style:(0,s.j5)(r.style),ref:"element"},[(0,a.WI)(e.$slots,"default",{},void 0,!0)],4),(0,a._)("div",Ft,null,512)])):(0,a.kq)("",!0)}const Ut={name:"Drawer",props:["direction","exist"],data(){return{auto_speed:"0.3s",manual_speed:"0.03s",threshold:20,startTime:null,startPos:null,translate:null,active:!1,visible:!0}},computed:{element:function(){return this.$refs.element},overlay:function(){return this.$refs.overlay},enabled:function(){return 1==this.exist},style:function(){return"right"==this.direction?"transform:translate3d(100%,0,0);right:0;":"transform:translate3d(-100%,0,0);left:0;"}},mounted(){document.addEventListener("touchstart",(e=>{this.handleStart(e)})),document.addEventListener("touchmove",(e=>{this.handleMove(e)})),document.addEventListener("touchend",(e=>{this.handleEnd(e)})),document.addEventListener("touchcancel",(e=>{this.handleEnd(e)})),window.addEventListener("resize",(e=>{this.setVisibality(e)}),!0),this.overlay.addEventListener("transitionend",(e=>{this.handleZindex(e)}),!1),this.overlay.addEventListener("click",(e=>{this.close()}),!1),this.setVisibality()},methods:{setVisibality(){0==this.element.offsetWidth?this.visible=!1:this.visible=!0},handleStart(e){this.startTime=(new Date).getTime(),this.startPos=e.targetTouches[0].pageX,this.element.style.transitionDuration=this.manual_speed},handleMove(e){let t=this.gesture(e),o=this.validate(this.direction,t);if(o){let o=this.percentage(this.direction,t);"left"==this.direction?(this.translate=e.touches[0].pageX-this.element.offsetWidth,this.translate<0?this.element.style.transform="translate3d("+this.translate+"px,0,0)":this.open()):(this.translate=-(screen.width-this.element.offsetWidth-e.touches[0].pageX),this.translate>0?this.element.style.transform="translate3d("+this.translate+"px,0,0)":this.open()),this.overlayOpacity(o/100)}},handleEnd(e){let t=this.speed(e),o=this.gesture(e),a=this.validate(this.direction,o);a&&(t>.6?this.active?this.close():this.open():this.element.offsetWidth/2>Math.abs(this.translate)?this.open():this.close())},handleZindex(){let e=window.getComputedStyle(this.overlay).getPropertyValue("opacity");e<=0&&(this.overlay.style.zIndex=-999)},validate(e,t){if("left"==e){if(this.active&&"swiperight"==t||!this.active&&("swipeleft"==t||this.startPos>this.threshold))return!1}else if(this.active&&"swipeleft"==t||!this.active&&("swiperight"==t||this.startPos<screen.width-this.threshold))return!1;return!(document.querySelector(".sidebar.active")&&!this.active||!this.visible)},overlayOpacity(e){this.overlay.style.opacity=e,e>0&&(this.overlay.style.zIndex=999)},gesture(e){let t=["swipeleft","swiperight"],o=e.changedTouches[0].pageX;return this.startPos-o<0?t[1]:t[0]},open(){this.translate=0,this.element.style.transform="translate3d("+this.translate+",0,0)",this.element.style.transitionDuration=this.auto_speed,this.overlayOpacity(1),this.lock(document.querySelector("html")),this.lock(document.querySelector("body")),this.element.classList.add("active"),this.active=!0},close(){"left"==this.direction?this.translate="-"+this.element.offsetWidth+"px":this.translate=this.element.offsetWidth+"px",this.element.style.transform="translate3d("+this.translate+",0,0)",this.element.style.transitionDuration=this.auto_speed,this.overlayOpacity(0),this.unlock(document.querySelector("html")),this.unlock(document.querySelector("body")),this.element.classList.remove("active"),this.active=!1},speed(e){let t=(new Date).getTime()-this.startTime,o=Math.abs(this.startPos),a=Math.abs(e.changedTouches[0].pageX),n=o>a?o-a:a-o;return n/t},percentage(e,t){let o=0,a=[];return a="left"==e?["swipeleft","swiperight"]:["swiperight","swipeleft"],this.active&&t==a[0]&&(o=100-Math.round(Math.abs(this.translate)/this.element.offsetWidth*100)),this.active||t!=a[1]||(o=Math.round(100-Math.abs(this.translate)/this.element.offsetWidth*100)),o>100&&(o=100),o<0&&(o=0),o},lock(e){e.style.overflow="hidden",e.style.touchAction="none"},unlock(e){e.style.removeProperty("overflow"),e.style.removeProperty("touch-action")}},unmounted(){this.unlock(document.querySelector("html")),this.unlock(document.querySelector("body"))}},Et=(0,x.Z)(Ut,[["render",Ot],["__scopeId","data-v-971be5f8"]]),Rt=Et;var zt=o(7535);const Vt=(0,a.Uk)(" Gesture Control"),Gt=(0,a.Uk)(" Rest & Chill"),Qt=(0,a.Uk)(" Dark Mode"),Yt=(0,a.Uk)(" HotKeys"),Kt=(0,a.Uk)(" Dictionary"),Xt=(0,a.Uk)(" Bookmark "),Jt=(0,a.Uk)(" Purchase"),eo=(0,a.Uk)(" Register");function to(e,t,o,n,s,i){const r=(0,a.up)("q-icon"),l=(0,a.up)("q-avatar"),c=(0,a.up)("q-item-section"),d=(0,a.up)("q-item-label"),u=(0,a.up)("q-btn"),h=(0,a.up)("q-item"),p=(0,a.up)("q-toggle"),g=(0,a.up)("q-list"),m=(0,a.up)("q-card"),k=(0,a.up)("hot-keys-info-dialog"),f=(0,a.up)("hands-gesture-dialog"),v=(0,a.up)("reader-bookmark-dialog"),b=(0,a.Q2)("ripple");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(m,{class:"card"},{default:(0,a.w5)((()=>[(0,a.Wm)(g,{bordered:""},{default:(0,a.w5)((()=>[(0,a.wy)(((0,a.wg)(),(0,a.j4)(h,{class:"q-my-sm",clickable:"",onClick:t[1]||(t[1]=e=>i.toggleGestureControl(!1))},{default:(0,a.w5)((()=>[(0,a.Wm)(c,{avatar:""},{default:(0,a.w5)((()=>[(0,a.Wm)(l,{color:"black","text-color":"white"},{default:(0,a.w5)((()=>[(0,a.Wm)(r,{name:"front_hand"})])),_:1})])),_:1}),(0,a.Wm)(c,null,{default:(0,a.w5)((()=>[(0,a.Wm)(d,null,{default:(0,a.w5)((()=>[Vt])),_:1})])),_:1}),(0,a.Wm)(c,{side:""},{default:(0,a.w5)((()=>[(0,a.Wm)(u,{onClick:t[0]||(t[0]=e=>i.toggleGestureControl(!0)),icon:"info",color:"grey",round:"",flat:"",dense:""})])),_:1})])),_:1})),[[b,void 0,void 0,{early:!0}]]),(0,a.wy)(((0,a.wg)(),(0,a.j4)(h,{class:"q-my-sm",clickable:"",onClick:t[2]||(t[2]=t=>e.$emit("toggleBook"))},{default:(0,a.w5)((()=>[(0,a.Wm)(c,{avatar:""},{default:(0,a.w5)((()=>[(0,a.Wm)(l,{color:"black","text-color":"white"},{default:(0,a.w5)((()=>[(0,a.Wm)(r,{name:"vrpano"})])),_:1})])),_:1}),(0,a.Wm)(c,null,{default:(0,a.w5)((()=>[(0,a.Wm)(d,null,{default:(0,a.w5)((()=>[Gt])),_:1})])),_:1})])),_:1})),[[b,void 0,void 0,{early:!0}]]),(0,a.wy)(((0,a.wg)(),(0,a.j4)(h,{class:"q-my-sm",tag:"label",clickable:""},{default:(0,a.w5)((()=>[(0,a.Wm)(c,{avatar:""},{default:(0,a.w5)((()=>[(0,a.Wm)(l,{color:"black","text-color":"white"},{default:(0,a.w5)((()=>[(0,a.Wm)(r,{name:"dark_mode"})])),_:1})])),_:1}),(0,a.Wm)(c,null,{default:(0,a.w5)((()=>[(0,a.Wm)(d,null,{default:(0,a.w5)((()=>[Qt])),_:1})])),_:1}),(0,a.Wm)(c,{avatar:""},{default:(0,a.w5)((()=>[(0,a.Wm)(p,{modelValue:s.darkMode,"onUpdate:modelValue":t[3]||(t[3]=e=>s.darkMode=e),color:"black","keep-color":""},null,8,["modelValue"])])),_:1})])),_:1})),[[b,void 0,void 0,{early:!0}]]),(0,a.wy)(((0,a.wg)(),(0,a.j4)(h,{class:"q-my-sm",clickable:"",onClick:t[4]||(t[4]=e=>s.hotkeysDialog=!0)},{default:(0,a.w5)((()=>[(0,a.Wm)(c,{avatar:""},{default:(0,a.w5)((()=>[(0,a.Wm)(l,{color:"black","text-color":"white"},{default:(0,a.w5)((()=>[(0,a.Wm)(r,{name:"info"})])),_:1})])),_:1}),(0,a.Wm)(c,null,{default:(0,a.w5)((()=>[(0,a.Wm)(d,null,{default:(0,a.w5)((()=>[Yt])),_:1})])),_:1})])),_:1})),[[b,void 0,void 0,{early:!0}]]),(0,a.wy)(((0,a.wg)(),(0,a.j4)(h,{class:"q-my-sm",clickable:"",onClick:t[5]||(t[5]=t=>e.$emit("searchDictionary"))},{default:(0,a.w5)((()=>[(0,a.Wm)(c,{avatar:""},{default:(0,a.w5)((()=>[(0,a.Wm)(l,{color:"black","text-color":"white"},{default:(0,a.w5)((()=>[(0,a.Wm)(r,{name:"translate"})])),_:1})])),_:1}),(0,a.Wm)(c,null,{default:(0,a.w5)((()=>[(0,a.Wm)(d,null,{default:(0,a.w5)((()=>[Kt])),_:1})])),_:1})])),_:1})),[[b,void 0,void 0,{early:!0}]]),(0,a.wy)(((0,a.wg)(),(0,a.j4)(h,{class:"q-my-sm",clickable:"",onClick:t[6]||(t[6]=t=>e.$refs.bookmarkDialog.toggleDialog())},{default:(0,a.w5)((()=>[(0,a.Wm)(c,{avatar:""},{default:(0,a.w5)((()=>[(0,a.Wm)(l,{color:"black","text-color":"white"},{default:(0,a.w5)((()=>[(0,a.Wm)(r,{name:"bookmark"})])),_:1})])),_:1}),(0,a.Wm)(c,null,{default:(0,a.w5)((()=>[(0,a.Wm)(d,null,{default:(0,a.w5)((()=>[Xt])),_:1})])),_:1})])),_:1})),[[b,void 0,void 0,{early:!0}]]),o.purchaseAble?(0,a.wy)(((0,a.wg)(),(0,a.j4)(h,{key:0,class:"q-my-sm",clickable:"",onClick:t[7]||(t[7]=t=>e.$emit("purchase"))},{default:(0,a.w5)((()=>[(0,a.Wm)(c,{avatar:""},{default:(0,a.w5)((()=>[(0,a.Wm)(l,{color:"black","text-color":"white"},{default:(0,a.w5)((()=>[(0,a.Wm)(r,{name:"shopping_cart"})])),_:1})])),_:1}),(0,a.Wm)(c,null,{default:(0,a.w5)((()=>[(0,a.Wm)(d,null,{default:(0,a.w5)((()=>[Jt])),_:1})])),_:1})])),_:1})),[[b,void 0,void 0,{early:!0}]]):e.$store.getters["user/isLoggedIn"]?(0,a.kq)("",!0):(0,a.wy)(((0,a.wg)(),(0,a.j4)(h,{key:1,class:"q-my-sm",clickable:"",onClick:t[8]||(t[8]=t=>e.$router.push({name:"home-sign-up"}))},{default:(0,a.w5)((()=>[(0,a.Wm)(c,{avatar:""},{default:(0,a.w5)((()=>[(0,a.Wm)(l,{color:"black","text-color":"white"},{default:(0,a.w5)((()=>[(0,a.Wm)(r,{name:"login"})])),_:1})])),_:1}),(0,a.Wm)(c,null,{default:(0,a.w5)((()=>[(0,a.Wm)(d,null,{default:(0,a.w5)((()=>[eo])),_:1})])),_:1})])),_:1})),[[b,void 0,void 0,{early:!0}]])])),_:1})])),_:1}),(0,a.Wm)(k,{open:s.hotkeysDialog,hotkeys:s.hotkeys,onClose:t[9]||(t[9]=e=>s.hotkeysDialog=!1)},null,8,["open","hotkeys"]),(0,a.Wm)(f,{ref:"handsGestureDialog"},null,512),(0,a.Wm)(v,{ref:"bookmarkDialog"},null,512)],64)}var oo=o(9720);const ao=[[{keys:["Ctrl","F11"],condition:"",result:"Activate Zen Mode",header:"Global"},{keys:["Ctrl","B"],condition:"",result:"Toggle Side Bar"},{keys:["Ctrl","C"],condition:"",result:"Toggle Rest & Chill"},{keys:["Ctrl","/"],condition:"",result:"Search Dictionary"},{keys:["Ctrl","I"],condition:"",result:"Toggle Reader Settings"}],[{keys:["&#8595;"],condition:"",result:"Turn Next Page",header:"Accessiblity (Book)"},{keys:["&#8593;"],condition:"",result:"Turn Previous Page"},{keys:["&#8594;"],condition:"",result:"Turn Next Page"},{keys:["&#8592;"],condition:"",result:"Turn Previous Page"}]],no=e=>((0,a.dD)("data-v-76405e30"),e=e(),(0,a.Cn)(),e),so=no((()=>(0,a._)("div",{class:"image"},[(0,a._)("img",{src:"reader/handsGesture.gif",alt:"Hands Gesture in action"})],-1))),io=no((()=>(0,a._)("div",{class:"texts"},[(0,a._)("p",null,"✋ - Turn Next Page"),(0,a._)("p",null,"✊ - Turn Prev Page"),(0,a._)("p",null," This is an AI-powered tool that make use of the webcam to determine the gesture of your hand. All the processing occurs on your browser and the video is never sent to our server or anywhere. Thus, feel free to use the tool with full privacy 🔒. "),(0,a._)("p",null,"So, would you like to try our hands gesture control tool now?")],-1)));function ro(e,t,o,n,s,i){const r=(0,a.up)("confirm-dialog");return(0,a.wg)(),(0,a.j4)(r,{open:e.isOpen,loading:e.isLoading,onConfirmed:e.handleEmit,header:"Hands Gesture Control",btnLabel:"Activate",btnColor:"positive"},{"main-content":(0,a.w5)((()=>[so,io])),_:1},8,["open","loading","onConfirmed"])}var lo=o(3963);const co=(0,a.aZ)({name:"HandsGestureDialog",components:{ConfirmDialog:lo.Z},setup(){const{toggleHandsFree:e}=Le(),t=(0,H.iH)(!1),o=(0,H.iH)(!1),a=()=>{console.log("in"),t.value=!t.value},n=t=>{t?(e(),o.value=!0,a()):a()};return{isOpen:t,isLoading:o,toggleDialog:a,toggleHandsFree:e,handleEmit:n}}}),uo=(0,x.Z)(co,[["render",ro],["__scopeId","data-v-76405e30"]]),ho=uo,po=e=>((0,a.dD)("data-v-264c3da2"),e=e(),(0,a.Cn)(),e),go={key:0},mo=po((()=>(0,a._)("div",{class:"texts"},[(0,a._)("p",null,"👋 Hi There"),(0,a._)("p",null,[(0,a.Uk)(" You've been reading this book for "),(0,a._)("span",null,"3 minutes"),(0,a.Uk)(" already. ")]),(0,a._)("p",null," So, why not consider bookmarking this book so that you can come back and read this in the future? After all, long novels take time to read and feel it, so there is nothing going wrong about bookmarking this. ")],-1))),ko=(0,a.Uk)(" Choose your browser - "),fo={key:1},vo={key:0,class:"browser-steps"},bo={class:"browser-steps__image"},yo=["alt","src"];function wo(e,t,o,i,r,l){const c=(0,a.up)("q-btn"),d=(0,a.up)("q-checkbox"),u=(0,a.up)("q-separator"),h=(0,a.up)("alert-dialog");return(0,a.wg)(),(0,a.j4)(h,{ref:"alertDialog",onClose:e.handleEmit,header:"Considering Bookmarking..."},{"main-content":(0,a.w5)((()=>[(0,a.Wm)(n.W3,{appear:"","enter-active-class":"animated fadeIn","leave-active-class":"animated fadeOut"},{default:(0,a.w5)((()=>["overall"==e.currentPage?((0,a.wg)(),(0,a.iD)("section",go,[mo,(0,a._)("div",null,[ko,(0,a._)("div",null,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.browserBtns,(e=>((0,a.wg)(),(0,a.iD)("div",{key:e.label},[(0,a.Wm)(c,{icon:e.icon,label:e.label,onClick:e.onClick},null,8,["icon","label","onClick"])])))),128))])]),(0,a._)("div",null,[(0,a.Wm)(d,{"v-model":e.canShowBookmarkDialog,label:"Reminds me to bookmark for each books"},null,8,["v-model"])])])):((0,a.wg)(),(0,a.iD)("section",fo,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.browserSteps,(o=>((0,a.wg)(),(0,a.iD)("div",{key:o.name},[e.currentPage==o.condition?((0,a.wg)(),(0,a.iD)("div",vo,[(0,a._)("h2",null,(0,s.zw)(o.name),1),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(o.steps,(e=>((0,a.wg)(),(0,a.iD)("div",{key:e.index},[(0,a._)("p",null,(0,s.zw)(`${e.index}. `)+(0,s.zw)(e.text),1),(0,a._)("div",bo,[(0,a._)("img",{alt:`Step - ${e.index}`,src:e.img},null,8,yo)]),(0,a.Wm)(u,{inset:"",class:"browser-steps__seperator"})])))),128))])):(0,a.kq)("",!0),(0,a.Wm)(c,{label:"Back",icon:"arrow_back",onClick:t[0]||(t[0]=t=>e.currentPage="overall")})])))),128))]))])),_:1})])),_:1},8,["onClose"])}var _o=o(1760);const xo=(0,a.aZ)({name:"HandsGestureDialog",components:{AlertDialog:_o.Z},setup(){const e=(0,H.iH)(),t=()=>{var t;null===(t=e.value)||void 0===t||t.openDialog()},o=()=>{n.value="overall"},n=(0,H.iH)("overall"),s=()=>{n.value="chrome"},i=(0,W.Z)(),r=!i.localStorage.has("canShowBookmarkDialog")||i.localStorage.getItem("canShowBookmarkDialog"),l=(0,H.iH)(r);(0,a.YP)(l,((e,t)=>{i.localStorage.set("canShowBookmarkDialog",t)}));const c=[{label:"Chrome",icon:"img:browsers/chrome.png",onClick:s},{label:"Firefox",icon:"img:browsers/firefox.png",onClick:n.value="firefox"},{label:"Microsoft Edge",icon:"img:browsers/edge.png",onClick:n.value="edge"},{label:"Opera",icon:"img:browsers/opera.png",onClick:n.value="opera"},{label:"Safari",icon:"img:browsers/safari.png",onClick:n.value="safari"},{label:"Samsung Internet",icon:"img:browsers/samsung_internet.png",onClick:n.value="samsung_internet"}];n.value="overall";const d=[{name:"Chrome",condition:"chrome",steps:[{index:1,img:"browsers/chrome_steps/step_1.png",text:"Click on the star button on the right side of the search bar. (Or) Press ctrl + D"},{index:2,img:"browsers/chrome_steps/step_2.png",text:"Rewrite the name into the title of the book. Choose the folder you would like to save in."},{index:3,img:"browsers/chrome_steps/step_3.png",text:'(Optional) Make a new folder for BookKay links. Click on "New Folder" button and fill in BookKay. Then, press "Save" Button.'},{index:4,img:"browsers/chrome_steps/step_4.png",text:'To open this bookmark back, click on the "Other Bookmarks" button on the right side underneath the search bar. There, hover over "BookKay folder" and open the link of the book back. Note: If you do not see this bar, pls click Ctrl + Shift + B'}]}];return{alertDialog:e,toggleDialog:t,handleEmit:o,currentPage:n,canShowBookmarkDialog:l,browserBtns:c,browserSteps:d}}});var $o=o(5735),Co=o(5869);const To=(0,x.Z)(xo,[["render",wo],["__scopeId","data-v-264c3da2"]]),Do=To;F()(xo,"components",{QBtn:it.Z,QCheckbox:$o.Z,QSeparator:Co.Z});const So={name:"ReaderSettings",components:{HotKeysInfoDialog:oo.Z,HandsGestureDialog:ho,ReaderBookmarkDialog:Do},props:{purchaseAble:{type:Boolean,default:!1}},data(){return{hotkeysDialog:!1,hotkeys:ao,darkMode:this.$q.dark.isActive,isToggleGestureInfoClicked:!1}},watch:{darkMode:function(e){this.$emit("themeChanged"),1==e?this.$q.dark.set(!0):this.$q.dark.set(!1),this.$q.localStorage.set("darkMode",this.$q.dark.isActive)}},methods:{toggleGestureControl(e=!1){e?(this.isToggleGestureInfoClicked=!0,this.$refs.handsGestureDialog.toggleDialog()):0==this.isToggleGestureInfoClicked?(this.$refs.handsGestureDialog.toggleHandsFree(),this.$emit("close")):this.isToggleGestureInfoClicked=!1}}};var qo=o(151),Bo=o(7011),Wo=o(3414),Ho=o(2035),Po=o(5096),Lo=o(4554),Mo=o(2350),Zo=o(8886),No=o(860);const Io=(0,x.Z)(So,[["render",to],["__scopeId","data-v-54924f5a"]]),Ao=Io;F()(So,"components",{QCard:qo.Z,QList:Bo.Z,QItem:Wo.Z,QItemSection:Ho.Z,QAvatar:Po.Z,QIcon:Lo.Z,QItemLabel:Mo.Z,QBtn:it.Z,QToggle:Zo.Z}),F()(So,"directives",{Ripple:No.Z});const jo=e=>((0,a.dD)("data-v-9760af62"),e=e(),(0,a.Cn)(),e),Fo={class:"result-container"},Oo={class:"result"},Uo={key:0,class:"result-examples"},Eo=jo((()=>(0,a._)("h4",null,"Examples",-1))),Ro={key:1,class:"result-synonyms"},zo=jo((()=>(0,a._)("span",null,"Synonyms:",-1)));function Vo(e,t,o,n,i,r){const l=(0,a.up)("app-prompt-dialog"),c=(0,a.up)("q-card-section"),d=(0,a.up)("swiper-slide"),u=(0,a.up)("swiper"),h=(0,a.up)("q-btn"),p=(0,a.up)("q-card-actions"),g=(0,a.up)("q-card"),m=(0,a.up)("q-dialog"),k=(0,a.Q2)("close-popup");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(l,{open:i.searchDialog,label:"Dictionary",caption:"Word To Search",value:"",onConfirmed:r.search},null,8,["open","onConfirmed"]),(0,a.Wm)(m,{modelValue:i.resultDialog,"onUpdate:modelValue":t[0]||(t[0]=e=>i.resultDialog=e)},{default:(0,a.w5)((()=>[(0,a.Wm)(g,{class:(0,s.C_)(["result-card",{active:this.$q.dark.isActive,"result-word--dark":this.$q.dark.isActive}])},{default:(0,a.w5)((()=>[(0,a.Wm)(c,{class:(0,s.C_)(["result-word",{active:this.$q.dark.isActive,"result-word--dark":this.$q.dark.isActive}])},{default:(0,a.w5)((()=>[(0,a._)("h3",null,(0,s.zw)(r.capitalizeFirstLetter(i.searchWord)),1)])),_:1},8,["class"]),(0,a.Wm)(c,null,{default:(0,a.w5)((()=>[(0,a.Wm)(u,{modules:i.modules,"slides-per-view":1,"space-between":0,centeredSlides:!1,navigation:!0,pagination:{clickable:!0},keyboard:{enabled:!0},simulateTouch:!0},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(i.result,((e,t)=>((0,a.wg)(),(0,a.j4)(d,{key:t},{default:(0,a.w5)((()=>[(0,a._)("div",Fo,[(0,a._)("div",Oo,[(0,a._)("div",{class:(0,s.C_)(["result-definition",{active:this.$q.dark.isActive,"result-word--dark":this.$q.dark.isActive}])}," ("+(0,s.zw)(e.pos)+") "+(0,s.zw)(r.capitalizeFirstLetter(e.definition)),3),e.examples.length>0?((0,a.wg)(),(0,a.iD)("div",Uo,[Eo,((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.examples,((e,t)=>((0,a.wg)(),(0,a.iD)("p",{key:t},(0,s.zw)(e),1)))),128))])):(0,a.kq)("",!0),e.synonyms.length>0?((0,a.wg)(),(0,a.iD)("div",Ro,[(0,a._)("h4",null,[zo,(0,a.Uk)(" "+(0,s.zw)(e.synonyms.join(", ")),1)])])):(0,a.kq)("",!0)])])])),_:2},1024)))),128))])),_:1},8,["modules"])])),_:1}),(0,a.Wm)(p,{align:"right"},{default:(0,a.w5)((()=>[(0,a.wy)((0,a.Wm)(h,{outline:"",ripple:{early:!0},label:"Close"},null,512),[[k]])])),_:1})])),_:1},8,["class"])])),_:1},8,["modelValue"])],64)}var Go=o(9420),Qo=o(3083),Yo=o(9319);const Ko={name:"Dictionary",components:{AppPromptDialog:Go.Z,Swiper:Yo.tq,SwiperSlide:Yo.o5},data(){return{searchDialog:!1,resultDialog:!1,searchWord:"",result:[],modules:[Qo.W_,Qo.tl,Qo.N1,Qo.s5],cardClasses:{"result-word--dark":this.$q.dark.isActive}}},watch:{"this.$q.dark.isActive":function(e){this.cardClasses["result-word--dark"]=e}},methods:{openSearchDialog(){this.searchDialog=!this.searchDialog},async search(e){if(this.searchDialog=!1,e){this.searchWord=e;let t=await this.$api.post("users/dictionary",{word:e});this.result=t.data.result,this.resultDialog=!0}},capitalizeFirstLetter(e){return e.charAt(0).toUpperCase()+e.slice(1)}}};var Xo=o(6778),Jo=o(5589),ea=o(9367),ta=o(677);const oa=(0,x.Z)(Ko,[["render",Vo],["__scopeId","data-v-9760af62"]]),aa=oa;function na(e,t,o,n,s,i){const r=(0,a.up)("hands-gesture-dialog"),l=(0,a.up)("reader-bookmark-dialog");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(r,{ref:"handsGestureDialog"},null,512),(0,a.Wm)(l,{ref:"bookmarkDialog"},null,512)],64)}F()(Ko,"components",{QDialog:Xo.Z,QCard:qo.Z,QCardSection:Jo.Z,QCardActions:ea.Z,QBtn:it.Z}),F()(Ko,"directives",{ClosePopup:ta.Z});const sa=(0,a.aZ)({components:{HandsGestureDialog:ho,ReaderBookmarkDialog:Do},setup(){const e=(0,W.Z)(),t=(0,Y.yj)(),o=(0,H.iH)(),n=()=>{var e;null===(e=o.value)||void 0===e||e.toggleDialog()};(0,a.bv)((()=>{setTimeout((()=>{e.localStorage.has("handsGestureDialogShown")||(n(),e.localStorage.set("handsGestureDialogShown",!0))}),2e4)}));const s=(0,H.iH)(),i=()=>{var e;null===(e=s.value)||void 0===e||e.toggleDialog()},r=()=>{if("book_id"in t.query){const o=t.query["book_id"];let a=!1;e.localStorage.has("canShowBookmarkDialog")?a=e.localStorage.getItem("canShowBookmarkDialog"):(e.localStorage.set("canShowBookmarkDialog",!0),a=!0),a&&!e.localStorage.has(`bookmarkDialogShown_${o}`)&&(i(),e.localStorage.set(`bookmarkDialogShown_${o}`,!0))}};return(0,a.bv)((()=>{setTimeout((()=>{r()}),1e4)})),{handsGestureDialog:o}}}),ia=(0,x.Z)(sa,[["render",na]]),ra=ia,la={components:{FlipbookView:Ae,ShortieView:At,Drawer:Rt,SideBarContents:zt.Z,ReaderSettings:Ao,Dictionary:aa,SplashScreen:f.Z,ReaderPopUps:ra},name:"ReadBook",data(){return{headerShow:!0,info:!0,text:"",navigations:[{name:"Front Matters",data:[]},{name:"Chapters",data:[]},{name:"Back Matters",data:[]}],sideBarClasses:{"side-bar--dark":!1},purchaseAble:!1,overflow:"hidden",settingsDialog:!1,bookcss:"",darkMode:this.$q.dark.isActive}},watch:{"$q.dark.isActive":function(e){this.sideBarClasses["side-bar--dark"]=!!e}},computed:{btnColor(){let e="";return e=this.$q.dark.isActive?"white":"black",e},videoURL(){let e="";return e=this.$q.dark.isActive?"https://storage.googleapis.com/bookkay-dev.appspot.com/reader_videos/background--dark.mp4":"https://storage.googleapis.com/bookkay-dev.appspot.com/reader_videos/background.mp4",e}},mounted(){const{navigations:e}=ne();this.navigations=e,this.info=!this.$q.localStorage.getItem("readerInfo");let t=this;document.body.addEventListener("keydown",(function(e){e.ctrlKey&&"F11"==e.key&&t.toggleZen(),e.ctrlKey&&"b"==e.key&&t.toggleDrawer(),e.ctrlKey&&"c"==e.key&&t.toggleBook(),e.ctrlKey&&"/"==e.key&&t.searchDictionary(),e.ctrlKey&&"i"==e.key&&(t.settingsDialog=!t.settingsDialog)}),!1),this.$q.localStorage.has("darkMode")&&this.$q.dark.set(this.$q.localStorage.getItem("darkMode")),this.checkPurchaseAble()},methods:{toggleZen(){this.$q.fullscreen.toggle().then().catch((e=>{alert(e)})),this.headerShow=!1},toggleDrawer(){this.$refs.drawer.active?this.$refs.drawer.close():this.$refs.drawer.open()},centerBtnClicked(){window.history.length>2?this.$router.go(-1):this.$router.push({name:"base"})},searchDictionary(){this.$refs.dictionary.openSearchDialog()},addBookmark(){browser.bookmarks.getTree()},checkPurchaseAble(){if(this.$store.getters["user/isLoggedIn"]){let e,t=this.$store.getters["user/userProperty"]("books_purchased"),o=this.$store.getters["user/userProperty"]("books_authored");if(!("book_id"in this.$route.query))return this.purchaseAble=!1,"";e=this.$route.query.book_id;let a=t.some((t=>t.id===e)),n=o.some((t=>t.id===e));this.purchaseAble=!a&&!n}else this.purchaseAble=!1},async purchase(){try{await this.$api.post(`books/${this.$route.query.book_id}/purchase`);let e=await this.$api.get("users/"+this.$store.getters["user/userProperty"]("id"),{params:{expand:"~all"}});const t=e.data;this.$store.commit("user/setUser",t),this.$q.localStorage.set("user",t),this.$q.notify({color:"positive",position:"top",message:"You have successfully bought the book. Hope you enjoy it.",icon:"error"})}catch(e){this.$q.notify({color:"negative",position:"top",message:"Error when purchasing book",icon:"error"})}this.checkPurchaseAble()},reloadsBook(){this.$refs.book.loadPageFlip()},onClick(){this.bookcss=""},toggleBook(){""==this.bookcss?(this.bookcss="book-leave",this.headerShow=!1,this.settingsDialog=!1,this.$q.fullscreen.request()):this.bookcss=""},addNav(e){switch(e["type"]){case"book":this.navigations.unshift(e);break;case"front_matter":let t=this.navigations.find((e=>"Front Matters"===e.name));t.data.push(e);break;case"chapter":let o=this.navigations.find((e=>"Chapters"===e.name));o.data.push(e);break;case"back_matter":let a=this.navigations.find((e=>"Back Matters"===e.name));a.data.push(e);break;default:}},navClicked(e){let t=this.$refs.book.$refs.flipbook.getOrientation();"landscape"==t?this.$refs.book.$refs.flipbook.flip(e.page):this.$refs.book.$refs.flipbook.turnToPage(e.page)},handleSelected(){null==this.selected?this.selected=this.currentSelected:(this.currentSelected=this.selected,this.headerShow=!1,this.$refs.book.$refs.flipbook.flip(this.currentSelected))},handleSwipe(e){"top"==e?headerShow=!1:"down"==e&&(headerShow=!0)}},beforeRouteUpdate(e,t,o){this.navigations=[],o()},beforeRouteLeave(e,t,o){this.overflow="auto",o()},beforeUnmount(){this.$q.sessionStorage.has("currentManuscript")&&this.$q.sessionStorage.remove("currentManuscript"),this.$q.sessionStorage.has("currentBook")&&this.$q.sessionStorage.remove("currentBook"),this.$q.dark.set(!1)}};var ca=o(614);const da=(0,x.Z)(la,[["render",k],["__scopeId","data-v-2a4ff16c"]]),ua=da;F()(la,"components",{QAjaxBar:ca.Z,QDialog:Xo.Z,QBtn:it.Z,QAvatar:Po.Z})}}]);