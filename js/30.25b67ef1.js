"use strict";(self["webpackChunkbookkay"]=self["webpackChunkbookkay"]||[]).push([[30],{8633:(e,t,a)=>{a.r(t),a.d(t,{default:()=>Ee});a(71);var i=a(3673),s=a(8880),o=a(2323);(0,i.dD)("data-v-4dbb0818");const r=["src"],l={class:"book-background"},n={key:0,class:"header top-bar"},d={class:"top-bar__left"},c={key:0,class:"top-bar__center"},h=(0,i._)("img",{src:"logo/BookKay.png"},null,-1),p=(0,i._)("h6",{class:"q-ma-xs text-capitalize"},"BookKay",-1),u={class:"top-bar__right"};function g(e,t,a,g,m,f){const k=(0,i.up)("q-ajax-bar"),y=(0,i.up)("splash-screen"),v=(0,i.up)("reader-settings"),b=(0,i.up)("q-dialog"),w=(0,i.up)("dictionary"),_=(0,i.up)("q-btn"),$=(0,i.up)("q-avatar"),C=(0,i.up)("book"),x=(0,i.up)("side-bar-contents"),q=(0,i.up)("drawer");return(0,i.wg)(),(0,i.iD)(i.HY,null,[(0,i.Wm)(k,{ref:"bar",position:"top",color:"primary",size:"5px"},null,512),(0,i.Wm)(y),(0,i._)("video",{autoplay:"",muted:"",loop:"",id:"backgroundVideo",src:f.videoURL},null,8,r),(0,i._)("div",l,[(0,i.Wm)(b,{modelValue:m.settingsDialog,"onUpdate:modelValue":t[0]||(t[0]=e=>m.settingsDialog=e)},{default:(0,i.w5)((()=>[(0,i.Wm)(v,{purchaseAble:m.purchaseAble,onToggleBook:f.toggleBook,onSearchDictionary:f.searchDictionary,onThemeChanged:f.reloadsBook,onPurchase:f.purchase},null,8,["purchaseAble","onToggleBook","onSearchDictionary","onThemeChanged","onPurchase"])])),_:1},8,["modelValue"]),(0,i.Wm)(w,{ref:"dictionary"},null,512),(0,i.Wm)(s.uT,{appear:"","enter-active-class":"animated slideInDown","leave-active-class":"animated slideOutUp"},{default:(0,i.w5)((()=>[m.headerShow?((0,i.wg)(),(0,i.iD)("div",n,[(0,i._)("div",d,[(0,i.Wm)(_,{dense:"",flat:"",round:"",icon:"menu",class:"q-mx-sm",color:f.btnColor,ripple:{early:!0},onClick:f.toggleDrawer},null,8,["color","onClick"]),(0,i.Wm)(_,{color:f.btnColor,icon:"self_improvement",label:e.$q.screen.lt.sm?"":"Zen Mode",outline:"",round:e.$q.screen.lt.sm,ripple:{early:!0},onClick:f.toggleZen},null,8,["color","label","round","onClick"])]),e.$q.screen.lt.sm?(0,i.kq)("",!0):((0,i.wg)(),(0,i.iD)("div",c,[(0,i.Wm)(_,{flat:"",color:f.btnColor,onClick:t[1]||(t[1]=t=>e.$router.go(-1)),ripple:{early:!0}},{default:(0,i.w5)((()=>[(0,i.Wm)($,{class:"q-ma-xs gt-sm",size:"lg"},{default:(0,i.w5)((()=>[h])),_:1}),p])),_:1},8,["color"])])),(0,i._)("div",u,[e.$q.screen.gt.sm&&m.purchaseAble?((0,i.wg)(),(0,i.j4)(_,{key:0,label:"Purchase",outline:"",color:f.btnColor,icon:"shopping_cart",class:"q-ma-md",onClick:f.purchase,ripple:{early:!0}},null,8,["color","onClick"])):(0,i.kq)("",!0),(0,i.Wm)(_,{round:e.$q.screen.lt.sm,label:e.$q.screen.lt.sm?"":"Settings",outline:"",color:f.btnColor,icon:"settings",class:"q-ma-md",onClick:t[2]||(t[2]=e=>m.settingsDialog=!0),ripple:{early:!0}},null,8,["round","label","color"]),(0,i.Wm)(_,{round:"",outline:"",color:f.btnColor,icon:"expand_less",onClick:t[3]||(t[3]=e=>m.headerShow=!1),class:"q-ma-md",ripple:{early:!0}},null,8,["color"])])])):(0,i.kq)("",!0)])),_:1}),(0,i._)("div",{class:"transparent-area",onClick:t[4]||(t[4]=e=>m.headerShow=!0)}),(0,i._)("div",{onClick:t[5]||(t[5]=(...e)=>f.onClick&&f.onClick(...e))},[(0,i.Wm)(C,{onNavAdded:f.addNav,onSwiped:f.handleSwipe,ref:"book",class:(0,o.C_)(["book",m.bookcss])},null,8,["onNavAdded","onSwiped","class"])]),(0,i.Wm)(q,{direction:"left",exist:!0,ref:"drawer"},{default:(0,i.w5)((()=>[(0,i._)("div",{class:(0,o.C_)(["relative side-bar",m.sideBarClasses])},[(0,i.Wm)(x,{contents:m.navigations,onClicked:f.navClicked},null,8,["contents","onClicked"]),(0,i.Wm)(_,{color:f.btnColor,outline:"",icon:"arrow_back",label:"Back",onClick:t[6]||(t[6]=t=>(m.headerShow=!1,e.$router.go(-1))),class:"absolute-bottom",style:{"max-width":"110px"}},null,8,["color"])],2)])),_:1},512)])],64)}(0,i.Cn)();var m=a(2730);function f(e,t,a,s,r,l){const n=(0,i.up)("loading-screen"),d=(0,i.up)("page"),c=(0,i.up)("cover"),h=(0,i.up)("flipbook"),p=(0,i.Q2)("touch-swipe");return(0,i.wg)(),(0,i.iD)("div",null,[r.loading?((0,i.wg)(),(0,i.j4)(n,{key:0,text:r.loadingText},null,8,["text"])):(0,i.kq)("",!0),r.loading?((0,i.wg)(),(0,i.j4)(d,{key:1,pageNum:1,header:"title",text:"",class:(0,o.C_)(["transparent",r.widthClass]),fontSize:r.fontSize,style:{opacity:"0"}},null,8,["class","fontSize"])):(0,i.kq)("",!0),r.loading?(0,i.kq)("",!0):(0,i.wy)(((0,i.wg)(),(0,i.j4)(h,{key:2,width:r.width,height:r.height,size:"fixed",maxShadowOpacity:.5,autoSize:!0,showCover:!0,mobileScrollSupport:!0,startZIndex:0,disableFlipByClick:!0,ref:"flipbook",id:"flipbook",onFlipbookInit:l.onFlipbookInit,onPageTurned:l.onPageTurn},{default:(0,i.w5)((()=>[(0,i.Wm)(c,{url:r.frontCover},null,8,["url"]),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(r.pages,(e=>((0,i.wg)(),(0,i.j4)(d,{key:e.pageNum,pageNum:e.pageNum,header:e.header,text:e.text,fontSize:r.fontSize},null,8,["pageNum","header","text","fontSize"])))),128)),(0,i.Wm)(c,{url:r.backCover},null,8,["url"])])),_:1},8,["width","height","maxShadowOpacity","onFlipbookInit","onPageTurned"])),[[p,l.handleSwipe]])])}var k=a(9119),y=a.n(k);a(7280),a(5363);(0,i.dD)("data-v-7d3e3ea2");const v={ref:"parentElement",class:"flipbook"};function b(e,t,a,s,o,r){return(0,i.wg)(),(0,i.iD)("div",v,[(0,i.WI)(e.$slots,"default",{},void 0,!0)],512)}(0,i.Cn)();var w=a(2389);const _={name:"Flipbook",props:{width:{type:Number,required:!0},height:{type:Number,required:!0},size:{validator:function(e){return-1!==["fixed","stretch"].indexOf(e)}},minWidth:{type:Number,required:!1},maxWidth:{type:Number,required:!1},minHeight:{type:Number,required:!1},maxHeight:{type:Number,required:!1},drawShadow:{type:Boolean,default:!0},flippingTime:{type:Number,default:1e3},usePortrait:{type:Boolean,default:!0},startZIndex:{type:Number,default:0},startPage:{type:Number,default:0},autoSize:{type:Boolean,default:!0},maxShadowOpacity:{type:Number,default:1,validator:function(e){return e>=0&&e<=1}},showCover:{type:Boolean,default:!1},mobileScrollSupport:{type:Boolean,default:!0},swipeDistance:{type:Number,default:30},clickEventForward:{type:Boolean,default:!0},useMouseEvents:{type:Boolean,default:!0},disableFlipByClick:{type:Boolean,default:!1}},mounted(){this.createFlipbook()},data(){return{pageFlip:""}},methods:{createFlipbook(){const e=this.$refs.parentElement,t={width:this.$props.width,height:this.$props.height,size:this.$props.size,minWidth:this.$props.minWidth,maxWidth:this.$props.maxWidth,minHeight:this.$props.minHeight,maxHeight:this.$props.maxHeight,drawShadow:this.$props.drawShadow,flippingTime:this.$props.flippingTime,usePortrait:this.$props.usePortrait,startZIndex:this.$props.startZIndex,startPage:this.$props.startPage,autoSize:this.$props.autoSize,maxShadowOpacity:this.$props.maxShadowOpacity,showCover:this.$props.showCover,mobileScrollSupport:this.$props.mobileScrollSupport,swipeDistance:this.$props.swipeDistance,clickEventForward:this.$props.clickEventForward,useMouseEvents:this.$props.useMouseEvents,disableFlipByClick:this.$props.disableFlipByClick},a=new w.PageFlip(e,t);a.getFlipController()?a.updateFromHtml(document.querySelectorAll(".page")):a.loadFromHTML(document.querySelectorAll(".page")),a.on("init",(e=>{this.$emit("flipbookInit",e.data)})),a.on("flip",(e=>{this.$emit("pageTurned",e.data)})),this.pageFlip=a},updateFromHtml(){this.pageFlip.updateFromHtml(document.querySelectorAll(".page"))},getPageCount(){this.pageFlip.getPageCount()},flip(e,t=""){(t="")&&(t=this.getCorner()),this.pageFlip.flip(e,t)},flipNext(e=""){e||(e=this.getCorner()),this.pageFlip.flipNext(e)},flipPrev(e=""){e||(e=this.getCorner()),this.pageFlip.flipPrev(e)},destroy(){this.pageFlip.destroy()},getCorner(){var e=["top","bottom"],t=e[Math.floor(Math.random()*e.length)];return t}}};_.render=b,_.__scopeId="data-v-7d3e3ea2";const $=_;(0,i.dD)("data-v-a29e2be2");const C={class:"page-content"},x={class:"page-header"},q=["innerHTML"],S={class:"page-footer"};function W(e,t,a,s,r,l){return(0,i.wg)(),(0,i.iD)("div",{class:(0,o.C_)(["page",s.pageClasses])},[(0,i._)("div",C,[(0,i._)("h2",x,(0,o.zw)(e.$props.header),1),(0,i._)("div",{class:"page-text",innerHTML:e.$props.text,style:(0,o.j5)(e.$props.fontSize)},null,12,q),(0,i._)("div",S,(0,o.zw)(e.$props.pageNum),1)])],2)}(0,i.Cn)();var D=a(8825),T=a(1959);const P={name:"Page",props:{pageNum:{type:Number,required:!0},header:{type:String,required:!0},text:{type:String,required:!0},fontSize:{type:String,required:!0}},setup(){const e=(0,D.Z)(),t=(0,T.qj)({"page--dark":e.dark.isActive});return(0,i.YP)((()=>e.dark.isActive),(e=>{t["page--dark"]=!!e})),{pageClasses:t}}};P.render=W,P.__scopeId="data-v-a29e2be2";const B=P;(0,i.dD)("data-v-22b8ad3d");const N=["src","alt"];function A(e,t,a,s,r,l){return(0,i.wg)(),(0,i.iD)("div",{class:(0,o.C_)(["page",s.pageClasses])},[(0,i._)("img",{class:"cover-img",src:e.$props.url,alt:e.$props.url},null,8,N)],2)}(0,i.Cn)();const M={name:"Cover",props:{url:{type:String,required:!0}},setup(){const e=(0,D.Z)(),t=(0,T.qj)({"page--dark":e.dark.isActive});return(0,i.YP)((()=>e.dark.isActive),(e=>{t["page--dark"]=!!e})),{pageClasses:t}}};var L=a(4027),Z=a(7518),I=a.n(Z);M.render=A,M.__scopeId="data-v-22b8ad3d";const F=M;I()(M,"components",{QImg:L.Z}),(0,i.dD)("data-v-ebbfdc82");const E={class:"loader-wrapper"};function H(e,t,a,r,l,n){return(0,i.wg)(),(0,i.iD)("div",E,[(0,i.Wm)(s.uT,{appear:"","enter-active-class":"animated fadeIn","leave-active-class":"animated fadeOut"},{default:(0,i.w5)((()=>[((0,i.wg)(),(0,i.iD)("div",{class:"loading-text-container",key:a.text},[(0,i._)("div",{class:(0,o.C_)(["loading-text",r.loadingTextClasses])},[(0,i._)("h3",null,(0,o.zw)(a.text),1),(0,i._)("div",null,[(0,i._)("div",{class:(0,o.C_)(["clock-loader",e.clockLoaderClasses])},null,2)])],2)]))])),_:1})])}(0,i.Cn)();const z={name:"LoadingScreen",props:{text:{type:String,required:!0}},setup(){const e=(0,D.Z)(),t=(0,T.qj)({"loading-text--dark":e.dark.isActive}),a=(0,T.qj)({"clock-loader--dark":e.dark.isActive});return(0,i.YP)((()=>e.dark.isActive),(e=>{e?(t["loading-text--dark"]=!0,a["clock-loader--dark"]=!0):(t["loading-text--dark"]=!1,a["clock-loader--dark"]=!1)})),{loadingTextClasses:t}}};z.render=H,z.__scopeId="data-v-ebbfdc82";const Q=z,j=["evt"],O={name:"Book",components:{Flipbook:$,Page:B,Cover:F,LoadingScreen:Q},created(){document.addEventListener("keydown",(e=>{this.handleKeyPress(e.key)}),{once:!0}),document.addEventListener("wheel",(e=>{this.handleScroll(e.deltaY)}),{once:!0})},async mounted(){const e=this;if(this.loadingText="Book Loading...Please Wait","manuscript_id"==Object.keys(this.$route.query)[0]){let e;try{e=await this.$api.get("manuscripts/"+this.$route.query.manuscript_id+"/json")}catch(c){this.loadingText="Server Error :(",console.log(c)}const a=e.data;this.book=a,this.loadingText="Configuring Covers",this.configureCovers();try{this.book=t(this.book)}catch(c){this.loadingText="Rendering Error :(",console.log(c)}this.loading=!1,this.turnToQueryPage()}if("book_id"==Object.keys(this.$route.query)[0]){let e,a=this.$route.query.book_id;try{e=await this.$api.get("books/"+a+"/json")}catch(c){this.loadingText="Server Error :(",console.log(c)}const i=e.data;this.$q.cookies.has(`last_read_${a}`)||(e=this.$store.getters["user/isLoggedIn"]?await this.$api.post(`books/${a}/read`):await this.$api.get(`books/${this.$route.query.book_id}/read`),this.$q.cookies.set(`last_read_${a}`,null,{expires:"1h",path:"/"})),this.book=i,this.loadingText="Configuring Covers",this.configureCovers();try{this.book=await t(this.book),this.turnToQueryPage()}catch(c){this.loadingText="Rendering Error :(",console.log(c)}this.loading=!1}async function t(t){var s=1;if(e.$emit("navAdded",{type:"book",data:t["title"],page:s-1,active:!1}),e.$q.screen.lt.sm||(i(s,t["title"],""),s++),"front_matters"in t)for(var o=t["front_matters"],r=0;r<o.length;r++){let t=o[r];e.loadingText=`Rendering ${t["title"]}`,t["page"]=s,e.$emit("navAdded",{type:"front_matter",data:t["title"],page:s}),s=a(t["text"],s,t["title"]);var l=document.getElementsByClassName("page-text")[0].innerHTML;""!=l&&(i(s,t["title"],l),document.getElementsByClassName("page-text")[0].innerHTML="",s++)}if("chapters"in t&&t.chapters.length>0){var n=t["chapters"];for(r=0;r<n.length;r++){let t=n[r];e.loadingText=`Rendering ${t["title"]}`,t["page"]=s,e.$emit("navAdded",{type:"chapter",data:t["title"],page:s}),s=a(t["text"],s,t["title"]);l=document.getElementsByClassName("page-text")[0].innerHTML;""!=l&&(i(s,t["title"],l),document.getElementsByClassName("page-text")[0].innerHTML="",s++)}}else if(""!=t.text&&null!=t.text){e.loadingText="Rendering the main text",e.$emit("navAdded",{type:"text",data:t["title"],page:s}),s=a(t["text"],s,t["title"]);l=document.getElementsByClassName("page-text")[0].innerHTML;""!=l&&(i(s,t["title"],l),document.getElementsByClassName("page-text")[0].innerHTML="",s++)}if("back_matters"in t){var d=t["back_matters"];for(r=0;r<d.length;r++){let t=d[r];e.loadingText=`Rendering ${t["title"]}`,e.$emit("navAdded",{type:"back_matter",data:t["title"],page:s}),s=a(t["text"],s,d[r]["title"]);l=document.getElementsByClassName("page-text")[0].innerHTML;""!=l&&(i(s,t["title"],l),document.getElementsByClassName("page-text")[0].innerHTML="",s++)}}return e.$q.screen.lt.sm||(i(s,t["title"],""),s++,s%2==0&&i(s,t["title"],"")),e.loadingText="Rendering Done!",t}function a(t,s,r,c=[]){if("attributes"in t&&"id"in t["attributes"]&&"RootDivContainer"==t["attributes"]["id"]);else{var h="attributes"in t?n(t["type"],t["attributes"]):n(t["type"]),p=l(t["type"]),u=o(h+p,c);""!=u&&(i(s,r,u),u=o(h+p,c),s++),c.push({openingTag:h,closingTag:p})}if(t["contents"])for(var g=0;g<t["contents"].length;g++){var m=t["contents"][g];if("string"==typeof m){m=d(m);for(var f=m.split(" "),k=0;k<f.length;k++){var y=f[k]+" ";u=o(y,c);if(""!=u){i(s,r,u);for(var v=[],b=0;b<c.length;b++){var w=c[b],_=e.pages[e.pages.length-1].text.split(" ");u=w["openingTag"].startsWith("<p")&&"<p></p>"!=_[_.length-2]?o("<p style='text-indent: 0'>"+w["closingTag"],v):o(w["openingTag"]+w["closingTag"],v),v.push(w)}u=o(y,c),s++}}}else if(e.singleTags.includes(m.type)){y="<"+m.type+"/>",u=o(y,c);""!=u&&(i(s,r,u),u=o(y,c),s++)}else s=a(m,s,r,c),c.pop()}return s}function i(t,a,i){var s={header:a,pageNum:t,text:i};e.pages.push(s)}function s(e){var t=e.style.overflow;t&&"visible"!==t||(e.style.overflow="hidden");var a=e.clientWidth<e.scrollWidth||e.clientHeight<e.scrollHeight;return e.style.overflow=t,a}function o(e,t=[]){var a=document.getElementsByClassName("page-text")[0],i=a.innerHTML,o=i;if(t.length>0){let s=t[t.length-1]["closingTag"],o=1;for(let e=0;e<t.length-1;e++){let a=t[e];a["closingTag"]==s&&o++}let n=r(i,s,o);var l=i.slice(n);i=i.slice(0,n),i=i+e+" "+l,a.innerHTML=i}else a.innerHTML+=e+" ";return s(a)?(a.innerHTML="",o):""}function r(e,t,a){return null===e?-1:!a||isNaN(a)||a<=1?e.lastIndexOf(t):(a--,e.lastIndexOf(t,r(e,t,a)-1))}function l(e){return"</"+e+">"}function n(e,t={}){var a="<"+e;for(const i in t)a=a+" "+i+"='"+t[i]+"'";return a+=">",a}function d(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}},data(){return{widthClass:this.$q.screen.lt.sm?"full-page":"half-page",width:this.$q.screen.lt.sm?window.innerWidth:window.innerWidth/2,height:screen.height,loading:!0,loadingText:"",lastScrollTop:0,bookConfigs:{},fontSize:"font-size: 18px",singleTags:["br","hr"],frontCover:"",backCover:"",book:{title:"",front_matters:[],chapters:[],text:"",back_matters:[]},book2:{title:"Sherlock Holmes",front_matters:[],chapters:[],back_matters:[]},text:"",pages:[]}},methods:{loadPageFlip(){setTimeout((()=>this.$refs.flipbook.updateFromHtml()),1e3)},configureCovers(){let e=this.book.front_cover,t=this.book.back_cover,a=this.book.temp_cover;this.frontCover=""!=e?e:a,this.backCover=""!=t?t:a},compareIndex(e,t){return e.index<t.index?-1:e.index>t.index?1:0},processClosingTag(e){return e=e.split("<br>").join("<br/>"),e=e.split("<hr>").join("<hr/>"),e=e.split("<img>").join("<img/>"),e},turnToQueryPage(){let e=this.$route.query;if(e.hasOwnProperty("front_matter_id")&&front_matters in this.book){let t=this.book.front_matters,a=t.find((t=>t.front_matter_id===e.front_matter_id));this.$refs.flipbook.flip(a.pageNum)}else if(e.hasOwnProperty("chapter_id")&&chapters in this.book){let t=this.book.chapters,a=t.find((t=>t.chapter_id===e.chapter_id));this.$refs.flipbook.flip(a.pageNum)}else if(e.hasOwnProperty("back_matter_id")&&back_matters in this.book){let t=this.book.back_matters,a=t.find((t=>t.back_matter_id===e.back_matter_id));this.$refs.flipbook.flip(a.pageNum)}},onFlipbookInit(){if(Object.keys(this.$route.query)>0)this.turnToQueryPage();else if(this.$q.localStorage.has("pageNum")){let e=this.$q.localStorage.getItem("pageNum");this.$refs.flipbook.flip(e)}},onPageTurn(e){this.$q.localStorage.set("pageNum",e)},handleKeyPress(e){if(this.$refs.flipbook&&!this.loading){switch(e){case"ArrowLeft":this.$refs.flipbook.flipPrev();break;case"ArrowRight":this.$refs.flipbook.flipNext();break;case"ArrowDown":this.$refs.flipbook.flipNext();break;case"ArrowUp":this.$refs.flipbook.flipPrev();break;case"VolumeUp":this.$refs.flipbook.flipNext();break;case"VolumeDown":this.$refs.flipbook.flipPrev();break;default:}document.addEventListener("keydown",(e=>{this.handleKeyPress(e.key)}),{once:!0})}},handleScroll(e){this.$refs.flipbook&&(e<0?this.$refs.flipbook.flipPrev():e>0&&this.$refs.flipbook.flipNext(),document.addEventListener("wheel",(e=>{this.handleScroll(e.deltaY)}),{once:!0}))},handleSwipe(e){let{evt:t}=e,a=y()(e,j);const i=a.direction;"right"==i?this.$refs.flipbook.flipPrev():"left"==i?this.$refs.flipbook.flipNext():"top"==i?this.$emit("swiped","top"):"down"==i&&this.$emit("swiped","down")}}};var R=a(8020);O.render=f,O.__scopeId="data-v-fee88142";const U=O;I()(O,"directives",{TouchSwipe:R.Z}),(0,i.dD)("data-v-b4ed4c86");const V={key:0},K={class:"overlay",ref:"overlay"};function Y(e,t,a,s,r,l){return l.enabled?((0,i.wg)(),(0,i.iD)("section",V,[(0,i._)("aside",{class:"sidebar",style:(0,o.j5)(l.style),ref:"element"},[(0,i.WI)(e.$slots,"default",{},void 0,!0)],4),(0,i._)("div",K,null,512)])):(0,i.kq)("",!0)}(0,i.Cn)();const X={name:"Drawer",props:["direction","exist"],data(){return{auto_speed:"0.3s",manual_speed:"0.03s",threshold:20,startTime:null,startPos:null,translate:null,active:!1,visible:!0}},computed:{element:function(){return this.$refs.element},overlay:function(){return this.$refs.overlay},enabled:function(){return 1==this.exist},style:function(){return"right"==this.direction?"transform:translate3d(100%,0,0);right:0;":"transform:translate3d(-100%,0,0);left:0;"}},mounted(){document.addEventListener("touchstart",(e=>{this.handleStart(e)})),document.addEventListener("touchmove",(e=>{this.handleMove(e)})),document.addEventListener("touchend",(e=>{this.handleEnd(e)})),document.addEventListener("touchcancel",(e=>{this.handleEnd(e)})),window.addEventListener("resize",(e=>{this.setVisibality(e)}),!0),this.overlay.addEventListener("transitionend",(e=>{this.handleZindex(e)}),!1),this.overlay.addEventListener("click",(e=>{this.close()}),!1),this.setVisibality()},methods:{setVisibality(){0==this.element.offsetWidth?this.visible=!1:this.visible=!0},handleStart(e){this.startTime=(new Date).getTime(),this.startPos=e.targetTouches[0].pageX,this.element.style.transitionDuration=this.manual_speed},handleMove(e){let t=this.gesture(e),a=this.validate(this.direction,t);if(a){let a=this.percentage(this.direction,t);"left"==this.direction?(this.translate=e.touches[0].pageX-this.element.offsetWidth,this.translate<0?this.element.style.transform="translate3d("+this.translate+"px,0,0)":this.open()):(this.translate=-(screen.width-this.element.offsetWidth-e.touches[0].pageX),this.translate>0?this.element.style.transform="translate3d("+this.translate+"px,0,0)":this.open()),this.overlayOpacity(a/100)}},handleEnd(e){let t=this.speed(e),a=this.gesture(e),i=this.validate(this.direction,a);i&&(t>.6?this.active?this.close():this.open():this.element.offsetWidth/2>Math.abs(this.translate)?this.open():this.close())},handleZindex(){let e=window.getComputedStyle(this.overlay).getPropertyValue("opacity");e<=0&&(this.overlay.style.zIndex=-999)},validate(e,t){if("left"==e){if(this.active&&"swiperight"==t||!this.active&&("swipeleft"==t||this.startPos>this.threshold))return!1}else if(this.active&&"swipeleft"==t||!this.active&&("swiperight"==t||this.startPos<screen.width-this.threshold))return!1;return!(document.querySelector(".sidebar.active")&&!this.active||!this.visible)},overlayOpacity(e){this.overlay.style.opacity=e,e>0&&(this.overlay.style.zIndex=999)},gesture(e){let t=["swipeleft","swiperight"],a=e.changedTouches[0].pageX;return this.startPos-a<0?t[1]:t[0]},open(){this.translate=0,this.element.style.transform="translate3d("+this.translate+",0,0)",this.element.style.transitionDuration=this.auto_speed,this.overlayOpacity(1),this.lock(document.querySelector("html")),this.lock(document.querySelector("body")),this.element.classList.add("active"),this.active=!0},close(){"left"==this.direction?this.translate="-"+this.element.offsetWidth+"px":this.translate=this.element.offsetWidth+"px",this.element.style.transform="translate3d("+this.translate+",0,0)",this.element.style.transitionDuration=this.auto_speed,this.overlayOpacity(0),this.unlock(document.querySelector("html")),this.unlock(document.querySelector("body")),this.element.classList.remove("active"),this.active=!1},speed(e){let t=(new Date).getTime()-this.startTime,a=Math.abs(this.startPos),i=Math.abs(e.changedTouches[0].pageX),s=a>i?a-i:i-a;return s/t},percentage(e,t){let a=0,i=[];return i="left"==e?["swipeleft","swiperight"]:["swiperight","swipeleft"],this.active&&t==i[0]&&(a=100-Math.round(Math.abs(this.translate)/this.element.offsetWidth*100)),this.active||t!=i[1]||(a=Math.round(100-Math.abs(this.translate)/this.element.offsetWidth*100)),a>100&&(a=100),a<0&&(a=0),a},lock(e){e.style.overflow="hidden",e.style.touchAction="none"},unlock(e){e.style.removeProperty("overflow"),e.style.removeProperty("touch-action")}},unmounted(){this.unlock(document.querySelector("html")),this.unlock(document.querySelector("body"))}};X.render=Y,X.__scopeId="data-v-b4ed4c86";const G=X;var J=a(5126);(0,i.dD)("data-v-6073aec0");const ee=(0,i.Uk)(" Rest & Chill"),te=(0,i.Uk)(" Dark Mode"),ae=(0,i.Uk)(" HotKeys"),ie=(0,i.Uk)(" Dictionary"),se=(0,i.Uk)(" Purchase");function oe(e,t,a,s,o,r){const l=(0,i.up)("q-icon"),n=(0,i.up)("q-avatar"),d=(0,i.up)("q-item-section"),c=(0,i.up)("q-item-label"),h=(0,i.up)("q-item"),p=(0,i.up)("q-toggle"),u=(0,i.up)("q-list"),g=(0,i.up)("q-card"),m=(0,i.up)("hot-keys-info-dialog"),f=(0,i.Q2)("ripple");return(0,i.wg)(),(0,i.iD)(i.HY,null,[(0,i.Wm)(g,{class:"card"},{default:(0,i.w5)((()=>[(0,i.Wm)(u,{bordered:""},{default:(0,i.w5)((()=>[(0,i.wy)((0,i.Wm)(h,{class:"q-my-sm",clickable:"",onClick:t[0]||(t[0]=t=>e.$emit("toggleBook"))},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{avatar:""},{default:(0,i.w5)((()=>[(0,i.Wm)(n,{color:"black","text-color":"white"},{default:(0,i.w5)((()=>[(0,i.Wm)(l,{name:"vrpano"})])),_:1})])),_:1}),(0,i.Wm)(d,null,{default:(0,i.w5)((()=>[(0,i.Wm)(c,null,{default:(0,i.w5)((()=>[ee])),_:1})])),_:1})])),_:1},512),[[f,void 0,void 0,{early:!0}]]),(0,i.wy)((0,i.Wm)(h,{class:"q-my-sm",tag:"label",clickable:""},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{avatar:""},{default:(0,i.w5)((()=>[(0,i.Wm)(n,{color:"black","text-color":"white"},{default:(0,i.w5)((()=>[(0,i.Wm)(l,{name:"dark_mode"})])),_:1})])),_:1}),(0,i.Wm)(d,null,{default:(0,i.w5)((()=>[(0,i.Wm)(c,null,{default:(0,i.w5)((()=>[te])),_:1})])),_:1}),(0,i.Wm)(d,{avatar:""},{default:(0,i.w5)((()=>[(0,i.Wm)(p,{modelValue:o.darkMode,"onUpdate:modelValue":t[1]||(t[1]=e=>o.darkMode=e),color:"black","keep-color":""},null,8,["modelValue"])])),_:1})])),_:1},512),[[f,void 0,void 0,{early:!0}]]),(0,i.wy)((0,i.Wm)(h,{class:"q-my-sm",clickable:"",onClick:t[2]||(t[2]=e=>o.hotkeysDialog=!0)},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{avatar:""},{default:(0,i.w5)((()=>[(0,i.Wm)(n,{color:"black","text-color":"white"},{default:(0,i.w5)((()=>[(0,i.Wm)(l,{name:"info"})])),_:1})])),_:1}),(0,i.Wm)(d,null,{default:(0,i.w5)((()=>[(0,i.Wm)(c,null,{default:(0,i.w5)((()=>[ae])),_:1})])),_:1})])),_:1},512),[[f,void 0,void 0,{early:!0}]]),(0,i.wy)((0,i.Wm)(h,{class:"q-my-sm",clickable:"",onClick:t[3]||(t[3]=t=>e.$emit("searchDictionary"))},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{avatar:""},{default:(0,i.w5)((()=>[(0,i.Wm)(n,{color:"black","text-color":"white"},{default:(0,i.w5)((()=>[(0,i.Wm)(l,{name:"translate"})])),_:1})])),_:1}),(0,i.Wm)(d,null,{default:(0,i.w5)((()=>[(0,i.Wm)(c,null,{default:(0,i.w5)((()=>[ie])),_:1})])),_:1})])),_:1},512),[[f,void 0,void 0,{early:!0}]]),a.purchaseAble?(0,i.wy)(((0,i.wg)(),(0,i.j4)(h,{key:0,class:"q-my-sm",clickable:"",onClick:t[4]||(t[4]=t=>e.$emit("purchase"))},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{avatar:""},{default:(0,i.w5)((()=>[(0,i.Wm)(n,{color:"black","text-color":"white"},{default:(0,i.w5)((()=>[(0,i.Wm)(l,{name:"shopping_cart"})])),_:1})])),_:1}),(0,i.Wm)(d,null,{default:(0,i.w5)((()=>[(0,i.Wm)(c,null,{default:(0,i.w5)((()=>[se])),_:1})])),_:1})])),_:1},512)),[[f,void 0,void 0,{early:!0}]]):(0,i.kq)("",!0)])),_:1})])),_:1}),(0,i.Wm)(m,{open:o.hotkeysDialog,hotkeys:o.hotkeys,onClose:t[5]||(t[5]=e=>o.hotkeysDialog=!1)},null,8,["open","hotkeys"])],64)}(0,i.Cn)();var re=a(6866);const le=[[{keys:["Ctrl","F11"],condition:"",result:"Activate Zen Mode",header:"Global"},{keys:["Ctrl","B"],condition:"",result:"Toggle Side Bar"},{keys:["Ctrl","C"],condition:"",result:"Toggle Rest & Chill"},{keys:["Ctrl","/"],condition:"",result:"Search Dictionary"},{keys:["Ctrl","I"],condition:"",result:"Toggle Reader Settings"}],[{keys:["&#8595;"],condition:"",result:"Turn Next Page",header:"Accessiblity (Book)"},{keys:["&#8593;"],condition:"",result:"Turn Previous Page"},{keys:["&#8594;"],condition:"",result:"Turn Next Page"},{keys:["&#8592;"],condition:"",result:"Turn Previous Page"}]],ne={name:"ReaderSettings",components:{HotKeysInfoDialog:re.Z},props:{purchaseAble:{type:Boolean,default:!1}},data(){return{hotkeysDialog:!1,hotkeys:le,darkMode:this.$q.dark.isActive}},watch:{darkMode:function(e){this.$emit("themeChanged"),1==e?this.$q.dark.set(!0):this.$q.dark.set(!1),this.$q.localStorage.set("darkMode",this.$q.dark.isActive)}},methods:{}};var de=a(151),ce=a(7011),he=a(3414),pe=a(2035),ue=a(5096),ge=a(4554),me=a(2350),fe=a(8886),ke=a(6489);ne.render=oe,ne.__scopeId="data-v-6073aec0";const ye=ne;I()(ne,"components",{QCard:de.Z,QList:ce.Z,QItem:he.Z,QItemSection:pe.Z,QAvatar:ue.Z,QIcon:ge.Z,QItemLabel:me.Z,QToggle:fe.Z}),I()(ne,"directives",{Ripple:ke.Z}),(0,i.dD)("data-v-d793e30c");const ve={class:"result-container"},be={class:"result"},we={class:"result-definition"},_e={key:0,class:"result-examples"},$e=(0,i._)("h4",null,"Examples",-1),Ce={key:1,class:"result-synonyms"},xe=(0,i._)("span",null,"Synonyms:",-1);function qe(e,t,a,s,r,l){const n=(0,i.up)("prompt-dialog"),d=(0,i.up)("q-card-section"),c=(0,i.up)("swiper-slide"),h=(0,i.up)("swiper"),p=(0,i.up)("q-btn"),u=(0,i.up)("q-card-actions"),g=(0,i.up)("q-card"),m=(0,i.up)("q-dialog"),f=(0,i.Q2)("close-popup");return(0,i.wg)(),(0,i.iD)(i.HY,null,[(0,i.Wm)(n,{open:r.searchDialog,label:"Dictionary",caption:"Word To Search",value:"",onConfirmed:l.search},null,8,["open","onConfirmed"]),(0,i.Wm)(m,{modelValue:r.resultDialog,"onUpdate:modelValue":t[0]||(t[0]=e=>r.resultDialog=e)},{default:(0,i.w5)((()=>[(0,i.Wm)(g,{class:"result-card"},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{class:"result-word"},{default:(0,i.w5)((()=>[(0,i._)("h3",null,(0,o.zw)(l.capitalizeFirstLetter(r.searchWord)),1)])),_:1}),(0,i.Wm)(d,null,{default:(0,i.w5)((()=>[(0,i.Wm)(h,{modules:r.modules,"slides-per-view":1,"space-between":0,centeredSlides:!1,navigation:!0,pagination:{clickable:!0},keyboard:{enabled:!0},simulateTouch:!0},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(r.result,((e,t)=>((0,i.wg)(),(0,i.j4)(c,{key:t},{default:(0,i.w5)((()=>[(0,i._)("div",ve,[(0,i._)("div",be,[(0,i._)("div",we," ("+(0,o.zw)(e.pos)+") "+(0,o.zw)(l.capitalizeFirstLetter(e.definition)),1),e.examples.length>0?((0,i.wg)(),(0,i.iD)("div",_e,[$e,((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.examples,((e,t)=>((0,i.wg)(),(0,i.iD)("p",{key:t},(0,o.zw)(e),1)))),128))])):(0,i.kq)("",!0),e.synonyms.length>0?((0,i.wg)(),(0,i.iD)("div",Ce,[(0,i._)("h4",null,[xe,(0,i.Uk)(" "+(0,o.zw)(e.synonyms.join(", ")),1)])])):(0,i.kq)("",!0)])])])),_:2},1024)))),128))])),_:1},8,["modules"])])),_:1}),(0,i.Wm)(u,{align:"right"},{default:(0,i.w5)((()=>[(0,i.wy)((0,i.Wm)(p,{outline:"",ripple:{early:!0},label:"Close"},null,512),[[f]])])),_:1})])),_:1})])),_:1},8,["modelValue"])],64)}(0,i.Cn)();var Se=a(1832),We=a(3083),De=a(9319);const Te={name:"Dictionary",components:{PromptDialog:Se.Z,Swiper:De.t,SwiperSlide:De.o},data(){return{searchDialog:!1,resultDialog:!1,searchWord:"",result:[],modules:[We.W_,We.tl,We.N1,We.s5]}},methods:{openSearchDialog(){this.searchDialog=!this.searchDialog},async search(e){if(this.searchDialog=!1,e){this.searchWord=e;let t=await this.$api.post("users/dictionary",{word:e});this.result=t.data.result,this.resultDialog=!0}},capitalizeFirstLetter(e){return e.charAt(0).toUpperCase()+e.slice(1)}}};var Pe=a(6778),Be=a(5589),Ne=a(9367),Ae=a(8240),Me=a(677);Te.render=qe,Te.__scopeId="data-v-d793e30c";const Le=Te;I()(Te,"components",{QDialog:Pe.Z,QCard:de.Z,QCardSection:Be.Z,QCardActions:Ne.Z,QBtn:Ae.Z}),I()(Te,"directives",{ClosePopup:Me.Z});const Ze={components:{Book:U,Drawer:G,SideBarContents:J.Z,ReaderSettings:ye,Dictionary:Le,SplashScreen:m.Z},name:"ReadBook",data(){return{headerShow:!0,info:!0,text:"",navigations:[{name:"Front Matters",data:[]},{name:"Chapters",data:[]},{name:"Back Matters",data:[]}],sideBarClasses:{"side-bar--dark":!1},purchaseAble:!1,overflow:"hidden",settingsDialog:!1,bookcss:"",darkMode:this.$q.dark.isActive}},watch:{"$q.dark.isActive":function(e){this.sideBarClasses["side-bar--dark"]=!!e}},computed:{btnColor(){let e="";return e=this.$q.dark.isActive?"white":"black",e},videoURL(){let e="";return e=this.$q.dark.isActive?"https://storage.googleapis.com/bookkay-dev.appspot.com/reader_videos/background--dark.mp4":"https://storage.googleapis.com/bookkay-dev.appspot.com/reader_videos/background.mp4",e}},mounted(){this.info=!this.$q.localStorage.getItem("readerInfo");let e=this;document.body.addEventListener("keydown",(function(t){t.ctrlKey&&"F11"==t.key&&e.toggleZen(),t.ctrlKey&&"b"==t.key&&e.toggleDrawer(),t.ctrlKey&&"c"==t.key&&e.toggleBook(),t.ctrlKey&&"/"==t.key&&e.searchDictionary(),t.ctrlKey&&"i"==t.key&&(e.settingsDialog=!e.settingsDialog)}),!1),this.$q.localStorage.has("darkMode")&&this.$q.dark.set(this.$q.localStorage.getItem("darkMode")),this.checkPurchaseAble()},methods:{toggleZen(){this.$q.fullscreen.toggle().then((()=>{})).catch((e=>{alert(e)})),this.headerShow=!1},toggleDrawer(){this.$refs.drawer.active?this.$refs.drawer.close():this.$refs.drawer.open()},searchDictionary(){this.$refs.dictionary.openSearchDialog()},checkPurchaseAble(){if(this.$store.getters["user/isLoggedIn"]){let e,t=this.$store.getters["user/userProperty"]("books_purchased"),a=this.$store.getters["user/userProperty"]("books_authored");if(!("book_id"in this.$route.query))return this.purchaseAble=!1,"";e=this.$route.query.book_id;let i=t.some((t=>t.id===e)),s=a.some((t=>t.id===e));this.purchaseAble=!i&&!s}else this.purchaseAble=!1},async purchase(){try{await this.$api.post(`books/${this.$route.query.book_id}/purchase`);let e=await this.$api.get("users/"+this.$store.getters["user/userProperty"]("id"),{params:{expand:"~all"}});const t=e.data;this.$store.commit("user/setUser",t),this.$q.localStorage.set("user",t),this.$q.notify({color:"positive",position:"top",message:"You have successfully bought the book. Hope you enjoy it.",icon:"error"})}catch(e){this.$q.notify({color:"negative",position:"top",message:"Error when purchasing book",icon:"error"})}this.checkPurchaseAble()},reloadsBook(){this.$refs.book.loadPageFlip()},onClick(){this.bookcss=""},toggleBook(){""==this.bookcss?(this.bookcss="book-leave",this.headerShow=!1,this.settingsDialog=!1,this.$q.fullscreen.request()):this.bookcss=""},addNav(e){switch(e["type"]){case"book":this.navigations.unshift(e);break;case"front_matter":let t=this.navigations.find((e=>"Front Matters"===e.name));t.data.push(e);break;case"chapter":let a=this.navigations.find((e=>"Chapters"===e.name));a.data.push(e);break;case"back_matter":let i=this.navigations.find((e=>"Back Matters"===e.name));i.data.push(e);break;default:}},navClicked(e){this.$refs.book.$refs.flipbook.flip(e.page)},handleSelected(){null==this.selected?this.selected=this.currentSelected:(this.currentSelected=this.selected,this.headerShow=!1,this.$refs.book.$refs.flipbook.flip(this.currentSelected))},handleSwipe(e){"top"==e?headerShow=!1:"down"==e&&(headerShow=!0)}},beforeRouteUpdate(e,t,a){this.navigations=[],a()},beforeRouteLeave(e,t,a){this.overflow="auto",a()},beforeUnmount(){this.$q.sessionStorage.has("currentManuscript")&&this.$q.sessionStorage.remove("currentManuscript"),this.$q.sessionStorage.has("currentBook")&&this.$q.sessionStorage.remove("currentBook"),this.$q.dark.set(!1)}};var Ie=a(614),Fe=a(2025);Ze.render=g,Ze.__scopeId="data-v-4dbb0818";const Ee=Ze;I()(Ze,"components",{QAjaxBar:Ie.Z,QDialog:Pe.Z,QCard:de.Z,QCardSection:Be.Z,QSpace:Fe.Z,QBtn:Ae.Z,QAvatar:ue.Z}),I()(Ze,"directives",{ClosePopup:Me.Z})}}]);