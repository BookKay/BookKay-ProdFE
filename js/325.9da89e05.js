"use strict";(self["webpackChunkbookkay"]=self["webpackChunkbookkay"]||[]).push([[325],{4832:(e,t,o)=>{o.r(t),o.d(t,{default:()=>Je});o(71);var a=o(3673),s=o(8880),i=o(2323);const r=e=>((0,a.dD)("data-v-5fb582f6"),e=e(),(0,a.Cn)(),e),l=["src"],n={class:"book-background"},d={key:0,class:"header top-bar"},c={class:"top-bar__left"},h={key:0,class:"top-bar__center"},p=r((()=>(0,a._)("img",{src:"logo/BookKay.png"},null,-1))),u=r((()=>(0,a._)("h6",{class:"q-ma-xs text-capitalize"},"BookKay",-1))),g={class:"top-bar__right"},m={class:"side-bar-contents"};function f(e,t,o,r,f,k){const y=(0,a.up)("q-ajax-bar"),b=(0,a.up)("splash-screen"),v=(0,a.up)("reader-settings"),w=(0,a.up)("q-dialog"),_=(0,a.up)("dictionary"),$=(0,a.up)("q-btn"),C=(0,a.up)("q-avatar"),x=(0,a.up)("book"),q=(0,a.up)("side-bar-contents"),S=(0,a.up)("drawer");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(y,{ref:"bar",position:"top",color:"primary",size:"5px"},null,512),(0,a.Wm)(b),(0,a._)("video",{autoplay:"",muted:"",playsinline:"",loop:"",id:"backgroundVideo",src:k.videoURL},null,8,l),(0,a._)("div",n,[(0,a.Wm)(w,{modelValue:f.settingsDialog,"onUpdate:modelValue":t[0]||(t[0]=e=>f.settingsDialog=e)},{default:(0,a.w5)((()=>[(0,a.Wm)(v,{purchaseAble:f.purchaseAble,onToggleBook:k.toggleBook,onSearchDictionary:k.searchDictionary,onThemeChanged:k.reloadsBook,onPurchase:k.purchase},null,8,["purchaseAble","onToggleBook","onSearchDictionary","onThemeChanged","onPurchase"])])),_:1},8,["modelValue"]),(0,a.Wm)(_,{ref:"dictionary"},null,512),(0,a.Wm)(s.uT,{appear:"","enter-active-class":"animated slideInDown","leave-active-class":"animated slideOutUp"},{default:(0,a.w5)((()=>[f.headerShow?((0,a.wg)(),(0,a.iD)("div",d,[(0,a._)("div",c,[(0,a.Wm)($,{dense:"",flat:"",round:"",icon:"menu",class:"q-mx-sm",color:k.btnColor,ripple:{early:!0},onClick:k.toggleDrawer},null,8,["color","onClick"]),(0,a.Wm)($,{color:k.btnColor,icon:"self_improvement",label:e.$q.screen.lt.sm?"":"Zen Mode",outline:"",round:e.$q.screen.lt.sm,ripple:{early:!0},onClick:k.toggleZen},null,8,["color","label","round","onClick"])]),e.$q.screen.lt.sm?(0,a.kq)("",!0):((0,a.wg)(),(0,a.iD)("div",h,[(0,a.Wm)($,{flat:"",color:k.btnColor,onClick:t[1]||(t[1]=t=>e.$router.go(-1)),ripple:{early:!0}},{default:(0,a.w5)((()=>[(0,a.Wm)(C,{class:"q-ma-xs gt-sm",size:"lg"},{default:(0,a.w5)((()=>[p])),_:1}),u])),_:1},8,["color"])])),(0,a._)("div",g,[e.$q.screen.gt.sm&&f.purchaseAble?((0,a.wg)(),(0,a.j4)($,{key:0,label:"Purchase",outline:"",color:k.btnColor,icon:"shopping_cart",class:"q-ma-md",onClick:k.purchase,ripple:{early:!0}},null,8,["color","onClick"])):e.$q.screen.gt.sm&&!e.$store.getters["user/isLoggedIn"]?((0,a.wg)(),(0,a.j4)($,{key:1,label:"Register",outline:"",color:k.btnColor,icon:"login",class:"q-ma-md",onClick:t[2]||(t[2]=t=>e.$router.push({name:"home-sign-up"})),ripple:{early:!0}},null,8,["color"])):(0,a.kq)("",!0),(0,a.Wm)($,{round:e.$q.screen.lt.sm,label:e.$q.screen.lt.sm?"":"Settings",outline:"",color:k.btnColor,icon:"settings",class:"q-ma-md",onClick:t[3]||(t[3]=e=>f.settingsDialog=!0),ripple:{early:!0}},null,8,["round","label","color"]),(0,a.Wm)($,{round:"",outline:"",color:k.btnColor,icon:"expand_less",onClick:t[4]||(t[4]=e=>f.headerShow=!1),class:"q-ma-md",ripple:{early:!0}},null,8,["color"])])])):(0,a.kq)("",!0)])),_:1}),(0,a._)("div",{class:"transparent-area",onClick:t[5]||(t[5]=e=>f.headerShow=!0)}),(0,a._)("div",{onClick:t[6]||(t[6]=(...e)=>k.onClick&&k.onClick(...e))},[(0,a.Wm)(x,{onNavAdded:k.addNav,onSwiped:k.handleSwipe,ref:"book",class:(0,i.C_)(["book",f.bookcss])},null,8,["onNavAdded","onSwiped","class"])]),(0,a.Wm)(S,{direction:"left",exist:!0,ref:"drawer"},{default:(0,a.w5)((()=>[(0,a._)("div",{class:(0,i.C_)(["relative side-bar",f.sideBarClasses])},[(0,a._)("div",m,[(0,a.Wm)(q,{contents:f.navigations,onClicked:k.navClicked},null,8,["contents","onClicked"])]),(0,a.Wm)($,{color:k.btnColor,outline:"",icon:"arrow_back",label:"Back",onClick:t[7]||(t[7]=t=>(f.headerShow=!1,e.$router.go(-1))),class:"absolute-bottom",style:{"max-width":"110px"}},null,8,["color"])],2)])),_:1},512)])],64)}var k=o(2730);function y(e,t,o,s,r,l){const n=(0,a.up)("loading-screen"),d=(0,a.up)("page"),c=(0,a.up)("cover"),h=(0,a.up)("flipbook"),p=(0,a.Q2)("touch-swipe");return(0,a.wg)(),(0,a.iD)("div",null,[r.loading?((0,a.wg)(),(0,a.j4)(n,{key:0,text:r.loadingText},null,8,["text"])):(0,a.kq)("",!0),r.loading?((0,a.wg)(),(0,a.j4)(d,{key:1,pageNum:1,header:"title",text:"",class:(0,i.C_)(["transparent",r.widthClass]),fontSize:r.fontSize,style:{opacity:"0"}},null,8,["class","fontSize"])):(0,a.kq)("",!0),r.loading?(0,a.kq)("",!0):(0,a.wy)(((0,a.wg)(),(0,a.j4)(h,{key:2,width:r.width,height:r.height,size:"fixed",usePortrait:!0,maxShadowOpacity:.5,autoSize:!0,showCover:!0,mobileScrollSupport:!0,startZIndex:0,disableFlipByClick:!0,ref:"flipbook",id:"flipbook",onFlipbookInit:l.onFlipbookInit,onPageTurned:l.onPageTurn},{default:(0,a.w5)((()=>[(0,a.Wm)(c,{url:r.frontCover},null,8,["url"]),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(r.pages,(e=>((0,a.wg)(),(0,a.j4)(d,{key:e.pageNum,pageNum:e.pageNum,header:e.header,text:e.text,fontSize:r.fontSize},null,8,["pageNum","header","text","fontSize"])))),128)),(0,a.Wm)(c,{url:r.backCover},null,8,["url"])])),_:1},8,["width","height","maxShadowOpacity","onFlipbookInit","onPageTurned"])),[[p,l.handleSwipe]])])}var b=o(9119),v=o.n(b);o(7280),o(5363);const w={ref:"parentElement",class:"flipbook"};function _(e,t,o,s,i,r){return(0,a.wg)(),(0,a.iD)("div",w,[(0,a.WI)(e.$slots,"default",{},void 0,!0)],512)}var $=o(2389);const C={name:"Flipbook",props:{width:{type:Number,required:!0},height:{type:Number,required:!0},size:{validator:function(e){return-1!==["fixed","stretch"].indexOf(e)}},minWidth:{type:Number,required:!1},maxWidth:{type:Number,required:!1},minHeight:{type:Number,required:!1},maxHeight:{type:Number,required:!1},drawShadow:{type:Boolean,default:!0},flippingTime:{type:Number,default:1e3},usePortrait:{type:Boolean,default:!0},startZIndex:{type:Number,default:0},startPage:{type:Number,default:0},autoSize:{type:Boolean,default:!0},maxShadowOpacity:{type:Number,default:1,validator:function(e){return e>=0&&e<=1}},showCover:{type:Boolean,default:!1},mobileScrollSupport:{type:Boolean,default:!0},swipeDistance:{type:Number,default:30},clickEventForward:{type:Boolean,default:!0},useMouseEvents:{type:Boolean,default:!0},disableFlipByClick:{type:Boolean,default:!1}},mounted(){this.createFlipbook()},data(){return{pageFlip:""}},methods:{createFlipbook(){const e=this.$refs.parentElement,t={width:this.$props.width,height:this.$props.height,size:this.$props.size,minWidth:this.$props.minWidth,maxWidth:this.$props.maxWidth,minHeight:this.$props.minHeight,maxHeight:this.$props.maxHeight,drawShadow:this.$props.drawShadow,flippingTime:this.$props.flippingTime,usePortrait:this.$props.usePortrait,startZIndex:this.$props.startZIndex,startPage:this.$props.startPage,autoSize:this.$props.autoSize,maxShadowOpacity:this.$props.maxShadowOpacity,showCover:this.$props.showCover,mobileScrollSupport:this.$props.mobileScrollSupport,swipeDistance:this.$props.swipeDistance,clickEventForward:this.$props.clickEventForward,useMouseEvents:this.$props.useMouseEvents,disableFlipByClick:this.$props.disableFlipByClick},o=new $.PageFlip(e,t);o.getFlipController()?o.updateFromHtml(document.querySelectorAll(".page")):o.loadFromHTML(document.querySelectorAll(".page")),o.on("init",(e=>{this.$emit("flipbookInit",e.data)})),o.on("flip",(e=>{this.$emit("pageTurned",e.data)})),this.pageFlip=o},updateFromHtml(){this.pageFlip.updateFromHtml(document.querySelectorAll(".page"))},getOrientation(){return this.pageFlip.getOrientation()},getPageCount(){this.pageFlip.getPageCount()},flip(e,t=""){(t="")&&(t=this.getCorner()),this.pageFlip.flip(e,t)},flipNext(e=""){e||(e=this.getCorner()),this.pageFlip.flipNext(e)},flipPrev(e=""){e||(e=this.getCorner()),this.pageFlip.flipPrev(e)},turnToPage(e){this.pageFlip.turnToPage(e)},turnToPrevPage(){this.pageFlip.turnToPrevPage()},destroy(){this.pageFlip.destroy()},getCorner(){var e=["top","bottom"],t=e[Math.floor(Math.random()*e.length)];return t}}};var x=o(4260);const q=(0,x.Z)(C,[["render",_],["__scopeId","data-v-06af73bd"]]),S=q,W={class:"page-content"},T={class:"page-header"},P=["innerHTML"],D={class:"page-footer"};function A(e,t,o,s,r,l){return(0,a.wg)(),(0,a.iD)("div",{class:(0,i.C_)(["page",s.pageClasses])},[(0,a._)("div",W,[(0,a._)("h2",T,(0,i.zw)(e.$props.header),1),(0,a._)("div",{class:"page-text",innerHTML:e.$props.text,style:(0,i.j5)(e.$props.fontSize)},null,12,P),(0,a._)("div",D,(0,i.zw)(e.$props.pageNum),1)])],2)}var B=o(8825),N=o(1959);const L={name:"Page",props:{pageNum:{type:Number,required:!0},header:{type:String,required:!0},text:{type:String,required:!0},fontSize:{type:String,required:!0}},setup(){const e=(0,B.Z)(),t=(0,N.qj)({"page--dark":e.dark.isActive});return(0,a.YP)((()=>e.dark.isActive),(e=>{t["page--dark"]=!!e})),{pageClasses:t}}},Z=(0,x.Z)(L,[["render",A],["__scopeId","data-v-803e5e0a"]]),M=Z,F=["src","alt"];function I(e,t,o,s,r,l){return(0,a.wg)(),(0,a.iD)("div",{class:(0,i.C_)(["page",s.pageClasses])},[(0,a._)("img",{class:"cover-img",src:e.$props.url,alt:e.$props.url},null,8,F)],2)}const E={name:"Cover",props:{url:{type:String,required:!0}},setup(){const e=(0,B.Z)(),t=(0,N.qj)({"page--dark":e.dark.isActive});return(0,a.YP)((()=>e.dark.isActive),(e=>{t["page--dark"]=!!e})),{pageClasses:t}}};var H=o(4027),z=o(7518),j=o.n(z);const O=(0,x.Z)(E,[["render",I],["__scopeId","data-v-22b8ad3d"]]),Q=O;j()(E,"components",{QImg:H.Z});const U={class:"loader-wrapper"};function R(e,t,o,r,l,n){return(0,a.wg)(),(0,a.iD)("div",U,[(0,a.Wm)(s.uT,{appear:"","enter-active-class":"animated fadeIn","leave-active-class":"animated fadeOut"},{default:(0,a.w5)((()=>[((0,a.wg)(),(0,a.iD)("div",{class:"loading-text-container",key:o.text},[(0,a._)("div",{class:(0,i.C_)(["loading-text",r.loadingTextClasses])},[(0,a._)("h3",null,(0,i.zw)(o.text),1),(0,a._)("div",null,[(0,a._)("div",{class:(0,i.C_)(["clock-loader",r.clockLoaderClasses])},null,2)])],2)]))])),_:1})])}const V={name:"LoadingScreen",props:{text:{type:String,required:!0}},setup(){const e=(0,B.Z)(),t=(0,N.qj)({"loading-text--dark":e.dark.isActive}),o=(0,N.qj)({"clock-loader--dark":e.dark.isActive});return(0,a.YP)((()=>e.dark.isActive),(e=>{e?(t["loading-text--dark"]=!0,o["clock-loader--dark"]=!0):(t["loading-text--dark"]=!1,o["clock-loader--dark"]=!1)})),{loadingTextClasses:t,clockLoaderClasses:o}}},K=(0,x.Z)(V,[["render",R],["__scopeId","data-v-47e39d86"]]),Y=K,X=["evt"],G={name:"Book",components:{Flipbook:S,Page:M,Cover:Q,LoadingScreen:Y},created(){document.addEventListener("keydown",(e=>{this.handleKeyPress(e.key)}),{once:!0}),document.addEventListener("wheel",(e=>{this.handleScroll(e.deltaY)}),{once:!0})},async mounted(){const e=this;if(this.loadingText="Book Loading...Please Wait.","manuscript_id"==Object.keys(this.$route.query)[0]){let e;try{e=await this.$api.get("manuscripts/"+this.$route.query.manuscript_id+"/json")}catch(c){this.loadingText="Server Error :(",console.log(c)}const o=e.data;this.book=o,this.loadingText="Configuring Covers",this.configureCovers();try{this.book=t(this.book)}catch(c){this.loadingText="Rendering Error :(",console.log(c)}this.loading=!1}if("book_id"==Object.keys(this.$route.query)[0]){let e,o=this.$route.query.book_id;this.$q.cookies.has(`last_read_${o}`)||(e=this.$store.getters["user/isLoggedIn"]?await this.$api.post(`books/${o}/read`):await this.$api.get(`books/${this.$route.query.book_id}/read`),this.$q.cookies.set(`last_read_${o}`,"",{expires:"1h",path:"/"}));let a=screen.height,s=window.innerWidth;if(e=await this.$api.get(`books/${o}/copy`,{params:{height:a,width:s}}),0==Object.keys(e.data).length){try{e=await this.$api.get("books/"+o+"/json")}catch(c){this.loadingText="Server Error :(",console.log(c)}const i=e.data;this.book=i,this.configureCovers();try{this.loadingText="First Time Loading...may take couple of minutes",this.book=await t(this.book),this.$api.post(`books/${o}/copy`,{height:a,width:s,json:this.book_copy})}catch(c){this.loadingText="Rendering Error :(",console.log(c)}}else this.book=e.data,this.configureCovers(),this.loadBookCopy();this.loading=!1}async function t(t){var s=1;if(e.$emit("navAdded",{type:"book",data:t["title"],page:s-1,active:!1}),e.book_copy.title=t.title,e.book_copy.front_cover=t.front_cover,e.book_copy.back_cover=t.back_cover,e.$q.screen.lt.sm||(a(s,t["title"],""),s++),"front_matters"in t)for(var i=t["front_matters"],r=0;r<i.length;r++){let t=i[r];e.book_copy["front_matters"].append({title:t["title"],pages:[]}),t["page"]=s,e.$emit("navAdded",{type:"front_matter",data:t["title"],page:s}),s=o(t["text"],s,t["title"],e.book_copy.front_matters[r]);var l=document.getElementsByClassName("page-text")[0].innerHTML;""!=l&&(e.book_copy.front_matters[r]["pages"].push(l),a(s,t["title"],l),document.getElementsByClassName("page-text")[0].innerHTML="",s++)}if("chapters"in t&&t.chapters.length>0){var n=t["chapters"];for(r=0;r<n.length;r++){let t=n[r];e.book_copy["chapters"].push({title:t["title"],pages:[]}),t["page"]=s,e.$emit("navAdded",{type:"chapter",data:t["title"],page:s}),s=o(t["text"],s,t["title"],e.book_copy.chapters[r]);l=document.getElementsByClassName("page-text")[0].innerHTML;""!=l&&(e.book_copy.chapters[r]["pages"].push(l),a(s,t["title"],l),document.getElementsByClassName("page-text")[0].innerHTML="",s++)}}else if(""!=t.text&&null!=t.text){e.$emit("navAdded",{type:"text",data:t["title"],page:s}),e.book_copy["main_text"]={title:t["title"],pages:[]},s=o(t["text"],s,t["title"],e.book_copy["main_text"]);l=document.getElementsByClassName("page-text")[0].innerHTML;""!=l&&(e.book_copy.main_text["pages"].push(l),a(s,t["title"],l),document.getElementsByClassName("page-text")[0].innerHTML="",s++)}if("back_matters"in t){var d=t["back_matters"];for(r=0;r<d.length;r++){let t=d[r];e.book_copy["back_matters"].push({title:t["title"],pages:[]}),e.$emit("navAdded",{type:"back_matter",data:t["title"],page:s}),s=o(t["text"],s,d[r]["title"],e.book_copy.back_matters[r]);l=document.getElementsByClassName("page-text")[0].innerHTML;""!=l&&(e.book_copy.back_matters[r]["pages"].push(l),a(s,t["title"],l),document.getElementsByClassName("page-text")[0].innerHTML="",s++)}}return e.$q.screen.lt.sm||(a(s,t["title"],""),s++,s%2==0&&a(s,t["title"],"")),t}function o(t,s,r,c,h=[]){if("attributes"in t&&"id"in t["attributes"]&&"RootDivContainer"==t["attributes"]["id"]);else{var p="attributes"in t?n(t["type"],t["attributes"]):n(t["type"]),u=l(t["type"]),g=i(p+u,h);""!=g&&(c["pages"].push(g),a(s,r,g),g=i(p+u,h),s++),h.push({openingTag:p,closingTag:u})}if(t["contents"])for(var m=0;m<t["contents"].length;m++){var f=t["contents"][m];if("string"==typeof f){f=d(f);for(var k=f.split(" "),y=0;y<k.length;y++){var b=k[y]+" ";g=i(b,h);if(""!=g){c["pages"].push(g),a(s,r,g);for(var v=[],w=0;w<h.length;w++){var _=h[w],$=e.pages[e.pages.length-1].text.split(" ");g=_["openingTag"].startsWith("<p")&&"<p></p>"!=$[$.length-2]?i("<p style='text-indent: 0'>"+_["closingTag"],v):i(_["openingTag"]+_["closingTag"],v),v.push(_)}g=i(b,h),s++}}}else if(e.singleTags.includes(f.type)){b="<"+f.type+"/>",g=i(b,h);""!=g&&(a(s,r,g),g=i(b,h),s++)}else s=o(f,s,r,c,h),h.pop()}return s}function a(t,o,a){var s={header:o,pageNum:t,text:a};e.pages.push(s)}function s(e){var t=e.style.overflow;t&&"visible"!==t||(e.style.overflow="hidden");var o=e.clientWidth<e.scrollWidth||e.clientHeight<e.scrollHeight;return e.style.overflow=t,o}function i(e,t=[]){var o=document.getElementsByClassName("page-text")[0],a=o.innerHTML,i=a;if(t.length>0){let s=t[t.length-1]["closingTag"],i=1;for(let e=0;e<t.length-1;e++){let o=t[e];o["closingTag"]==s&&i++}let n=r(a,s,i);var l=a.slice(n);a=a.slice(0,n),a=a+e+" "+l,o.innerHTML=a}else o.innerHTML+=e+" ";return s(o)?(o.innerHTML="",i):""}function r(e,t,o){return null===e?-1:!o||isNaN(o)||o<=1?e.lastIndexOf(t):(o--,e.lastIndexOf(t,r(e,t,o)-1))}function l(e){return"</"+e+">"}function n(e,t={}){var o="<"+e;for(const a in t)o=o+" "+a+"='"+t[a]+"'";return o+=">",o}function d(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}},data(){return{widthClass:this.$q.screen.lt.sm?"full-page":"half-page",width:this.$q.screen.lt.sm?window.innerWidth:window.innerWidth/2,height:screen.height,loading:!0,loadingText:"",lastScrollTop:0,bookConfigs:{},fontSize:"font-size: 18px",singleTags:["br","hr"],frontCover:"",backCover:"",book:{title:"",front_matters:[],chapters:[],text:"",back_matters:[]},text:"",book_copy:{front_matters:[],chapters:[],main_text:{},back_matters:[]},pages:[]}},methods:{loadPageFlip(){setTimeout((()=>this.$refs.flipbook.updateFromHtml()),1e3)},configureCovers(){let e=this.book.front_cover,t=this.book.back_cover,o=this.book.temp_cover;this.frontCover=""!=e?e:o,this.backCover=""!=t?t:o},compareIndex(e,t){return e.index<t.index?-1:e.index>t.index?1:0},processClosingTag(e){return e=e.split("<br>").join("<br/>"),e=e.split("<hr>").join("<hr/>"),e=e.split("<img>").join("<img/>"),e},createPage(e,t,o){var a={header:t,pageNum:e,text:o};this.pages.push(a)},loadBookCopy(){let e=1;this.$emit("navAdded",{type:"book",data:this.book["title"],page:e-1,active:!1}),this.$q.screen.lt.sm||(this.createPage(e,this.book["title"],""),e++);for(const t of this.book["front_matters"]){this.$emit("navAdded",{type:"front_matter",data:t["title"],page:e});for(const o of t["pages"])this.createPage(e,t["title"],o),e++}for(const t of this.book["chapters"]){this.$emit("navAdded",{type:"chapter",data:t["title"],page:e});for(const o of t["pages"])this.createPage(e,t["title"],o),e++}if(Object.keys(this.book["main_text"]).length>0){let t=this.book["main_text"];for(const o of t["pages"])this.createPage(e,t["title"],o),e++}for(const t of this.book["back_matters"]){this.$emit("navAdded",{type:"back_matter",data:t["title"],page:e});for(const o of t["pages"])this.createPage(e,t["title"],o),e++}this.$q.screen.lt.sm||(this.createPage(e,this.book["title"],""),e++,e%2==0&&this.createPage(e,this.book["title"],""))},turnToQueryPage(){let e=this.$route.query;if(e.hasOwnProperty("front_matter_id")&&front_matters in this.book){let t=this.book.front_matters,o=t.find((t=>t.front_matter_id===e.front_matter_id));this.$refs.flipbook.flip(o.pageNum)}else if(e.hasOwnProperty("chapter_id")&&chapters in this.book){let t=this.book.chapters,o=t.find((t=>t.chapter_id===e.chapter_id));this.$refs.flipbook.flip(o.pageNum)}else if(e.hasOwnProperty("back_matter_id")&&back_matters in this.book){let t=this.book.back_matters,o=t.find((t=>t.back_matter_id===e.back_matter_id));this.$refs.flipbook.flip(o.pageNum)}},onFlipbookInit(){let e=this.$route.query.book_id;if(Object.keys(this.$route.query)>0&&this.turnToQueryPage(),this.$q.localStorage.has(`pageNumOf_${e}`)){let t=this.$q.localStorage.getItem(`pageNumOf_${e}`);this.$refs.flipbook.flip(t)}},onPageTurn(e){if("book_id"in this.$route.query){let t=this.$route.query.book_id;this.$q.localStorage.set(`pageNumOf_${t}`,e)}},handleKeyPress(e){if(this.$refs.flipbook&&!this.loading){switch(e){case"ArrowLeft":this.$refs.flipbook.flipPrev();break;case"ArrowRight":this.$refs.flipbook.flipNext();break;case"ArrowDown":this.$refs.flipbook.flipNext();break;case"ArrowUp":this.$refs.flipbook.flipPrev();break;case"AudioVolumeUp":this.$refs.flipbook.flipNext();break;case"AudioVolumeDown":this.$refs.flipbook.flipPrev();break;default:}document.addEventListener("keydown",(e=>{this.handleKeyPress(e.key)}),{once:!0})}},handleScroll(e){this.$refs.flipbook&&(e<0?this.$refs.flipbook.flipPrev():e>0&&this.$refs.flipbook.flipNext(),document.addEventListener("wheel",(e=>{this.handleScroll(e.deltaY)}),{once:!0}))},handleSwipe(e){let{evt:t}=e,o=v()(e,X);const a=o.direction;"right"==a?this.$refs.flipbook.turnToPrevPage():"left"==a?this.$refs.flipbook.flipNext():"top"==a?this.$emit("swiped","top"):"down"==a&&this.$emit("swiped","down")}}};var J=o(8020);const ee=(0,x.Z)(G,[["render",y],["__scopeId","data-v-7858d1ec"]]),te=ee;j()(G,"directives",{TouchSwipe:J.Z});const oe={key:0},ae={class:"overlay",ref:"overlay"};function se(e,t,o,s,r,l){return l.enabled?((0,a.wg)(),(0,a.iD)("section",oe,[(0,a._)("aside",{class:"sidebar",style:(0,i.j5)(l.style),ref:"element"},[(0,a.WI)(e.$slots,"default",{},void 0,!0)],4),(0,a._)("div",ae,null,512)])):(0,a.kq)("",!0)}const ie={name:"Drawer",props:["direction","exist"],data(){return{auto_speed:"0.3s",manual_speed:"0.03s",threshold:20,startTime:null,startPos:null,translate:null,active:!1,visible:!0}},computed:{element:function(){return this.$refs.element},overlay:function(){return this.$refs.overlay},enabled:function(){return 1==this.exist},style:function(){return"right"==this.direction?"transform:translate3d(100%,0,0);right:0;":"transform:translate3d(-100%,0,0);left:0;"}},mounted(){document.addEventListener("touchstart",(e=>{this.handleStart(e)})),document.addEventListener("touchmove",(e=>{this.handleMove(e)})),document.addEventListener("touchend",(e=>{this.handleEnd(e)})),document.addEventListener("touchcancel",(e=>{this.handleEnd(e)})),window.addEventListener("resize",(e=>{this.setVisibality(e)}),!0),this.overlay.addEventListener("transitionend",(e=>{this.handleZindex(e)}),!1),this.overlay.addEventListener("click",(e=>{this.close()}),!1),this.setVisibality()},methods:{setVisibality(){0==this.element.offsetWidth?this.visible=!1:this.visible=!0},handleStart(e){this.startTime=(new Date).getTime(),this.startPos=e.targetTouches[0].pageX,this.element.style.transitionDuration=this.manual_speed},handleMove(e){let t=this.gesture(e),o=this.validate(this.direction,t);if(o){let o=this.percentage(this.direction,t);"left"==this.direction?(this.translate=e.touches[0].pageX-this.element.offsetWidth,this.translate<0?this.element.style.transform="translate3d("+this.translate+"px,0,0)":this.open()):(this.translate=-(screen.width-this.element.offsetWidth-e.touches[0].pageX),this.translate>0?this.element.style.transform="translate3d("+this.translate+"px,0,0)":this.open()),this.overlayOpacity(o/100)}},handleEnd(e){let t=this.speed(e),o=this.gesture(e),a=this.validate(this.direction,o);a&&(t>.6?this.active?this.close():this.open():this.element.offsetWidth/2>Math.abs(this.translate)?this.open():this.close())},handleZindex(){let e=window.getComputedStyle(this.overlay).getPropertyValue("opacity");e<=0&&(this.overlay.style.zIndex=-999)},validate(e,t){if("left"==e){if(this.active&&"swiperight"==t||!this.active&&("swipeleft"==t||this.startPos>this.threshold))return!1}else if(this.active&&"swipeleft"==t||!this.active&&("swiperight"==t||this.startPos<screen.width-this.threshold))return!1;return!(document.querySelector(".sidebar.active")&&!this.active||!this.visible)},overlayOpacity(e){this.overlay.style.opacity=e,e>0&&(this.overlay.style.zIndex=999)},gesture(e){let t=["swipeleft","swiperight"],o=e.changedTouches[0].pageX;return this.startPos-o<0?t[1]:t[0]},open(){this.translate=0,this.element.style.transform="translate3d("+this.translate+",0,0)",this.element.style.transitionDuration=this.auto_speed,this.overlayOpacity(1),this.lock(document.querySelector("html")),this.lock(document.querySelector("body")),this.element.classList.add("active"),this.active=!0},close(){"left"==this.direction?this.translate="-"+this.element.offsetWidth+"px":this.translate=this.element.offsetWidth+"px",this.element.style.transform="translate3d("+this.translate+",0,0)",this.element.style.transitionDuration=this.auto_speed,this.overlayOpacity(0),this.unlock(document.querySelector("html")),this.unlock(document.querySelector("body")),this.element.classList.remove("active"),this.active=!1},speed(e){let t=(new Date).getTime()-this.startTime,o=Math.abs(this.startPos),a=Math.abs(e.changedTouches[0].pageX),s=o>a?o-a:a-o;return s/t},percentage(e,t){let o=0,a=[];return a="left"==e?["swipeleft","swiperight"]:["swiperight","swipeleft"],this.active&&t==a[0]&&(o=100-Math.round(Math.abs(this.translate)/this.element.offsetWidth*100)),this.active||t!=a[1]||(o=Math.round(100-Math.abs(this.translate)/this.element.offsetWidth*100)),o>100&&(o=100),o<0&&(o=0),o},lock(e){e.style.overflow="hidden",e.style.touchAction="none"},unlock(e){e.style.removeProperty("overflow"),e.style.removeProperty("touch-action")}},unmounted(){this.unlock(document.querySelector("html")),this.unlock(document.querySelector("body"))}},re=(0,x.Z)(ie,[["render",se],["__scopeId","data-v-b4ed4c86"]]),le=re;var ne=o(5126);const de=(0,a.Uk)(" Rest & Chill"),ce=(0,a.Uk)(" Dark Mode"),he=(0,a.Uk)(" HotKeys"),pe=(0,a.Uk)(" Dictionary"),ue=(0,a.Uk)(" Purchase"),ge=(0,a.Uk)(" Register");function me(e,t,o,s,i,r){const l=(0,a.up)("q-icon"),n=(0,a.up)("q-avatar"),d=(0,a.up)("q-item-section"),c=(0,a.up)("q-item-label"),h=(0,a.up)("q-item"),p=(0,a.up)("q-toggle"),u=(0,a.up)("q-list"),g=(0,a.up)("q-card"),m=(0,a.up)("hot-keys-info-dialog"),f=(0,a.Q2)("ripple");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(g,{class:"card"},{default:(0,a.w5)((()=>[(0,a.Wm)(u,{bordered:""},{default:(0,a.w5)((()=>[(0,a.wy)((0,a.Wm)(h,{class:"q-my-sm",clickable:"",onClick:t[0]||(t[0]=t=>e.$emit("toggleBook"))},{default:(0,a.w5)((()=>[(0,a.Wm)(d,{avatar:""},{default:(0,a.w5)((()=>[(0,a.Wm)(n,{color:"black","text-color":"white"},{default:(0,a.w5)((()=>[(0,a.Wm)(l,{name:"vrpano"})])),_:1})])),_:1}),(0,a.Wm)(d,null,{default:(0,a.w5)((()=>[(0,a.Wm)(c,null,{default:(0,a.w5)((()=>[de])),_:1})])),_:1})])),_:1},512),[[f,void 0,void 0,{early:!0}]]),(0,a.wy)((0,a.Wm)(h,{class:"q-my-sm",tag:"label",clickable:""},{default:(0,a.w5)((()=>[(0,a.Wm)(d,{avatar:""},{default:(0,a.w5)((()=>[(0,a.Wm)(n,{color:"black","text-color":"white"},{default:(0,a.w5)((()=>[(0,a.Wm)(l,{name:"dark_mode"})])),_:1})])),_:1}),(0,a.Wm)(d,null,{default:(0,a.w5)((()=>[(0,a.Wm)(c,null,{default:(0,a.w5)((()=>[ce])),_:1})])),_:1}),(0,a.Wm)(d,{avatar:""},{default:(0,a.w5)((()=>[(0,a.Wm)(p,{modelValue:i.darkMode,"onUpdate:modelValue":t[1]||(t[1]=e=>i.darkMode=e),color:"black","keep-color":""},null,8,["modelValue"])])),_:1})])),_:1},512),[[f,void 0,void 0,{early:!0}]]),(0,a.wy)((0,a.Wm)(h,{class:"q-my-sm",clickable:"",onClick:t[2]||(t[2]=e=>i.hotkeysDialog=!0)},{default:(0,a.w5)((()=>[(0,a.Wm)(d,{avatar:""},{default:(0,a.w5)((()=>[(0,a.Wm)(n,{color:"black","text-color":"white"},{default:(0,a.w5)((()=>[(0,a.Wm)(l,{name:"info"})])),_:1})])),_:1}),(0,a.Wm)(d,null,{default:(0,a.w5)((()=>[(0,a.Wm)(c,null,{default:(0,a.w5)((()=>[he])),_:1})])),_:1})])),_:1},512),[[f,void 0,void 0,{early:!0}]]),(0,a.wy)((0,a.Wm)(h,{class:"q-my-sm",clickable:"",onClick:t[3]||(t[3]=t=>e.$emit("searchDictionary"))},{default:(0,a.w5)((()=>[(0,a.Wm)(d,{avatar:""},{default:(0,a.w5)((()=>[(0,a.Wm)(n,{color:"black","text-color":"white"},{default:(0,a.w5)((()=>[(0,a.Wm)(l,{name:"translate"})])),_:1})])),_:1}),(0,a.Wm)(d,null,{default:(0,a.w5)((()=>[(0,a.Wm)(c,null,{default:(0,a.w5)((()=>[pe])),_:1})])),_:1})])),_:1},512),[[f,void 0,void 0,{early:!0}]]),o.purchaseAble?(0,a.wy)(((0,a.wg)(),(0,a.j4)(h,{key:0,class:"q-my-sm",clickable:"",onClick:t[4]||(t[4]=t=>e.$emit("purchase"))},{default:(0,a.w5)((()=>[(0,a.Wm)(d,{avatar:""},{default:(0,a.w5)((()=>[(0,a.Wm)(n,{color:"black","text-color":"white"},{default:(0,a.w5)((()=>[(0,a.Wm)(l,{name:"shopping_cart"})])),_:1})])),_:1}),(0,a.Wm)(d,null,{default:(0,a.w5)((()=>[(0,a.Wm)(c,null,{default:(0,a.w5)((()=>[ue])),_:1})])),_:1})])),_:1},512)),[[f,void 0,void 0,{early:!0}]]):e.$store.getters["user/isLoggedIn"]?(0,a.kq)("",!0):(0,a.wy)(((0,a.wg)(),(0,a.j4)(h,{key:1,class:"q-my-sm",clickable:"",onClick:t[5]||(t[5]=t=>e.$router.push({name:"home-sign-up"}))},{default:(0,a.w5)((()=>[(0,a.Wm)(d,{avatar:""},{default:(0,a.w5)((()=>[(0,a.Wm)(n,{color:"black","text-color":"white"},{default:(0,a.w5)((()=>[(0,a.Wm)(l,{name:"login"})])),_:1})])),_:1}),(0,a.Wm)(d,null,{default:(0,a.w5)((()=>[(0,a.Wm)(c,null,{default:(0,a.w5)((()=>[ge])),_:1})])),_:1})])),_:1},512)),[[f,void 0,void 0,{early:!0}]])])),_:1})])),_:1}),(0,a.Wm)(m,{open:i.hotkeysDialog,hotkeys:i.hotkeys,onClose:t[6]||(t[6]=e=>i.hotkeysDialog=!1)},null,8,["open","hotkeys"])],64)}var fe=o(6866);const ke=[[{keys:["Ctrl","F11"],condition:"",result:"Activate Zen Mode",header:"Global"},{keys:["Ctrl","B"],condition:"",result:"Toggle Side Bar"},{keys:["Ctrl","C"],condition:"",result:"Toggle Rest & Chill"},{keys:["Ctrl","/"],condition:"",result:"Search Dictionary"},{keys:["Ctrl","I"],condition:"",result:"Toggle Reader Settings"}],[{keys:["&#8595;"],condition:"",result:"Turn Next Page",header:"Accessiblity (Book)"},{keys:["&#8593;"],condition:"",result:"Turn Previous Page"},{keys:["&#8594;"],condition:"",result:"Turn Next Page"},{keys:["&#8592;"],condition:"",result:"Turn Previous Page"}]],ye={name:"ReaderSettings",components:{HotKeysInfoDialog:fe.Z},props:{purchaseAble:{type:Boolean,default:!1}},data(){return{hotkeysDialog:!1,hotkeys:ke,darkMode:this.$q.dark.isActive}},watch:{darkMode:function(e){this.$emit("themeChanged"),1==e?this.$q.dark.set(!0):this.$q.dark.set(!1),this.$q.localStorage.set("darkMode",this.$q.dark.isActive)}},methods:{}};var be=o(151),ve=o(7011),we=o(3414),_e=o(2035),$e=o(5096),Ce=o(4554),xe=o(2350),qe=o(8886),Se=o(6489);const We=(0,x.Z)(ye,[["render",me],["__scopeId","data-v-0d70c61d"]]),Te=We;j()(ye,"components",{QCard:be.Z,QList:ve.Z,QItem:we.Z,QItemSection:_e.Z,QAvatar:$e.Z,QIcon:Ce.Z,QItemLabel:xe.Z,QToggle:qe.Z}),j()(ye,"directives",{Ripple:Se.Z});const Pe=e=>((0,a.dD)("data-v-d793e30c"),e=e(),(0,a.Cn)(),e),De={class:"result-container"},Ae={class:"result"},Be={class:"result-definition"},Ne={key:0,class:"result-examples"},Le=Pe((()=>(0,a._)("h4",null,"Examples",-1))),Ze={key:1,class:"result-synonyms"},Me=Pe((()=>(0,a._)("span",null,"Synonyms:",-1)));function Fe(e,t,o,s,r,l){const n=(0,a.up)("prompt-dialog"),d=(0,a.up)("q-card-section"),c=(0,a.up)("swiper-slide"),h=(0,a.up)("swiper"),p=(0,a.up)("q-btn"),u=(0,a.up)("q-card-actions"),g=(0,a.up)("q-card"),m=(0,a.up)("q-dialog"),f=(0,a.Q2)("close-popup");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(n,{open:r.searchDialog,label:"Dictionary",caption:"Word To Search",value:"",onConfirmed:l.search},null,8,["open","onConfirmed"]),(0,a.Wm)(m,{modelValue:r.resultDialog,"onUpdate:modelValue":t[0]||(t[0]=e=>r.resultDialog=e)},{default:(0,a.w5)((()=>[(0,a.Wm)(g,{class:"result-card"},{default:(0,a.w5)((()=>[(0,a.Wm)(d,{class:"result-word"},{default:(0,a.w5)((()=>[(0,a._)("h3",null,(0,i.zw)(l.capitalizeFirstLetter(r.searchWord)),1)])),_:1}),(0,a.Wm)(d,null,{default:(0,a.w5)((()=>[(0,a.Wm)(h,{modules:r.modules,"slides-per-view":1,"space-between":0,centeredSlides:!1,navigation:!0,pagination:{clickable:!0},keyboard:{enabled:!0},simulateTouch:!0},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(r.result,((e,t)=>((0,a.wg)(),(0,a.j4)(c,{key:t},{default:(0,a.w5)((()=>[(0,a._)("div",De,[(0,a._)("div",Ae,[(0,a._)("div",Be," ("+(0,i.zw)(e.pos)+") "+(0,i.zw)(l.capitalizeFirstLetter(e.definition)),1),e.examples.length>0?((0,a.wg)(),(0,a.iD)("div",Ne,[Le,((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.examples,((e,t)=>((0,a.wg)(),(0,a.iD)("p",{key:t},(0,i.zw)(e),1)))),128))])):(0,a.kq)("",!0),e.synonyms.length>0?((0,a.wg)(),(0,a.iD)("div",Ze,[(0,a._)("h4",null,[Me,(0,a.Uk)(" "+(0,i.zw)(e.synonyms.join(", ")),1)])])):(0,a.kq)("",!0)])])])),_:2},1024)))),128))])),_:1},8,["modules"])])),_:1}),(0,a.Wm)(u,{align:"right"},{default:(0,a.w5)((()=>[(0,a.wy)((0,a.Wm)(p,{outline:"",ripple:{early:!0},label:"Close"},null,512),[[f]])])),_:1})])),_:1})])),_:1},8,["modelValue"])],64)}var Ie=o(1832),Ee=o(3083),He=o(9319);const ze={name:"Dictionary",components:{PromptDialog:Ie.Z,Swiper:He.t,SwiperSlide:He.o},data(){return{searchDialog:!1,resultDialog:!1,searchWord:"",result:[],modules:[Ee.W_,Ee.tl,Ee.N1,Ee.s5]}},methods:{openSearchDialog(){this.searchDialog=!this.searchDialog},async search(e){if(this.searchDialog=!1,e){this.searchWord=e;let t=await this.$api.post("users/dictionary",{word:e});this.result=t.data.result,this.resultDialog=!0}},capitalizeFirstLetter(e){return e.charAt(0).toUpperCase()+e.slice(1)}}};var je=o(6778),Oe=o(5589),Qe=o(9367),Ue=o(8240),Re=o(677);const Ve=(0,x.Z)(ze,[["render",Fe],["__scopeId","data-v-d793e30c"]]),Ke=Ve;j()(ze,"components",{QDialog:je.Z,QCard:be.Z,QCardSection:Oe.Z,QCardActions:Qe.Z,QBtn:Ue.Z}),j()(ze,"directives",{ClosePopup:Re.Z});const Ye={components:{Book:te,Drawer:le,SideBarContents:ne.Z,ReaderSettings:Te,Dictionary:Ke,SplashScreen:k.Z},name:"ReadBook",data(){return{headerShow:!0,info:!0,text:"",navigations:[{name:"Front Matters",data:[]},{name:"Chapters",data:[]},{name:"Back Matters",data:[]}],sideBarClasses:{"side-bar--dark":!1},purchaseAble:!1,overflow:"hidden",settingsDialog:!1,bookcss:"",darkMode:this.$q.dark.isActive}},watch:{"$q.dark.isActive":function(e){this.sideBarClasses["side-bar--dark"]=!!e}},computed:{btnColor(){let e="";return e=this.$q.dark.isActive?"white":"black",e},videoURL(){let e="";return e=this.$q.dark.isActive?"https://storage.googleapis.com/bookkay-dev.appspot.com/reader_videos/background--dark.mp4":"https://storage.googleapis.com/bookkay-dev.appspot.com/reader_videos/background.mp4",e}},mounted(){this.info=!this.$q.localStorage.getItem("readerInfo");let e=this;document.body.addEventListener("keydown",(function(t){t.ctrlKey&&"F11"==t.key&&e.toggleZen(),t.ctrlKey&&"b"==t.key&&e.toggleDrawer(),t.ctrlKey&&"c"==t.key&&e.toggleBook(),t.ctrlKey&&"/"==t.key&&e.searchDictionary(),t.ctrlKey&&"i"==t.key&&(e.settingsDialog=!e.settingsDialog)}),!1),this.$q.localStorage.has("darkMode")&&this.$q.dark.set(this.$q.localStorage.getItem("darkMode")),this.checkPurchaseAble()},methods:{toggleZen(){this.$q.fullscreen.toggle().then((()=>{})).catch((e=>{alert(e)})),this.headerShow=!1},toggleDrawer(){this.$refs.drawer.active?this.$refs.drawer.close():this.$refs.drawer.open()},searchDictionary(){this.$refs.dictionary.openSearchDialog()},checkPurchaseAble(){if(this.$store.getters["user/isLoggedIn"]){let e,t=this.$store.getters["user/userProperty"]("books_purchased"),o=this.$store.getters["user/userProperty"]("books_authored");if(!("book_id"in this.$route.query))return this.purchaseAble=!1,"";e=this.$route.query.book_id;let a=t.some((t=>t.id===e)),s=o.some((t=>t.id===e));this.purchaseAble=!a&&!s}else this.purchaseAble=!1},async purchase(){try{await this.$api.post(`books/${this.$route.query.book_id}/purchase`);let e=await this.$api.get("users/"+this.$store.getters["user/userProperty"]("id"),{params:{expand:"~all"}});const t=e.data;this.$store.commit("user/setUser",t),this.$q.localStorage.set("user",t),this.$q.notify({color:"positive",position:"top",message:"You have successfully bought the book. Hope you enjoy it.",icon:"error"})}catch(e){this.$q.notify({color:"negative",position:"top",message:"Error when purchasing book",icon:"error"})}this.checkPurchaseAble()},reloadsBook(){this.$refs.book.loadPageFlip()},onClick(){this.bookcss=""},toggleBook(){""==this.bookcss?(this.bookcss="book-leave",this.headerShow=!1,this.settingsDialog=!1,this.$q.fullscreen.request()):this.bookcss=""},addNav(e){switch(e["type"]){case"book":this.navigations.unshift(e);break;case"front_matter":let t=this.navigations.find((e=>"Front Matters"===e.name));t.data.push(e);break;case"chapter":let o=this.navigations.find((e=>"Chapters"===e.name));o.data.push(e);break;case"back_matter":let a=this.navigations.find((e=>"Back Matters"===e.name));a.data.push(e);break;default:}},navClicked(e){let t=this.$refs.book.$refs.flipbook.getOrientation();"landscape"==t?this.$refs.book.$refs.flipbook.flip(e.page):this.$refs.book.$refs.flipbook.turnToPage(e.page)},handleSelected(){null==this.selected?this.selected=this.currentSelected:(this.currentSelected=this.selected,this.headerShow=!1,this.$refs.book.$refs.flipbook.flip(this.currentSelected))},handleSwipe(e){"top"==e?headerShow=!1:"down"==e&&(headerShow=!0)}},beforeRouteUpdate(e,t,o){this.navigations=[],o()},beforeRouteLeave(e,t,o){this.overflow="auto",o()},beforeUnmount(){this.$q.sessionStorage.has("currentManuscript")&&this.$q.sessionStorage.remove("currentManuscript"),this.$q.sessionStorage.has("currentBook")&&this.$q.sessionStorage.remove("currentBook"),this.$q.dark.set(!1)}};var Xe=o(614);const Ge=(0,x.Z)(Ye,[["render",f],["__scopeId","data-v-5fb582f6"]]),Je=Ge;j()(Ye,"components",{QAjaxBar:Xe.Z,QDialog:je.Z,QBtn:Ue.Z,QAvatar:$e.Z})}}]);